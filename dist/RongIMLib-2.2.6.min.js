var Polling={DeleteMsgInput:function(){var a={};this.setType=function(b){a.type=b},this.setConversationId=function(b){a.conversationId=b},this.setMsgs=function(b){a.msgs=b},this.toArrayBuffer=function(){return a}},DeleteMsg:function(){var a={};this.setMsgId=function(b){a.msgId=b},this.setMsgDataTime=function(b){a.msgDataTime=b},this.setDirect=function(b){a.direct=b},this.toArrayBuffer=function(){return a}},DeleteMsgOutput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.toArrayBuffer=function(){return a}},SearchMpInput:function(){var a={};this.setType=function(b){a.type=b},this.setId=function(b){a.id=b},this.toArrayBuffer=function(){return a}},SearchMpOutput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.setInfo=function(b){a.info=b},this.toArrayBuffer=function(){return a}},MpInfo:function(){var a={};this.setMpid=function(b){a.mpid=b},this.setName=function(b){a.name=b},this.setType=function(b){a.type=b},this.setTime=function(b){a.time=b},this.setPortraitUri=function(b){a.portraitUrl=b},this.setExtra=function(b){a.extra=b},this.toArrayBuffer=function(){return a}},PullMpInput:function(){var a={};this.setMpid=function(b){a.mpid=b},this.setTime=function(b){a.time=b},this.toArrayBuffer=function(){return a}},PullMpOutput:function(){var a={};this.setStatus=function(b){a.status=b},this.setInfo=function(b){a.info=b},this.toArrayBuffer=function(){return a}},MPFollowInput:function(){var a={};this.setId=function(b){a.id=b},this.toArrayBuffer=function(){return a}},MPFollowOutput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.setInfo=function(b){a.info=b},this.toArrayBuffer=function(){return a}},NotifyMsg:function(){var a={};this.setType=function(b){a.type=b},this.setTime=function(b){a.time=b},this.setChrmId=function(b){a.chrmId=b},this.toArrayBuffer=function(){return a}},SyncRequestMsg:function(){var a={};this.setSyncTime=function(b){a.syncTime=b||0},this.setIspolling=function(b){a.ispolling=!!b},this.setIsweb=function(b){a.isweb=!!b},this.setIsPullSend=function(b){a.isPullSend=!!b},this.toArrayBuffer=function(){return a}},UpStreamMessage:function(){var a={};this.setSessionId=function(b){a.sessionId=b},this.setClassname=function(b){a.classname=b},this.setContent=function(b){b&&(a.content=b)},this.setPushText=function(b){a.pushText=b},this.setUserId=function(b){a.userId=b},this.setAppData=function(b){a.appData=b},this.toArrayBuffer=function(){return a}},DownStreamMessages:function(){var a={};this.setList=function(b){a.list=b},this.setSyncTime=function(b){a.syncTime=b},this.toArrayBuffer=function(){return a}},DownStreamMessage:function(){var a={};this.setFromUserId=function(b){a.fromUserId=b},this.setType=function(b){a.type=b},this.setGroupId=function(b){a.groupId=b},this.setClassname=function(b){a.classname=b},this.setContent=function(b){b&&(a.content=b)},this.setDataTime=function(b){a.dataTime=b},this.setStatus=function(b){a.status=b},this.setMsgId=function(b){a.msgId=b},this.toArrayBuffer=function(){return a}},CreateDiscussionInput:function(){var a={};this.setName=function(b){a.name=b},this.toArrayBuffer=function(){return a}},CreateDiscussionOutput:function(){var a={};this.setId=function(b){a.id=b},this.toArrayBuffer=function(){return a}},ChannelInvitationInput:function(){var a={};this.setUsers=function(b){a.users=b},this.toArrayBuffer=function(){return a}},LeaveChannelInput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.toArrayBuffer=function(){return a}},QueryChatroomInfoInput:function(){var a={};this.setCount=function(b){a.count=b},this.setOrder=function(b){a.order=b},this.toArrayBuffer=function(){return a}},QueryChatroomInfoOutput:function(){var a={};this.setUserTotalNums=function(b){a.userTotalNums=b},this.setUserInfos=function(b){a.userInfos=b},this.toArrayBuffer=function(){return a}},ChannelEvictionInput:function(){var a={};this.setUser=function(b){a.user=b},this.toArrayBuffer=function(){return a}},RenameChannelInput:function(){var a={};this.setName=function(b){a.name=b},this.toArrayBuffer=function(){return a}},ChannelInfoInput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.toArrayBuffer=function(){return a}},ChannelInfoOutput:function(){var a={};this.setType=function(b){a.type=b},this.setChannelId=function(b){a.channelId=b},this.setChannelName=function(b){a.channelName=b},this.setAdminUserId=function(b){a.adminUserId=b},this.setFirstTenUserIds=function(b){a.firstTenUserIds=b},this.setOpenStatus=function(b){a.openStatus=b},this.toArrayBuffer=function(){return a}},ChannelInfosInput:function(){var a={};this.setPage=function(b){a.page=b},this.setNumber=function(b){a.number=b},this.toArrayBuffer=function(){return a}},ChannelInfosOutput:function(){var a={};this.setChannels=function(b){a.channels=b},this.setTotal=function(b){a.total=b},this.toArrayBuffer=function(){return a}},MemberInfo:function(){var a={};this.setUserId=function(b){a.userId=b},this.setUserName=function(b){a.userName=b},this.setUserPortrait=function(b){a.userPortrait=b},this.setExtension=function(b){a.extension=b},this.toArrayBuffer=function(){return a}},GroupMembersInput:function(){var a={};this.setPage=function(b){a.page=b},this.setNumber=function(b){a.number=b},this.toArrayBuffer=function(){return a}},GroupMembersOutput:function(){var a={};this.setMembers=function(b){a.members=b},this.setTotal=function(b){a.total=b},this.toArrayBuffer=function(){return a}},GetUserInfoInput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.toArrayBuffer=function(){return a}},GetUserInfoOutput:function(){var a={};this.setUserId=function(b){a.userId=b},this.setUserName=function(b){a.userName=b},this.setUserPortrait=function(b){a.userPortrait=b},this.toArrayBuffer=function(){return a}},GetSessionIdInput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.toArrayBuffer=function(){return a}},GetSessionIdOutput:function(){var a={};this.setSessionId=function(b){a.sessionId=b},this.toArrayBuffer=function(){return a}},GetQNupTokenInput:function(){var a={};this.setType=function(b){a.type=b},this.toArrayBuffer=function(){return a}},GetQNupTokenOutput:function(){var a={};this.setDeadline=function(b){a.deadline=b},this.setToken=function(b){a.token=b},this.toArrayBuffer=function(){return a}},GetQNdownloadUrlInput:function(){var a={};this.setType=function(b){a.type=b},this.setKey=function(b){a.key=b},this.setFileName=function(b){a.fileName=b},this.toArrayBuffer=function(){return a}},GetQNdownloadUrlOutput:function(){var a={};this.setDownloadUrl=function(b){a.downloadUrl=b},this.toArrayBuffer=function(){return a}},Add2BlackListInput:function(){var a={};this.setUserId=function(b){a.userId=b},this.toArrayBuffer=function(){return a}},RemoveFromBlackListInput:function(){var a={};this.setUserId=function(b){a.userId=b},this.toArrayBuffer=function(){return a}},QueryBlackListInput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.toArrayBuffer=function(){return a}},QueryBlackListOutput:function(){var a={};this.setUserIds=function(b){a.userIds=b},this.toArrayBuffer=function(){return a}},BlackListStatusInput:function(){var a={};this.setUserId=function(b){a.userId=b},this.toArrayBuffer=function(){return a}},BlockPushInput:function(){var a={};this.setBlockeeId=function(b){a.blockeeId=b},this.toArrayBuffer=function(){return a}},ModifyPermissionInput:function(){var a={};this.setOpenStatus=function(b){a.openStatus=b},this.toArrayBuffer=function(){return a}},GroupInput:function(){var a={};this.setGroupInfo=function(b){for(var c=0,d=[];c<b.length;c++)d.push({id:b[c].getContent().id,name:b[c].getContent().name});a.groupInfo=d},this.toArrayBuffer=function(){return a}},GroupOutput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.toArrayBuffer=function(){return a}},GroupInfo:function(){var a={};this.setId=function(b){a.id=b},this.setName=function(b){a.name=b},this.getContent=function(){return a},this.toArrayBuffer=function(){return a}},GroupHashInput:function(){var a={};this.setUserId=function(b){a.userId=b},this.setGroupHashCode=function(b){a.groupHashCode=b},this.toArrayBuffer=function(){return a}},GroupHashOutput:function(){var a={};this.setResult=function(b){a.result=b},this.toArrayBuffer=function(){return a}},ChrmInput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.toArrayBuffer=function(){return a}},ChrmOutput:function(){var a={};this.setNothing=function(b){a.nothing=b},this.toArrayBuffer=function(){return a}},ChrmPullMsg:function(){var a={};this.setSyncTime=function(b){a.syncTime=b},this.setCount=function(b){a.count=b},this.toArrayBuffer=function(){return a}},RelationsInput:function(){var a={};this.setType=function(b){a.type=b},this.setMsg=function(b){a.msg=b},this.setCount=function(b){a.count=b},this.toArrayBuffer=function(){return a}},RelationsOutput:function(){var a={};this.setInfo=function(b){a.info=b},this.toArrayBuffer=function(){return a}},RelationInfo:function(){var a={};this.setType=function(b){a.type=b},this.setUserId=function(b){a.userId=b},this.setMsg=function(b){a.msg=b},this.toArrayBuffer=function(){return a}},HistoryMessageInput:function(){var a={};this.setTargetId=function(b){a.targetId=b},this.setDataTime=function(b){a.dataTime=b},this.setSize=function(b){a.size=b},this.toArrayBuffer=function(){return a}},HistoryMessagesOuput:function(){var a={};this.setList=function(b){a.list=b},this.setSyncTime=function(b){a.syncTime=b},this.setHasMsg=function(b){a.hasMsg=b},this.toArrayBuffer=function(){return a}},HistoryMsgInput:function(){var a={};this.setTargetId=function(b){a.targetId=b},this.setTime=function(b){a.time=b},this.setCount=function(b){a.count=b},this.setOrder=function(b){a.order=b},this.toArrayBuffer=function(){return a}},HistoryMsgOuput:function(){var a={};this.setList=function(b){a.list=b},this.setSyncTime=function(b){a.syncTime=b},this.setHasMsg=function(b){a.hasMsg=b},this.toArrayBuffer=function(){return a}}};for(var f in Polling)Polling[f].decode=function(b){var back={},val=JSON.parse(b)||eval("("+b+")");for(var i in val)back[i]=val[i],back["get"+i.charAt(0).toUpperCase()+i.slice(1)]=function(){return val[i]};return back};!function(a){"use strict";function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;c<16;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}a.md5=t,"function"==typeof define&&define.amd?define("md5",function(){return t}):"object"==typeof module&&module.exports?module.exports=t:a.md5=t}(this);var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},RongIMLib;!function(a){!function(a){a[a.ALL=1]="ALL",a[a.PART=2]="PART"}(a.MentionedType||(a.MentionedType={}));a.MentionedType;!function(a){a[a.CUSTOMER_SERVICE=1]="CUSTOMER_SERVICE",a[a.RECALL=2]="RECALL"}(a.MethodType||(a.MethodType={}));a.MethodType;!function(a){a[a.IN_BLACK_LIST=0]="IN_BLACK_LIST",a[a.NOT_IN_BLACK_LIST=1]="NOT_IN_BLACK_LIST"}(a.BlacklistStatus||(a.BlacklistStatus={}));a.BlacklistStatus;!function(a){a[a.XHR_POLLING=0]="XHR_POLLING",a[a.WEBSOCKET=1]="WEBSOCKET",a[a.HTTP=0]="HTTP",a[a.HTTPS=1]="HTTPS"}(a.ConnectionChannel||(a.ConnectionChannel={}));a.ConnectionChannel;!function(a){a[a.ONLY_ROBOT=1]="ONLY_ROBOT",a[a.ONLY_HUMAN=2]="ONLY_HUMAN",a[a.ROBOT_FIRST=3]="ROBOT_FIRST",a[a.HUMAN_FIRST=4]="HUMAN_FIRST"}(a.CustomerType||(a.CustomerType={}));a.CustomerType;!function(a){a[a.NONE=0]="NONE",a[a.SQQUENCE=1]="SQQUENCE",a[a.REVERSE=2]="REVERSE"}(a.GetChatRoomType||(a.GetChatRoomType={}));a.GetChatRoomType;!function(a){a[a.CONNECTED=0]="CONNECTED",a[a.CONNECTING=1]="CONNECTING",a[a.DISCONNECTED=2]="DISCONNECTED",a[a.KICKED_OFFLINE_BY_OTHER_CLIENT=6]="KICKED_OFFLINE_BY_OTHER_CLIENT",a[a.NETWORK_UNAVAILABLE=3]="NETWORK_UNAVAILABLE",a[a.DOMAIN_INCORRECT=12]="DOMAIN_INCORRECT",a[a.CONNECTION_CLOSED=4]="CONNECTION_CLOSED"}(a.ConnectionStatus||(a.ConnectionStatus={}));a.ConnectionStatus;!function(a){a[a.DO_NOT_DISTURB=0]="DO_NOT_DISTURB",a[a.NOTIFY=1]="NOTIFY"}(a.ConversationNotificationStatus||(a.ConversationNotificationStatus={}));a.ConversationNotificationStatus;!function(a){a[a.NONE=0]="NONE",a[a.PRIVATE=1]="PRIVATE",a[a.DISCUSSION=2]="DISCUSSION",a[a.GROUP=3]="GROUP",a[a.CHATROOM=4]="CHATROOM",a[a.CUSTOMER_SERVICE=5]="CUSTOMER_SERVICE",a[a.SYSTEM=6]="SYSTEM",a[a.APP_PUBLIC_SERVICE=7]="APP_PUBLIC_SERVICE",a[a.PUBLIC_SERVICE=8]="PUBLIC_SERVICE"}(a.ConversationType||(a.ConversationType={}));a.ConversationType;!function(a){a[a.OPENED=0]="OPENED",a[a.CLOSED=1]="CLOSED"}(a.DiscussionInviteStatus||(a.DiscussionInviteStatus={}));a.DiscussionInviteStatus;!function(a){a[a.SEND_FREQUENCY_TOO_FAST=20604]="SEND_FREQUENCY_TOO_FAST",a[a.RC_MSG_UNAUTHORIZED=20406]="RC_MSG_UNAUTHORIZED",a[a.RC_DISCUSSION_GROUP_ID_INVALID=20407]="RC_DISCUSSION_GROUP_ID_INVALID",a[a.FORBIDDEN_IN_GROUP=22408]="FORBIDDEN_IN_GROUP",a[a.NOT_IN_DISCUSSION=21406]="NOT_IN_DISCUSSION",a[a.NOT_IN_GROUP=22406]="NOT_IN_GROUP",a[a.NOT_IN_CHATROOM=23406]="NOT_IN_CHATROOM",a[a.FORBIDDEN_IN_CHATROOM=23408]="FORBIDDEN_IN_CHATROOM",a[a.RC_CHATROOM_USER_KICKED=23409]="RC_CHATROOM_USER_KICKED",a[a.RC_CHATROOM_NOT_EXIST=23410]="RC_CHATROOM_NOT_EXIST",a[a.RC_CHATROOM_IS_FULL=23411]="RC_CHATROOM_IS_FULL",a[a.RC_CHATROOM_PATAMETER_INVALID=23412]="RC_CHATROOM_PATAMETER_INVALID",a[a.CHATROOM_GET_HISTORYMSG_ERROR=23413]="CHATROOM_GET_HISTORYMSG_ERROR",a[a.CHATROOM_NOT_OPEN_HISTORYMSG_STORE=23414]="CHATROOM_NOT_OPEN_HISTORYMSG_STORE",a[a.TIMEOUT=-1]="TIMEOUT",a[a.UNKNOWN=-2]="UNKNOWN",a[a.JOIN_IN_DISCUSSION=21407]="JOIN_IN_DISCUSSION",a[a.CREATE_DISCUSSION=21408]="CREATE_DISCUSSION",a[a.INVITE_DICUSSION=21409]="INVITE_DICUSSION",a[a.GET_USERINFO_ERROR=23407]="GET_USERINFO_ERROR",a[a.REJECTED_BY_BLACKLIST=405]="REJECTED_BY_BLACKLIST",a[a.RC_NET_CHANNEL_INVALID=30001]="RC_NET_CHANNEL_INVALID",a[a.RC_NET_UNAVAILABLE=30002]="RC_NET_UNAVAILABLE",a[a.RC_MSG_RESP_TIMEOUT=30003]="RC_MSG_RESP_TIMEOUT",a[a.RC_HTTP_SEND_FAIL=30004]="RC_HTTP_SEND_FAIL",a[a.RC_HTTP_REQ_TIMEOUT=30005]="RC_HTTP_REQ_TIMEOUT",a[a.RC_HTTP_RECV_FAIL=30006]="RC_HTTP_RECV_FAIL",a[a.RC_NAVI_RESOURCE_ERROR=30007]="RC_NAVI_RESOURCE_ERROR",a[a.RC_NODE_NOT_FOUND=30008]="RC_NODE_NOT_FOUND",a[a.RC_DOMAIN_NOT_RESOLVE=30009]="RC_DOMAIN_NOT_RESOLVE",a[a.RC_SOCKET_NOT_CREATED=30010]="RC_SOCKET_NOT_CREATED",a[a.RC_SOCKET_DISCONNECTED=30011]="RC_SOCKET_DISCONNECTED",a[a.RC_PING_SEND_FAIL=30012]="RC_PING_SEND_FAIL",a[a.RC_PONG_RECV_FAIL=30013]="RC_PONG_RECV_FAIL",a[a.RC_MSG_SEND_FAIL=30014]="RC_MSG_SEND_FAIL",a[a.RC_CONN_ACK_TIMEOUT=31e3]="RC_CONN_ACK_TIMEOUT",a[a.RC_CONN_PROTO_VERSION_ERROR=31001]="RC_CONN_PROTO_VERSION_ERROR",a[a.RC_CONN_ID_REJECT=31002]="RC_CONN_ID_REJECT",a[a.RC_CONN_SERVER_UNAVAILABLE=31003]="RC_CONN_SERVER_UNAVAILABLE",a[a.RC_CONN_USER_OR_PASSWD_ERROR=31004]="RC_CONN_USER_OR_PASSWD_ERROR",a[a.RC_CONN_NOT_AUTHRORIZED=31005]="RC_CONN_NOT_AUTHRORIZED",a[a.RC_CONN_REDIRECTED=31006]="RC_CONN_REDIRECTED",a[a.RC_CONN_PACKAGE_NAME_INVALID=31007]="RC_CONN_PACKAGE_NAME_INVALID",a[a.RC_CONN_APP_BLOCKED_OR_DELETED=31008]="RC_CONN_APP_BLOCKED_OR_DELETED",a[a.RC_CONN_USER_BLOCKED=31009]="RC_CONN_USER_BLOCKED",a[a.RC_DISCONN_KICK=31010]="RC_DISCONN_KICK",a[a.RC_DISCONN_EXCEPTION=31011]="RC_DISCONN_EXCEPTION",a[a.RC_QUERY_ACK_NO_DATA=32001]="RC_QUERY_ACK_NO_DATA",a[a.RC_MSG_DATA_INCOMPLETE=32002]="RC_MSG_DATA_INCOMPLETE",a[a.BIZ_ERROR_CLIENT_NOT_INIT=33001]="BIZ_ERROR_CLIENT_NOT_INIT",a[a.BIZ_ERROR_DATABASE_ERROR=33002]="BIZ_ERROR_DATABASE_ERROR",a[a.BIZ_ERROR_INVALID_PARAMETER=33003]="BIZ_ERROR_INVALID_PARAMETER",a[a.BIZ_ERROR_NO_CHANNEL=33004]="BIZ_ERROR_NO_CHANNEL",a[a.BIZ_ERROR_RECONNECT_SUCCESS=33005]="BIZ_ERROR_RECONNECT_SUCCESS",a[a.BIZ_ERROR_CONNECTING=33006]="BIZ_ERROR_CONNECTING",a[a.MSG_ROAMING_SERVICE_UNAVAILABLE=33007]="MSG_ROAMING_SERVICE_UNAVAILABLE",a[a.MSG_INSERT_ERROR=33008]="MSG_INSERT_ERROR",a[a.MSG_DEL_ERROR=33009]="MSG_DEL_ERROR",a[a.CONVER_REMOVE_ERROR=34001]="CONVER_REMOVE_ERROR",a[a.CONVER_GETLIST_ERROR=34002]="CONVER_GETLIST_ERROR",a[a.CONVER_SETOP_ERROR=34003]="CONVER_SETOP_ERROR",a[a.CONVER_TOTAL_UNREAD_ERROR=34004]="CONVER_TOTAL_UNREAD_ERROR",a[a.CONVER_TYPE_UNREAD_ERROR=34005]="CONVER_TYPE_UNREAD_ERROR",a[a.CONVER_ID_TYPE_UNREAD_ERROR=34006]="CONVER_ID_TYPE_UNREAD_ERROR",a[a.CONVER_CLEAR_ERROR=34007]="CONVER_CLEAR_ERROR",a[a.CONVER_GET_ERROR=34008]="CONVER_GET_ERROR",a[a.GROUP_SYNC_ERROR=35001]="GROUP_SYNC_ERROR",a[a.GROUP_MATCH_ERROR=35002]="GROUP_MATCH_ERROR",a[a.CHATROOM_ID_ISNULL=36001]="CHATROOM_ID_ISNULL",a[a.CHARTOOM_JOIN_ERROR=36002]="CHARTOOM_JOIN_ERROR",a[a.CHATROOM_HISMESSAGE_ERROR=36003]="CHATROOM_HISMESSAGE_ERROR",a[a.BLACK_ADD_ERROR=37001]="BLACK_ADD_ERROR",a[a.BLACK_GETSTATUS_ERROR=37002]="BLACK_GETSTATUS_ERROR",a[a.BLACK_REMOVE_ERROR=37003]="BLACK_REMOVE_ERROR",a[a.DRAF_GET_ERROR=38001]="DRAF_GET_ERROR",a[a.DRAF_SAVE_ERROR=38002]="DRAF_SAVE_ERROR",a[a.DRAF_REMOVE_ERROR=38003]="DRAF_REMOVE_ERROR",a[a.SUBSCRIBE_ERROR=39001]="SUBSCRIBE_ERROR",a[a.QNTKN_FILETYPE_ERROR=41001]="QNTKN_FILETYPE_ERROR",a[a.QNTKN_GET_ERROR=41002]="QNTKN_GET_ERROR",a[a.COOKIE_ENABLE=51001]="COOKIE_ENABLE",a[a.GET_MESSAGE_BY_ID_ERROR=61001]="GET_MESSAGE_BY_ID_ERROR",a[a.HAVNODEVICEID=24001]="HAVNODEVICEID",a[a.DEVICEIDISHAVE=24002]="DEVICEIDISHAVE",a[a.SUCCESS=0]="SUCCESS",a[a.FEILD=24009]="FEILD",a[a.VOIPISNULL=24013]="VOIPISNULL",a[a.NOENGINETYPE=24010]="NOENGINETYPE",a[a.NULLCHANNELNAME=24011]="NULLCHANNELNAME",a[a.VOIPDYANMICERROR=24012]="VOIPDYANMICERROR",a[a.NOVOIP=24014]="NOVOIP",a[a.INTERNALERRROR=24015]="INTERNALERRROR",a[a.VOIPCLOSE=24016]="VOIPCLOSE",a[a.CLOSE_BEFORE_OPEN=51001]="CLOSE_BEFORE_OPEN",a[a.ALREADY_IN_USE=51002]="ALREADY_IN_USE",a[a.INVALID_CHANNEL_NAME=51003]="INVALID_CHANNEL_NAME",a[a.VIDEO_CONTAINER_IS_NULL=51004]="VIDEO_CONTAINER_IS_NULL",a[a.DELETE_MESSAGE_ID_IS_NULL=61001]="DELETE_MESSAGE_ID_IS_NULL",a[a.CANCEL=1]="CANCEL",a[a.REJECT=2]="REJECT",a[a.HANGUP=3]="HANGUP",a[a.BUSYLINE=4]="BUSYLINE",a[a.NO_RESPONSE=5]="NO_RESPONSE",a[a.ENGINE_UN_SUPPORTED=6]="ENGINE_UN_SUPPORTED",a[a.NETWORK_ERROR=7]="NETWORK_ERROR",a[a.REMOTE_CANCEL=11]="REMOTE_CANCEL",a[a.REMOTE_REJECT=12]="REMOTE_REJECT",a[a.REMOTE_HANGUP=13]="REMOTE_HANGUP",a[a.REMOTE_BUSYLINE=14]="REMOTE_BUSYLINE",a[a.REMOTE_NO_RESPONSE=15]="REMOTE_NO_RESPONSE",a[a.REMOTE_ENGINE_UN_SUPPORTED=16]="REMOTE_ENGINE_UN_SUPPORTED",a[a.REMOTE_NETWORK_ERROR=17]="REMOTE_NETWORK_ERROR",a[a.VOIP_NOT_AVALIABLE=18]="VOIP_NOT_AVALIABLE"}(a.ErrorCode||(a.ErrorCode={}));a.ErrorCode;!function(a){a[a.MEDIA_AUDIO=1]="MEDIA_AUDIO",a[a.MEDIA_VEDIO=2]="MEDIA_VEDIO"}(a.VoIPMediaType||(a.VoIPMediaType={}));a.VoIPMediaType;!function(a){a[a.IMAGE=1]="IMAGE",a[a.AUDIO=2]="AUDIO",a[a.VIDEO=3]="VIDEO",a[a.FILE=100]="FILE"}(a.MediaType||(a.MediaType={}));a.MediaType;!function(a){a[a.SEND=1]="SEND",a[a.RECEIVE=2]="RECEIVE"}(a.MessageDirection||(a.MessageDirection={}));a.MessageDirection;!function(a){a[a.IMAGE=1]="IMAGE",a[a.AUDIO=2]="AUDIO",a[a.VIDEO=3]="VIDEO",a[a.FILE=4]="FILE"}(a.FileType||(a.FileType={}));a.FileType;!function(a){a[a.RC_REAL_TIME_LOCATION_NOT_INIT=-1]="RC_REAL_TIME_LOCATION_NOT_INIT",a[a.RC_REAL_TIME_LOCATION_SUCCESS=0]="RC_REAL_TIME_LOCATION_SUCCESS",a[a.RC_REAL_TIME_LOCATION_GPS_DISABLED=1]="RC_REAL_TIME_LOCATION_GPS_DISABLED",a[a.RC_REAL_TIME_LOCATION_CONVERSATION_NOT_SUPPORT=2]="RC_REAL_TIME_LOCATION_CONVERSATION_NOT_SUPPORT",a[a.RC_REAL_TIME_LOCATION_IS_ON_GOING=3]="RC_REAL_TIME_LOCATION_IS_ON_GOING",a[a.RC_REAL_TIME_LOCATION_EXCEED_MAX_PARTICIPANT=4]="RC_REAL_TIME_LOCATION_EXCEED_MAX_PARTICIPANT",a[a.RC_REAL_TIME_LOCATION_JOIN_FAILURE=5]="RC_REAL_TIME_LOCATION_JOIN_FAILURE",a[a.RC_REAL_TIME_LOCATION_START_FAILURE=6]="RC_REAL_TIME_LOCATION_START_FAILURE",a[a.RC_REAL_TIME_LOCATION_NETWORK_UNAVAILABLE=7]="RC_REAL_TIME_LOCATION_NETWORK_UNAVAILABLE"}(a.RealTimeLocationErrorCode||(a.RealTimeLocationErrorCode={}));a.RealTimeLocationErrorCode;!function(a){a[a.RC_REAL_TIME_LOCATION_STATUS_IDLE=0]="RC_REAL_TIME_LOCATION_STATUS_IDLE",a[a.RC_REAL_TIME_LOCATION_STATUS_INCOMING=1]="RC_REAL_TIME_LOCATION_STATUS_INCOMING",a[a.RC_REAL_TIME_LOCATION_STATUS_OUTGOING=2]="RC_REAL_TIME_LOCATION_STATUS_OUTGOING",a[a.RC_REAL_TIME_LOCATION_STATUS_CONNECTED=3]="RC_REAL_TIME_LOCATION_STATUS_CONNECTED"}(a.RealTimeLocationStatus||(a.RealTimeLocationStatus={}));a.RealTimeLocationStatus;!function(a){a[a.READ=1]="READ",a[a.LISTENED=2]="LISTENED",a[a.DOWNLOADED=4]="DOWNLOADED",a[a.RETRIEVED=8]="RETRIEVED",a[a.UNREAD=0]="UNREAD"}(a.ReceivedStatus||(a.ReceivedStatus={}));a.ReceivedStatus;!function(a){a[a.EXACT=0]="EXACT",a[a.FUZZY=1]="FUZZY"}(a.SearchType||(a.SearchType={}));a.SearchType;!function(a){a[a.SENDING=10]="SENDING",a[a.FAILED=20]="FAILED",a[a.SENT=30]="SENT",a[a.RECEIVED=40]="RECEIVED",a[a.READ=50]="READ",a[a.DESTROYED=60]="DESTROYED"}(a.SentStatus||(a.SentStatus={}));a.SentStatus;!function(a){a[a.ACCEPTED=0]="ACCEPTED",a[a.UNACCEPTABLE_PROTOCOL_VERSION=1]="UNACCEPTABLE_PROTOCOL_VERSION",a[a.IDENTIFIER_REJECTED=2]="IDENTIFIER_REJECTED",a[a.SERVER_UNAVAILABLE=3]="SERVER_UNAVAILABLE",a[a.TOKEN_INCORRECT=4]="TOKEN_INCORRECT",a[a.NOT_AUTHORIZED=5]="NOT_AUTHORIZED",a[a.REDIRECT=6]="REDIRECT",a[a.PACKAGE_ERROR=7]="PACKAGE_ERROR",a[a.APP_BLOCK_OR_DELETE=8]="APP_BLOCK_OR_DELETE",a[a.BLOCK=9]="BLOCK",a[a.TOKEN_EXPIRE=10]="TOKEN_EXPIRE",a[a.DEVICE_ERROR=11]="DEVICE_ERROR"}(a.ConnectionState||(a.ConnectionState={}));a.ConnectionState}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(){}return b.getInstance=function(){if(!b._instance)throw new Error("RongIMClient is not initialized. Call .init() method first.");return b._instance},b.init=function(c,d,e){b._instance||(b._instance=new b);var f="//",g="ws://";"file:"==document.location.protocol&&(f="http://"),"https:"==document.location.protocol&&(g="wss://");var h=!1;"function"!=typeof WebSocket&&(h=!0);var i=navigator.appVersion.split(";"),j=0;i.length>1&&(j=parseInt(i[1].replace(/[ ]/g,"").replace(/MSIE/g,""))),"object"==typeof localStorage?b._storageProvider=new a.LocalStorageProvider:j>4&&j<8?b._storageProvider=new a.UserDataProvider:b._storageProvider=new a.MemeoryProvider;var k=a.ObjectTools.buildOptions(e,{protobuf:f+"cdn.ronghub.com/protobuf-2.1.6.min.js","long":f+"cdn.ronghub.com/Long.js",byteBuffer:f+"cdn.ronghub.com/byteBuffer.js",navi:f+"nav.cn.ronghub.com",api:f+"api.cn.ronghub.com",emojiImage:f+"cdn.ronghub.com/css-sprite_bg-2.1.10.png",voiceLibamr:f+"cdn.ronghub.com/libamr-2.0.12.min.js",voicePCMdata:f+"cdn.ronghub.com/pcmdata-2.0.0.min.js",voiceSwfobjct:f+"cdn.ronghub.com/swfobject-2.0.0.min.js",voicePlaySwf:f+"cdn.ronghub.com/player-2.0.2.swf",callFile:f+"cdn.ronghub.com/AgoraRtcAgentSDK-1.4.2.js",isPolling:h,wsScheme:g,cookieValidity:1,protocol:f,openMp:!0,isPrivate:!1,postImageUrl:f+"upload.qiniu.com/putb64/-1",fileServer:f+"upload.qiniu.com",fileUploadURL:f+"cdn.ronghub.com/plupload.min.js",fileQNURL:f+"cdn.ronghub.com/qiniu2.2.4.js"},f);"https:"==document.location.protocol?(k.fileServer="https://"+(e&&e.fileServer||"upload.qiniu.com"),k.postImageUrl="https://"+(e&&e.postImageUrl||"upload.qiniu.com/putb64/-1")):(k.fileServer="http://"+(e&&e.fileServer||"upload.qiniu.com"),k.postImageUrl="https://"+(e&&e.postImageUrl||"upload.qiniu.com/putb64/-1"));var l=new a.FeaturePatcher;l.patchAll();var m={token:"",callback:null,hasModules:!0,global:window,lastReadTime:new a.LimitableMap,conversationList:[],appKey:c,publicServiceMap:new a.PublicServiceMap,providerType:1,deltaTime:0,filterMessages:[],isSyncRemoteConverList:!1,isUseWebSQLProvider:!1,otherDevice:!1,custStore:{},converStore:{latestMessage:{}},connectAckTime:0,voipStategy:0,isFirstPingMsg:!0,depend:k,listenerList:b._memoryStore.listenerList};b._memoryStore=m,d&&"[object Object]"==Object.prototype.toString.call(d)?b._dataAccessProvider=d:b._dataAccessProvider=new a.ServerDataProvider,b._dataAccessProvider.init(c),b._dataAccessProvider.setServerInfo({navi:location.protocol+k.navi+"/navi.xml"}),b.MessageParams={TextMessage:{objectName:"RC:TxtMsg",msgTag:new a.MessageTag((!0),(!0))},ImageMessage:{objectName:"RC:ImgMsg",msgTag:new a.MessageTag((!0),(!0))},DiscussionNotificationMessage:{objectName:"RC:DizNtf",msgTag:new a.MessageTag((!0),(!0))},VoiceMessage:{objectName:"RC:VcMsg",msgTag:new a.MessageTag((!0),(!0))},RichContentMessage:{objectName:"RC:ImgTextMsg",msgTag:new a.MessageTag((!0),(!0))},FileMessage:{objectName:"RC:FileMsg",msgTag:new a.MessageTag((!0),(!0))},HandshakeMessage:{objectName:"",msgTag:new a.MessageTag((!0),(!0))},UnknownMessage:{objectName:"",msgTag:new a.MessageTag((!0),(!0))},LocationMessage:{objectName:"RC:LBSMsg",msgTag:new a.MessageTag((!0),(!0))},InformationNotificationMessage:{objectName:"RC:InfoNtf",msgTag:new a.MessageTag((!0),(!0))},ContactNotificationMessage:{objectName:"RC:ContactNtf",msgTag:new a.MessageTag((!0),(!0))},ProfileNotificationMessage:{objectName:"RC:ProfileNtf",msgTag:new a.MessageTag((!0),(!0))},CommandNotificationMessage:{objectName:"RC:CmdNtf",msgTag:new a.MessageTag((!0),(!0))},PublicServiceRichContentMessage:{objectName:"RC:PSImgTxtMsg",msgTag:new a.MessageTag((!0),(!0))},PublicServiceMultiRichContentMessage:{objectName:"RC:PSMultiImgTxtMsg",msgTag:new a.MessageTag((!0),(!0))},JrmfReadPacketMessage:{objectName:"RCJrmf:RpMsg",msgTag:new a.MessageTag((!0),(!0))},JrmfReadPacketOpenedMessage:{objectName:"RCJrmf:RpOpendMsg",msgTag:new a.MessageTag((!0),(!0))},GroupNotificationMessage:{objectName:"RC:GrpNtf",msgTag:new a.MessageTag((!0),(!0))},CommandMessage:{objectName:"RC:CmdMsg",msgTag:new a.MessageTag((!1),(!1))},TypingStatusMessage:{objectName:"RC:TypSts",msgTag:new a.MessageTag((!1),(!1))},PublicServiceCommandMessage:{objectName:"RC:PSCmd",msgTag:new a.MessageTag((!1),(!1))},RecallCommandMessage:{objectName:"RC:RcCmd",msgTag:new a.MessageTag((!1),(!0))},SyncReadStatusMessage:{objectName:"RC:SRSMsg",msgTag:new a.MessageTag((!1),(!1))},ReadReceiptRequestMessage:{objectName:"RC:RRReqMsg",msgTag:new a.MessageTag((!1),(!1))},ReadReceiptResponseMessage:{objectName:"RC:RRRspMsg",msgTag:new a.MessageTag((!1),(!1))},ChangeModeResponseMessage:{objectName:"RC:CsChaR",msgTag:new a.MessageTag((!1),(!1))},ChangeModeMessage:{objectName:"RC:CSCha",msgTag:new a.MessageTag((!1),(!1))},EvaluateMessage:{objectName:"RC:CsEva",msgTag:new a.MessageTag((!1),(!1))},CustomerContact:{objectName:"RC:CsContact",msgTag:new a.MessageTag((!1),(!1))},HandShakeMessage:{objectName:"RC:CsHs",msgTag:new a.MessageTag((!1),(!1))},HandShakeResponseMessage:{objectName:"RC:CsHsR",msgTag:new a.MessageTag((!1),(!1))},SuspendMessage:{objectName:"RC:CsSp",msgTag:new a.MessageTag((!1),(!1))},TerminateMessage:{objectName:"RC:CsEnd",msgTag:new a.MessageTag((!1),(!1))},CustomerStatusUpdateMessage:{objectName:"RC:CsUpdate",msgTag:new a.MessageTag((!1),(!1))},ReadReceiptMessage:{objectName:"RC:ReadNtf",msgTag:new a.MessageTag((!1),(!1))}},b.MessageParams.AcceptMessage={objectName:"RC:VCAccept",msgTag:new a.MessageTag((!1),(!1))},b.MessageParams.RingingMessage={objectName:"RC:VCRinging",msgTag:new a.MessageTag((!1),(!1))},b.MessageParams.SummaryMessage={objectName:"RC:VCSummary",msgTag:new a.MessageTag((!1),(!1))},b.MessageParams.HungupMessage={objectName:"RC:VCHangup",msgTag:new a.MessageTag((!1),(!1))},b.MessageParams.InviteMessage={objectName:"RC:VCInvite",msgTag:new a.MessageTag((!1),(!1))},b.MessageParams.MediaModifyMessage={objectName:"RC:VCModifyMedia",msgTag:new a.MessageTag((!1),(!1))},b.MessageParams.MemberModifyMessage={objectName:"RC:VCModifyMem",msgTag:new a.MessageTag((!1),(!1))},b.MessageType={TextMessage:"TextMessage",ImageMessage:"ImageMessage",DiscussionNotificationMessage:"DiscussionNotificationMessage",VoiceMessage:"VoiceMessage",RichContentMessage:"RichContentMessage",HandshakeMessage:"HandshakeMessage",UnknownMessage:"UnknownMessage",LocationMessage:"LocationMessage",InformationNotificationMessage:"InformationNotificationMessage",ContactNotificationMessage:"ContactNotificationMessage",ProfileNotificationMessage:"ProfileNotificationMessage",CommandNotificationMessage:"CommandNotificationMessage",CommandMessage:"CommandMessage",TypingStatusMessage:"TypingStatusMessage",ChangeModeResponseMessage:"ChangeModeResponseMessage",ChangeModeMessage:"ChangeModeMessage",EvaluateMessage:"EvaluateMessage",HandShakeMessage:"HandShakeMessage",HandShakeResponseMessage:"HandShakeResponseMessage",SuspendMessage:"SuspendMessage",TerminateMessage:"TerminateMessage",CustomerContact:"CustomerContact",CustomerStatusUpdateMessage:"CustomerStatusUpdateMessage",SyncReadStatusMessage:"SyncReadStatusMessage",
ReadReceiptRequestMessage:"ReadReceiptRequestMessage",ReadReceiptResponseMessage:"ReadReceiptResponseMessage",FileMessage:"FileMessage",AcceptMessage:"AcceptMessage",RingingMessage:"RingingMessage",SummaryMessage:"SummaryMessage",HungupMessage:"HungupMessage",InviteMessage:"InviteMessage",MediaModifyMessage:"MediaModifyMessage",MemberModifyMessage:"MemberModifyMessage",JrmfReadPacketMessage:"JrmfReadPacketMessage",JrmfReadPacketOpenedMessage:"JrmfReadPacketOpenedMessage",GroupNotificationMessage:"GroupNotificationMessage"}},b.connect=function(c,d,e){a.CheckParam.getInstance().check(["string","object","string|null|object|global|undefined"],"connect",!0),b._dataAccessProvider.connect(c,d,e)},b.initApp=function(a,c){b.init(a.appkey,a.dataAccessProvider,a.opts),b.connect(a.token,{onSuccess:function(a){c(b._instance,a)},onTokenIncorrect:function(){throw new Error("token expired")},onError:function(a){}})},b.reconnect=function(a){b._dataAccessProvider.reconnect(a)},b.registerMessageType=function(a,c,d,e){b._dataAccessProvider.registerMessageType(a,c,d,e),b.RegisterMessage[a].messageName=a,b.MessageType[a]=a,b.MessageParams[a]={objectName:c,msgTag:d}},b.setConnectionStatusListener=function(a){b._dataAccessProvider?b._dataAccessProvider.setConnectionStatusListener(a):b._memoryStore.listenerList.push(a)},b.setOnReceiveMessageListener=function(a){b._dataAccessProvider?b._dataAccessProvider.setOnReceiveMessageListener(a):b._memoryStore.listenerList.push(a)},b.prototype.logout=function(){b._dataAccessProvider.logout()},b.prototype.disconnect=function(){b._dataAccessProvider.disconnect()},b.prototype.startCustomService=function(c,d,e){if(c&&d){var f;f="undefined"==typeof e?new a.HandShakeMessage:new a.HandShakeMessage({groupid:e});var g=this;a.RongIMClient._memoryStore.custStore.isInit=!0,b.getInstance().sendMessage(a.ConversationType.CUSTOMER_SERVICE,c,f,{onSuccess:function(a){a.isBlack?(d.onError(),g.stopCustomeService(c,{onSuccess:function(){},onError:function(){}})):d.onSuccess()},onError:function(){d.onError()}})}},b.prototype.stopCustomeService=function(c,d){if(c&&d){var e=b._memoryStore.custStore[c];if(e){var f=new a.SuspendMessage({sid:e.sid,uid:e.uid,pid:e.pid});this.sendCustMessage(c,f,{onSuccess:function(){setTimeout(function(){d.onSuccess()})},onError:function(){setTimeout(function(){d.onError()})}})}}},b.prototype.switchToHumanMode=function(c,d){if(c&&d){var e=b._memoryStore.custStore[c];if(e){var f=new a.ChangeModeMessage({sid:e.sid,uid:e.uid,pid:e.pid});this.sendCustMessage(c,f,d)}}},b.prototype.evaluateRebotCustomService=function(c,d,e,f){if(c&&f){var g=b._memoryStore.custStore[c];if(g){var h=new a.EvaluateMessage({sid:g.sid,uid:g.uid,pid:g.pid,isRobotResolved:d,sugest:e,type:0});this.sendCustMessage(c,h,f)}}},b.prototype.evaluateHumanCustomService=function(c,d,e,f){if(c&&f){var g=b._memoryStore.custStore[c];if(g){var h=new a.EvaluateMessage({sid:g.sid,uid:g.uid,pid:g.pid,humanValue:d,sugest:e,type:1});this.sendCustMessage(c,h,f)}}},b.prototype.sendCustMessage=function(c,d,e){b.getInstance().sendMessage(a.ConversationType.CUSTOMER_SERVICE,c,d,{onSuccess:function(a){e.onSuccess()},onError:function(){e.onError()}})},b.prototype.getCurrentConnectionStatus=function(){return a.Bridge._client.channel.connectionStatus},b.prototype.getConnectionChannel=function(){return a.Transportations._TransportType==a.Socket.XHR_POLLING?a.ConnectionChannel.XHR_POLLING:a.Transportations._TransportType==a.Socket.WEBSOCKET?a.ConnectionChannel.WEBSOCKET:void 0},b.prototype.getStorageProvider=function(){return 1==b._memoryStore.providerType?"ServerDataProvider":"OtherDataProvider"},b.prototype.setFilterMessages=function(a){"[object Array]"==Object.prototype.toString.call(a)&&(b._memoryStore.filterMessages=a)},b.prototype.getAgoraDynamicKey=function(c,d,e){a.CheckParam.getInstance().check(["number","string","object"],"getAgoraDynamicKey");var f=new Modules.VoipDynamicInput;f.setEngineType(c),f.setChannelName(d),b.bridge.queryMsg(32,a.MessageUtil.ArrayForm(f.toArrayBuffer()),a.Bridge._client.userId,e,"VoipDynamicOutput")},b.prototype.getCurrentUserId=function(){return a.Bridge._client.userId},b.prototype.getDeltaTime=function(){return b._dataAccessProvider.getDelaTime()},b.prototype.getMessage=function(a,c){b._dataAccessProvider.getMessage(a,c)},b.prototype.deleteLocalMessages=function(a,c,d,e){b._dataAccessProvider.removeLocalMessage(a,c,d,e)},b.prototype.updateMessage=function(a,c){b._dataAccessProvider.updateMessage(a,c)},b.prototype.clearMessages=function(a,c,d){b._dataAccessProvider.clearMessages(a,c,{onSuccess:function(a){setTimeout(function(){d.onSuccess(a)})},onError:function(a){setTimeout(function(){d.onError(a)})}})},b.prototype.clearMessagesUnreadStatus=function(a,c,d){b._dataAccessProvider.updateMessages(a,c,"readStatus",null,{onSuccess:function(a){setTimeout(function(){d.onSuccess(a)})},onError:function(a){setTimeout(function(){d.onError(a)})}})},b.prototype.deleteRemoteMessages=function(b,c,d,e){return a.CheckParam.getInstance().check(["number","string","array","object"],"deleteRemoteMessages"),0==d.length?void e.onError(a.ErrorCode.DELETE_MESSAGE_ID_IS_NULL):(d.length>100&&(d.length=100),void e.onSuccess(!0))},b.prototype.deleteMessages=function(a,c,d,e){b._dataAccessProvider.removeMessage(a,c,d,{onSuccess:function(a){setTimeout(function(){e.onSuccess(a)})},onError:function(a){setTimeout(function(){e.onError(a)})}})},b.prototype.sendLocalMessage=function(c,d){a.CheckParam.getInstance().check(["object","object"],"sendLocalMessage"),b._dataAccessProvider.updateMessage(c),this.sendMessage(c.conversationType,c.targetId,c.content,d)},b.prototype.sendMessage=function(c,d,e,f,g,h,i,j){a.CheckParam.getInstance().check(["number","string","object","object","undefined|object|null|global|boolean","undefined|object|null|global|string","undefined|object|null|global|string","undefined|object|null|global|number"],"sendMessage"),b._dataAccessProvider.sendMessage(c,d,e,f,g,h,i,j)},b.prototype.sendReceiptResponse=function(a,c,d){b._dataAccessProvider.sendReceiptResponse(a,c,d)},b.prototype.sendTypingStatusMessage=function(a,c,d,e){b._dataAccessProvider.sendTypingStatusMessage(a,c,d,e)},b.prototype.sendStatusMessage=function(a,b,c){throw new Error("Not implemented yet")},b.prototype.sendTextMessage=function(a,c,d,e){b._dataAccessProvider.sendTextMessage(a,c,d,e)},b.prototype.sendRecallMessage=function(a,c){b._dataAccessProvider.sendRecallMessage(a,c)},b.prototype.insertMessage=function(c,d,e,f,g){var h=new a.Message;h.conversationType=c,h.targetId=d,h.senderUserId=e,h.content=f,h.sentTime=+new Date,h.messageType=f.messageName,h.objectName=b.MessageParams[f.messageName].objectName,b._dataAccessProvider.addMessage(c,d,h,g)},b.prototype.getHistoryMessages=function(c,d,e,f,g,h){if(a.CheckParam.getInstance().check(["number","string","number|null|global|object","number","object","undefined|object|null|global|string"],"getHistoryMessages"),f>20)throw new Error("HistroyMessage count must be less than or equal to 20!");if(c.valueOf()<0)throw new Error("ConversationType must be greater than -1");b._dataAccessProvider.getHistoryMessages(c,d,e,f,g,h)},b.prototype.getRemoteHistoryMessages=function(c,d,e,f,g){return a.CheckParam.getInstance().check(["number","string","number|null|global|object","number","object"],"getRemoteHistoryMessages"),f>20?void g.onError(a.ErrorCode.RC_CONN_PROTO_VERSION_ERROR):c.valueOf()<0?void g.onError(a.ErrorCode.RC_CONN_PROTO_VERSION_ERROR):void b._dataAccessProvider.getRemoteHistoryMessages(c,d,e,f,g)},b.prototype.hasRemoteUnreadMessages=function(a,c){b._dataAccessProvider.hasRemoteUnreadMessages(a,c)},b.prototype.getTotalUnreadCount=function(a,c){b._dataAccessProvider.getTotalUnreadCount({onSuccess:function(b){setTimeout(function(){a.onSuccess(b)})},onError:function(b){setTimeout(function(){a.onError(b)})}},c)},b.prototype.getConversationUnreadCount=function(a,c){b._dataAccessProvider.getConversationUnreadCount(a,{onSuccess:function(a){setTimeout(function(){c.onSuccess(a)})},onError:function(a){setTimeout(function(){c.onError(a)})}})},b.prototype.getUnreadCount=function(a,c,d){b._dataAccessProvider.getUnreadCount(a,c,{onSuccess:function(a){setTimeout(function(){d.onSuccess(a)})},onError:function(a){setTimeout(function(){d.onError(a)})}})},b.prototype.clearUnreadCountByTimestamp=function(a,c,d,e){b._dataAccessProvider.clearUnreadCountByTimestamp(a,c,d,e)},b.prototype.clearUnreadCount=function(a,c,d){b._dataAccessProvider.clearUnreadCount(a,c,{onSuccess:function(a){setTimeout(function(){d.onSuccess(a)})},onError:function(a){setTimeout(function(){d.onError(a)})}})},b.prototype.clearLocalStorage=function(a){b._storageProvider.clearItem(),a()},b.prototype.setMessageExtra=function(a,c,d){b._dataAccessProvider.setMessageExtra(a,c,{onSuccess:function(a){setTimeout(function(){d.onSuccess(a)})},onError:function(a){setTimeout(function(){d.onError(a)})}})},b.prototype.setMessageReceivedStatus=function(a,c,d){b._dataAccessProvider.setMessageReceivedStatus(a,c,{onSuccess:function(a){setTimeout(function(){d.onSuccess(a)})},onError:function(a){setTimeout(function(){d.onError(a)})}})},b.prototype.setMessageSentStatus=function(a,c,d){b._dataAccessProvider.setMessageSentStatus(a,c,{onSuccess:function(a){setTimeout(function(){d.onSuccess(a)})},onError:function(a){setTimeout(function(){d.onError(a)})}})},b.prototype.clearTextMessageDraft=function(c,d){a.CheckParam.getInstance().check(["number","string","object"],"clearTextMessageDraft");var e="darf_"+c+"_"+d;return delete b._memoryStore[e],!0},b.prototype.getTextMessageDraft=function(c,d){if(a.CheckParam.getInstance().check(["number","string","object"],"getTextMessageDraft"),""==d||c<0)throw new Error("params error : "+a.ErrorCode.DRAF_GET_ERROR);var e="darf_"+c+"_"+d;return b._memoryStore[e]},b.prototype.saveTextMessageDraft=function(c,d,e){a.CheckParam.getInstance().check(["number","string","string","object"],"saveTextMessageDraft");var f="darf_"+c+"_"+d;return b._memoryStore[f]=e,!0},b.prototype.searchConversationByContent=function(a,c,d){b._dataAccessProvider.searchConversationByContent(a,c,d)},b.prototype.searchMessageByContent=function(a,c,d,e,f,g,h){b._dataAccessProvider.searchMessageByContent(a,c,d,e,f,g,h)},b.prototype.clearConversations=function(c){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];0==d.length&&(d=[a.ConversationType.CHATROOM,a.ConversationType.CUSTOMER_SERVICE,a.ConversationType.DISCUSSION,a.ConversationType.GROUP,a.ConversationType.PRIVATE,a.ConversationType.SYSTEM,a.ConversationType.PUBLIC_SERVICE,a.ConversationType.APP_PUBLIC_SERVICE]),b._dataAccessProvider.clearConversations(d,{onSuccess:function(a){setTimeout(function(){c.onSuccess(a)})},onError:function(a){setTimeout(function(){c.onError(a)})}})},b.prototype.getConversation=function(c,d,e){a.CheckParam.getInstance().check(["number","string","object"],"getConversation"),b._dataAccessProvider.getConversation(c,d,{onSuccess:function(a){setTimeout(function(){e.onSuccess(a)})},onError:function(a){setTimeout(function(){e.onError(a)})}})},b.prototype.pottingConversation=function(c){var d=this,e=!1;b._dataAccessProvider.getConversation(c.type,c.userId,{onSuccess:function(f){f?e=!0:f=new a.Conversation,f.conversationType=c.type,f.targetId=c.userId,f.latestMessage=a.MessageUtil.messageParser(c.msg),f.latestMessageId=f.latestMessage.messageId,f.objectName=f.latestMessage.objectName,f.receivedStatus=f.latestMessage.receivedStatus,f.receivedTime=f.latestMessage.receiveTime,f.sentStatus=f.latestMessage.sentStatus,f.sentTime=f.latestMessage.sentTime;var g=b._storageProvider.getItem("mentioneds_"+a.Bridge._client.userId+"_"+f.conversationType+"_"+f.targetId);if(g){var h=JSON.parse(g);f.mentionedMsg=h[c.type+"_"+c.userId]}if(!e)if(a.MessageUtil.supportLargeStorage()){var i=b._storageProvider.getItem("cu"+a.Bridge._client.userId+c.type+c.userId);f.unreadMessageCount=Number(i)}else f.unreadMessageCount=0;f.conversationType==a.ConversationType.DISCUSSION&&d.getDiscussion(c.userId,{onSuccess:function(a){f.conversationTitle=a.name},onError:function(a){}}),b._dataAccessProvider.addConversation(f,{onSuccess:function(a){}})},onError:function(a){}})},b.prototype.sortConversationList=function(a){for(var c=[],d=0,e=a.length;d<e;d++)if(a[d])if(a[d].isTop)c.push(a[d]),a.splice(d,1);else for(var f=0;f<e-d-1;f++)if(a[f].sentTime<a[f+1].sentTime){var g=a[f];a[f]=a[f+1],a[f+1]=g}return b._memoryStore.conversationList=c.concat(a)},b.prototype.getConversationList=function(c,d,e,f){a.CheckParam.getInstance().check(["object","null|array|object|global","number|undefined|null|object|global","boolean|undefined|null|object|global"],"getConversationList");b._dataAccessProvider.getConversationList({onSuccess:function(a){d||b._dataAccessProvider?setTimeout(function(){c.onSuccess(a)}):setTimeout(function(){c.onSuccess(b._memoryStore.conversationList)})},onError:function(b){b===a.ErrorCode.TIMEOUT?c.onError(b):c.onSuccess([])}},d,e,f)},b.prototype.getRemoteConversationList=function(c,d,e,f){a.CheckParam.getInstance().check(["object","null|array|object|global","number|undefined|null|object|global","boolean|undefined|null|object|global"],"getRemoteConversationList"),b._dataAccessProvider.getRemoteConversationList(c,d,e,f)},b.prototype.updateConversation=function(a){return b._dataAccessProvider.updateConversation(a)},b.prototype.createConversation=function(b,c,d){a.CheckParam.getInstance().check(["number","string","string"],"createConversation");var e=new a.Conversation;return e.targetId=c,e.conversationType=b,e.conversationTitle=d,e.latestMessage={},e.unreadMessageCount=0,e},b.prototype.removeConversation=function(c,d,e){a.CheckParam.getInstance().check(["number","string","object"],"removeConversation"),b._dataAccessProvider.removeConversation(c,d,e)},b.prototype.setConversationHidden=function(c,d,e){a.CheckParam.getInstance().check(["number","string","boolean"],"setConversationHidden"),b._dataAccessProvider.setConversationHidden(c,d,e)},b.prototype.setConversationToTop=function(c,d,e,f){a.CheckParam.getInstance().check(["number","string","boolean","object"],"setConversationToTop"),b._dataAccessProvider.setConversationToTop(c,d,e,{onSuccess:function(a){setTimeout(function(){f.onSuccess(a)})},onError:function(a){setTimeout(function(){f.onError(a)})}})},b.prototype.getConversationNotificationStatus=function(a,b,c){throw new Error("Not implemented yet")},b.prototype.setConversationNotificationStatus=function(a,b,c,d){throw new Error("Not implemented yet")},b.prototype.getNotificationQuietHours=function(a){throw new Error("Not implemented yet")},b.prototype.removeNotificationQuietHours=function(a){throw new Error("Not implemented yet")},b.prototype.setNotificationQuietHours=function(a,b,c){throw new Error("Not implemented yet")},b.prototype.addMemberToDiscussion=function(c,d,e){a.CheckParam.getInstance().check(["string","array","object"],"addMemberToDiscussion"),b._dataAccessProvider.addMemberToDiscussion(c,d,e)},b.prototype.createDiscussion=function(c,d,e){a.CheckParam.getInstance().check(["string","array","object"],"createDiscussion"),b._dataAccessProvider.createDiscussion(c,d,e)},b.prototype.getDiscussion=function(c,d){a.CheckParam.getInstance().check(["string","object"],"getDiscussion"),b._dataAccessProvider.getDiscussion(c,d)},b.prototype.quitDiscussion=function(c,d){a.CheckParam.getInstance().check(["string","object"],"quitDiscussion"),b._dataAccessProvider.quitDiscussion(c,d)},b.prototype.removeMemberFromDiscussion=function(c,d,e){a.CheckParam.getInstance().check(["string","string","object"],"removeMemberFromDiscussion"),b._dataAccessProvider.removeMemberFromDiscussion(c,d,e)},b.prototype.setDiscussionInviteStatus=function(c,d,e){a.CheckParam.getInstance().check(["string","number","object"],"setDiscussionInviteStatus"),b._dataAccessProvider.setDiscussionInviteStatus(c,d,e)},b.prototype.setDiscussionName=function(c,d,e){a.CheckParam.getInstance().check(["string","string","object"],"setDiscussionName"),b._dataAccessProvider.setDiscussionName(c,d,e)},b.prototype.joinGroup=function(c,d,e){a.CheckParam.getInstance().check(["string","string","object"],"joinGroup"),b._dataAccessProvider.joinGroup(c,d,e)},b.prototype.quitGroup=function(c,d){a.CheckParam.getInstance().check(["string","object"],"quitGroup"),b._dataAccessProvider.quitGroup(c,d)},b.prototype.syncGroup=function(c,d){a.CheckParam.getInstance().check(["array","object"],"syncGroup"),b._dataAccessProvider.syncGroup(c,d)},b.prototype.joinChatRoom=function(c,d,e){return a.CheckParam.getInstance().check(["string","number","object"],"joinChatRoom"),""==c?void setTimeout(function(){e.onError(a.ErrorCode.CHATROOM_ID_ISNULL)}):void b._dataAccessProvider.joinChatRoom(c,d,e)},b.prototype.setChatroomHisMessageTimestamp=function(c,d){a.CheckParam.getInstance().check(["string","number"],"setChatroomHisMessageTimestamp"),b._dataAccessProvider.setChatroomHisMessageTimestamp(c,d)},b.prototype.getChatRoomHistoryMessages=function(c,d,e,f){a.CheckParam.getInstance().check(["string","number","number","object"],"getChatRoomHistoryMessages"),b._dataAccessProvider.getChatRoomHistoryMessages(c,d,e,f)},b.prototype.getChatRoomInfo=function(c,d,e,f){a.CheckParam.getInstance().check(["string","number","number","object"],"getChatRoomInfo"),b._dataAccessProvider.getChatRoomInfo(c,d,e,f)},b.prototype.quitChatRoom=function(c,d){a.CheckParam.getInstance().check(["string","object"],"quitChatRoom"),b._dataAccessProvider.quitChatRoom(c,d)},b.prototype.getRemotePublicServiceList=function(c,d,e,f){if(b._memoryStore.depend.openMp){var g=new Modules.PullMpInput;e?g.setTime(b._memoryStore.lastReadTime.get(d+a.Bridge._client.userId)):g.setTime(0),g.setMpid(""),b.bridge.queryMsg(28,a.MessageUtil.ArrayForm(g.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(a){b._memoryStore.publicServiceMap.publicServiceList.length=0,b._memoryStore.publicServiceMap.publicServiceList=a},onError:function(){}},"PullMpOutput")}},b.prototype.getPublicServiceList=function(c){b._memoryStore.depend.openMp&&(a.CheckParam.getInstance().check(["object"],"getPublicServiceList"),c.onSuccess(b._memoryStore.publicServiceMap.publicServiceList))},b.prototype.getPublicServiceProfile=function(c,d,e){if(b._memoryStore.depend.openMp){a.CheckParam.getInstance().check(["number","string","object"],"getPublicServiceProfile");var f=b._memoryStore.publicServiceMap.get(c,d);e.onSuccess(f)}},b.prototype.pottingPublicSearchType=function(a,c){if(b._memoryStore.depend.openMp){var d=0;return 0==a?(d|=3,d|=0==c?12:48):1==a?(d|=1,d|=0==c?8:32):(d|=2,d|=0==a?4:16),d}},b.prototype.searchPublicService=function(c,d,e){if(b._memoryStore.depend.openMp){a.CheckParam.getInstance().check(["number","string","object"],"searchPublicService");var f=new Modules.SearchMpInput;f.setType(this.pottingPublicSearchType(0,c)),f.setId(d),b.bridge.queryMsg(29,a.MessageUtil.ArrayForm(f.toArrayBuffer()),a.Bridge._client.userId,e,"SearchMpOutput")}},b.prototype.searchPublicServiceByType=function(c,d,e,f){if(b._memoryStore.depend.openMp){a.CheckParam.getInstance().check(["number","number","string","object"],"searchPublicServiceByType");var g=c==a.ConversationType.APP_PUBLIC_SERVICE?2:1,h=new Modules.SearchMpInput;h.setType(this.pottingPublicSearchType(g,d)),h.setId(e),b.bridge.queryMsg(29,a.MessageUtil.ArrayForm(h.toArrayBuffer()),a.Bridge._client.userId,f,"SearchMpOutput")}},b.prototype.subscribePublicService=function(c,d,e){if(b._memoryStore.depend.openMp){a.CheckParam.getInstance().check(["number","string","object"],"subscribePublicService");var f=new Modules.MPFollowInput,g=this,h=c==a.ConversationType.APP_PUBLIC_SERVICE?"mcFollow":"mpFollow";f.setId(d),b.bridge.queryMsg(h,a.MessageUtil.ArrayForm(f.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(){g.getRemotePublicServiceList(null,null,null,{onSuccess:function(){},onError:function(){}}),e.onSuccess()},onError:function(){e.onError(a.ErrorCode.SUBSCRIBE_ERROR)}},"MPFollowOutput")}},b.prototype.unsubscribePublicService=function(c,d,e){if(b._memoryStore.depend.openMp){a.CheckParam.getInstance().check(["number","string","object"],"unsubscribePublicService");var f=new Modules.MPFollowInput,g=c==a.ConversationType.APP_PUBLIC_SERVICE?"mcUnFollow":"mpUnFollow";f.setId(d),b.bridge.queryMsg(g,a.MessageUtil.ArrayForm(f.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(){b._memoryStore.publicServiceMap.remove(c,d),e.onSuccess()},onError:function(){e.onError(a.ErrorCode.SUBSCRIBE_ERROR)}},"MPFollowOutput")}},b.prototype.addToBlacklist=function(c,d){a.CheckParam.getInstance().check(["string","object"],"addToBlacklist"),b._dataAccessProvider.addToBlacklist(c,d)},b.prototype.getBlacklist=function(c){a.CheckParam.getInstance().check(["object"],"getBlacklist"),b._dataAccessProvider.getBlacklist(c)},b.prototype.getBlacklistStatus=function(c,d){a.CheckParam.getInstance().check(["string","object"],"getBlacklistStatus"),b._dataAccessProvider.getBlacklistStatus(c,d)},b.prototype.removeFromBlacklist=function(c,d){a.CheckParam.getInstance().check(["string","object"],"removeFromBlacklist"),b._dataAccessProvider.removeFromBlacklist(c,d)},b.prototype.getFileToken=function(c,d){a.CheckParam.getInstance().check(["number","object"],"getQnTkn"),b._dataAccessProvider.getFileToken(c,d)},b.prototype.getFileUrl=function(c,d,e,f){a.CheckParam.getInstance().check(["number","string","string|global|object|null","object"],"getQnTkn"),b._dataAccessProvider.getFileUrl(c,d,e,f)},b.prototype.addRealTimeLocationListener=function(a,b,c){throw new Error("Not implemented yet")},b.prototype.getRealTimeLocation=function(a,b){throw new Error("Not implemented yet")},b.prototype.getRealTimeLocationCurrentState=function(a,b){throw new Error("Not implemented yet")},b.prototype.getRealTimeLocationParticipants=function(a,b){throw new Error("Not implemented yet")},b.prototype.joinRealTimeLocation=function(a,b){throw new Error("Not implemented yet")},b.prototype.quitRealTimeLocation=function(a,b){throw new Error("Not implemented yet")},b.prototype.startRealTimeLocation=function(a,b){throw new Error("Not implemented yet")},b.prototype.updateRealTimeLocationStatus=function(a,b,c,d){throw new Error("Not implemented yet")},b.prototype.startCall=function(c,d,e,f,g,h){a.CheckParam.getInstance().check(["number","string","array","number","string","object"],"startCall"),b._memoryStore.voipStategy?b._voipProvider.startCall(c,d,e,f,g,h):h.onError(a.ErrorCode.VOIP_NOT_AVALIABLE)},b.prototype.joinCall=function(c,d){a.CheckParam.getInstance().check(["number","object"],"joinCall"),b._memoryStore.voipStategy?b._voipProvider.joinCall(c,d):d.onError(a.ErrorCode.VOIP_NOT_AVALIABLE)},b.prototype.hungupCall=function(c,d,e){a.CheckParam.getInstance().check(["number","string","number"],"hungupCall"),b._memoryStore.voipStategy&&b._voipProvider.hungupCall(c,d,e)},b.prototype.changeMediaType=function(c,d,e,f){a.CheckParam.getInstance().check(["number","string","number","object"],"changeMediaType"),b._memoryStore.voipStategy?b._voipProvider.changeMediaType(c,d,e,f):f.onError(a.ErrorCode.VOIP_NOT_AVALIABLE)},b.prototype.getUnreadMentionedMessages=function(a,c){return b._dataAccessProvider.getUnreadMentionedMessages(a,c)},b.prototype.clearListeners=function(){b._dataAccessProvider.clearListeners()},b.prototype.getUserStatus=function(a,c){b._dataAccessProvider.getUserStatus(a,c)},b.prototype.setUserStatus=function(a,c){b._dataAccessProvider.setUserStatus(a,c)},b.prototype.subscribeUserStatus=function(a,c){b._dataAccessProvider.subscribeUserStatus(a,c)},b.prototype.setOnReceiveStatusListener=function(a){b._dataAccessProvider.setOnReceiveStatusListener(a)},b.MessageType={},b.RegisterMessage={},b._memoryStore={listenerList:[]},b.isNotPullMsg=!1,b}();if(a.RongIMClient=b,"function"==typeof require&&"object"==typeof module&&module&&module.id&&"object"==typeof exports&&exports)module.exports=a;else if("function"==typeof define&&define.amd){var c=(navigator.appName,navigator.appVersion),d=c.split(";"),e=!1;if(d.length>1){var f=parseInt(d[1].replace(/[ ]/g,"").replace(/MSIE/g,""));f<10&&(e=!0)}e?define("RongIMLib",["md5"],function(){return a}):define("RongIMLib",["md5"],function(){return a})}else window.RongIMClient=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){!function(a){a[a.AT_MOST_ONCE=0]="AT_MOST_ONCE",a[a.AT_LEAST_ONCE=1]="AT_LEAST_ONCE",a[a.EXACTLY_ONCE=2]="EXACTLY_ONCE",a[a.DEFAULT=3]="DEFAULT"}(a.Qos||(a.Qos={}));var b=a.Qos;!function(a){a[a.CONNECT=1]="CONNECT",a[a.CONNACK=2]="CONNACK",a[a.PUBLISH=3]="PUBLISH",a[a.PUBACK=4]="PUBACK",a[a.QUERY=5]="QUERY",a[a.QUERYACK=6]="QUERYACK",a[a.QUERYCON=7]="QUERYCON",a[a.SUBSCRIBE=8]="SUBSCRIBE",a[a.SUBACK=9]="SUBACK",a[a.UNSUBSCRIBE=10]="UNSUBSCRIBE",a[a.UNSUBACK=11]="UNSUBACK",a[a.PINGREQ=12]="PINGREQ",a[a.PINGRESP=13]="PINGRESP",a[a.DISCONNECT=14]="DISCONNECT"}(a.Type||(a.Type={}));var c=(a.Type,["invtDiz","crDiz","qnUrl","userInf","dizInf","userInf","joinGrp","quitDiz","exitGrp","evctDiz",["","ppMsgP","pdMsgP","pgMsgP","chatMsg","pcMsgP","","pmcMsgN","pmpMsgN"],"pdOpen","rename","uGcmpr","qnTkn","destroyChrm","createChrm","exitChrm","queryChrm","joinChrm","pGrps","addBlack","rmBlack","getBlack","blackStat","addRelation","qryRelation","delRelation","pullMp","schMp","qnTkn","qnUrl","qryVoipK","delMsg","qryCHMsg"]),d=function(){function b(c,d,f){if(this.connectionStatus=-1,this.delOnChangedCount=0,this.url=c.host+"/websocket?appId="+f.appId+"&token="+encodeURIComponent(f.token)+"&sdkVer="+f.sdkVer+"&apiVer="+f.apiVer,this.self=f,this.socket=e.getInstance().createServer(),this.socket.connect(this.url,d),!("object"==typeof b._ConnectionStatusListener&&"onChanged"in b._ConnectionStatusListener))throw new Error("setConnectStatusListener:Parameter format is incorrect");var h=this;h.socket.on("StatusChanged",function(c){if(h.connectionStatus=c,c===a.ConnectionStatus.NETWORK_UNAVAILABLE){var d=a.RongIMClient._storageProvider.getItemKey("navi"),e=a.RongIMClient._storageProvider.getItem(d),i=e.split(",")[0].split(":")[1];if(i&&i.length<4||a.RongIMClient._storageProvider.setItem("rongSDK",""),!a.RongIMClient._memoryStore.depend.isPolling&&i&&i.length<4){g._client.handler.connectCallback.pauseTimer();var d=a.RongIMClient._storageProvider.getItemKey("navi"),j=a.RongIMClient._storageProvider.getItem("RongBackupServer");if(j){var k=j.split(",");if(k.length<2)throw new Error("navi server is empty,postion:StatusChanged");a.RongIMClient._storageProvider.setItem(d,a.RongIMClient._storageProvider.getItem("RongBackupServer"));var l=a.Bridge._client.channel.socket.currentURL;g._client.channel.socket.currentURL=k[0]+l.substring(l.indexOf("/"),l.length),g._client.channel&&g._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTED&&g._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTING&&a.RongIMClient.connect(a.RongIMClient._memoryStore.token,a.RongIMClient._memoryStore.callback)}}}return c!==a.ConnectionStatus.DISCONNECTED||a.RongIMClient._memoryStore.otherDevice?void(c===a.ConnectionStatus.DISCONNECTED&&a.RongIMClient._memoryStore.otherDevice||(b._ConnectionStatusListener.onChanged(c),a.RongIMClient._memoryStore.otherDevice&&(h.delOnChangedCount>5&&delete b._ConnectionStatusListener.onChanged,h.delOnChangedCount++))):(b._ConnectionStatusListener.onChanged(a.ConnectionStatus.DISCONNECTED),void f.clearHeartbeat())}),this.socket.on("message",f.handler.handleMessage),this.socket.on("disconnect",function(a){f.channel.socket.fire("StatusChanged",a?a:2)})}return b.prototype.writeAndFlush=function(a){this.socket.send(a)},b.prototype.reconnect=function(b){a.MessageIdHandler.clearMessageId(),this.socket=this.socket.reconnect(),b&&(this.self.reconnectObj=b)},b.prototype.disconnect=function(a){this.socket.disconnect(a)},b}();a.Channel=d;var e=function(){function b(){this.socket=null,this._events={}}return b.getInstance=function(){return new b},b.prototype.connect=function(b,c){return this.socket&&(b&&(a.RongIMClient._storageProvider.setItem("rongSDK",this.checkTransport()),this.on("connect",c||new Function)),b&&(this.currentURL=b),this.socket.createTransport(b)),this},b.prototype.createServer=function(){var a=this.getTransport(this.checkTransport());if(null===a)throw new Error("the channel was not supported");return a},b.prototype.getTransport=function(c){return c==b.XHR_POLLING?this.socket=new a.PollingTransportation(this):c==b.WEBSOCKET&&(this.socket=new a.SocketTransportation(this)),this},b.prototype.send=function(a){this.socket&&(this.checkTransport()==b.WEBSOCKET?this.socket.send(a):this.socket.send(this._encode(a)))},b.prototype.onMessage=function(a){this.fire("message",a)},b.prototype.disconnect=function(b){return a.ConnectionStatus.KICKED_OFFLINE_BY_OTHER_CLIENT===b&&(a.RongIMClient._memoryStore.otherDevice=!0),this.socket.disconnect(b),this.fire("disconnect",b),this},b.prototype.reconnect=function(){if(this.currentURL&&a.RongIMClient._storageProvider.getItem("rongSDK"))return this.connect(this.currentURL,null);throw new Error("reconnect:no have URL")},b.prototype.checkTransport=function(){return a.RongIMClient._memoryStore.depend.isPolling&&(a.Transportations._TransportType=b.XHR_POLLING),a.Transportations._TransportType},b.prototype.fire=function(a,b){if(a in this._events)for(var c=0,d=this._events[a].length;c<d;c++)this._events[a][c](b);return this},b.prototype.on=function(b,c){return"function"==typeof c&&b?(b in this._events?a.MessageUtil.indexOf(this._events,c)==-1&&this._events[b].push(c):this._events[b]=[c],this):this},b.prototype.removeEvent=function(a,b){if(a in this._events)for(var c=0,d=this._events[a].length;c<d;c++)this._events[a][c]==b&&this._events[a].splice(c,1);return this},b.prototype._encode=function(b){var c="?messageid="+b.getMessageId()+"&header="+b.getHeaderFlag()+"&sessionid="+a.RongIMClient._storageProvider.getItem("sId"+a.Navigation.Endpoint.userId);return/(PubAckMessage|QueryConMessage)/.test(b._name)||(c+="&topic="+b.getTopic()+"&targetid="+(b.getTargetId()||"")),{url:c,data:"getData"in b?b.getData():""}},b.XHR_POLLING="xhr-polling",b.WEBSOCKET="websocket",b}();a.Socket=e;var f=function(){function c(a,b){this.timeoutMillis=1e5,this.timeout_=0,this.sdkVer="2.2.5",this.apiVer=Math.floor(1e6*Math.random()),this.channel=null,this.handler=null,this.userId="",this.reconnectObj={},this.heartbeat=0,this.pullMsgHearbeat=0,this.chatroomId="",this.SyncTimeQueue=[],this.cacheMessageIds=[],this.token=a,this.appId=b,this.SyncTimeQueue.state="complete"}return c.prototype.resumeTimer=function(){this.timeout_||(this.timeout_=setTimeout(function(){if(this.timeout_){try{this.channel.disconnect()}catch(a){throw new Error(a)}clearTimeout(this.timeout_),this.timeout_=0,this.channel.reconnect(),this.channel.socket.fire("StatusChanged",5)}},this.timeoutMillis))},c.prototype.pauseTimer=function(){this.timeout_&&(clearTimeout(this.timeout_),this.timeout_=0)},c.prototype.connect=function(b){if(a.Navigation.Endpoint.host){if(a.Transportations._TransportType==e.WEBSOCKET&&!window.WebSocket)return void b.onError(a.ConnectionState.UNACCEPTABLE_PROTOCOL_VERSION);this.handler=new h(this),this.handler.setConnectCallback(b);var c=this;this.channel=new d(a.Navigation.Endpoint,function(){a.Transportations._TransportType==e.WEBSOCKET&&c.keepLive()},this),this.channel.socket.fire("StatusChanged",1)}else b.onError(a.ConnectionState.NOT_AUTHORIZED)},c.prototype.checkSocket=function(b){var c=this;c.channel.writeAndFlush(new a.PingReqMessage);var d=setInterval(function(){a.RongIMClient._memoryStore.isFirstPingMsg?e>15&&(clearInterval(d),b.onError()):(b.onSuccess(),clearInterval(d)),e++},200),e=0},c.prototype.keepLive=function(){this.heartbeat>0&&clearInterval(this.heartbeat);var b=this;b.heartbeat=setInterval(function(){b.resumeTimer(),b.channel.writeAndFlush(new a.PingReqMessage)},3e4),b.pullMsgHearbeat>0&&clearInterval(b.pullMsgHearbeat),b.pullMsgHearbeat=setInterval(function(){b.syncTime(!0,void 0,void 0,!1)},18e4)},c.prototype.clearHeartbeat=function(){clearInterval(this.heartbeat),this.heartbeat=0,this.pauseTimer(),clearInterval(this.pullMsgHearbeat),
this.pullMsgHearbeat=0},c.prototype.publishMessage=function(c,d,e,f,g){var h=a.MessageIdHandler.messageIdPlus(this.channel.reconnect);if(h){var i=new a.PublishMessage(c,d,e);i.setMessageId(h),f?(i.setQos(b.AT_LEAST_ONCE),this.handler.putCallback(new a.PublishCallback(f.onSuccess,f.onError),i.getMessageId(),g)):i.setQos(b.AT_MOST_ONCE),this.channel.writeAndFlush(i)}},c.prototype.queryMessage=function(b,d,e,f,g,h){if("userInf"==b&&c.userInfoMapping[e])return void g.onSuccess(c.userInfoMapping[e]);var i=a.MessageIdHandler.messageIdPlus(this.channel.reconnect);if(i){var j=new a.QueryMessage(b,d,e);j.setMessageId(i),j.setQos(f),this.handler.putCallback(new a.QueryCallback(g.onSuccess,g.onError),j.getMessageId(),h),this.channel.writeAndFlush(j)}},c.prototype.invoke=function(c,d,e){var f,h,i,j,k=this,l=this.SyncTimeQueue.shift();if(void 0!=l){if(this.SyncTimeQueue.state="pending",2!=l.type)f=a.RongIMClient._storageProvider.getItem(this.userId)||"0",h=new Modules.SyncRequestMsg,h.setIspolling(!1),i="pullMsg",j=this.userId;else if(j=d||k.chatroomId,f=a.RongIMClient._memoryStore.lastReadTime.get(j+g._client.userId+"CST")||0,h=new Modules.ChrmPullMsg,h.setCount(0),i="chrmPull",!j)throw new Error("syncTime:Received messages of chatroom but was not init");if(l.pulltime<=f)return this.SyncTimeQueue.state="complete",void this.invoke(c,j);c&&"setIsPullSend"in h&&h.setIsPullSend(!0),h.setSyncTime(f),this.queryMessage(i,a.MessageUtil.ArrayForm(h.toArrayBuffer()),j,b.AT_LEAST_ONCE,{onSuccess:function(b){var d=a.MessageUtil.int64ToTimestamp(b.syncTime),f=j;if("chrmPull"==i)f+=g._client.userId+"CST",a.RongIMClient._memoryStore.lastReadTime.set(f,d);else{var h=a.RongIMClient._storageProvider;d>h.getItem(f)&&h.setItem(f,d)}e&&(a.RongIMClient._memoryStore.isSyncRemoteConverList=!0),k.SyncTimeQueue.state="complete",k.invoke(c,j);for(var l=b.list,m=0,n=l.length,o=n;m<n;m++)if(!(l[m].msgId in k.cacheMessageIds)){g._client.handler.onReceived(l[m],void 0,e,--o);var p=k.cacheMessageIds.unshift(l[m].msgId);p>20&&(k.cacheMessageIds.length=20)}},onError:function(a){k.SyncTimeQueue.state="complete",k.invoke(c,j)}},"DownStreamMessages")}},c.prototype.syncTime=function(a,b,c,d){this.SyncTimeQueue.push({type:a,pulltime:b}),1==this.SyncTimeQueue.length&&"complete"==this.SyncTimeQueue.state&&this.invoke(!a,c,d)},c.prototype.__init=function(b){this.channel=new d(a.Navigation.Endpoint,b,this)},c.userInfoMapping={},c}();a.Client=f;var g=function(){function e(){}return e.getInstance=function(){return new e},e.prototype.connect=function(b,c,d){return window.Modules?(e._client=(new a.Navigation).connect(b,c,d),e._client):void(a.RongIMClient._memoryStore.hasModules=!1)},e.prototype.setListener=function(a){"object"==typeof a&&("function"==typeof a.onChanged?d._ConnectionStatusListener=a:"function"==typeof a.onReceived&&(d._ReceiveMessageListener=a))},e.prototype.reconnect=function(a){e._client.channel.reconnect(a)},e.prototype.disconnect=function(){e._client.clearHeartbeat(),e._client.channel.disconnect(2)},e.prototype.queryMsg=function(a,d,f,g,h){"string"!=typeof a&&(a=c[a]),e._client.queryMessage(a,d,f,b.AT_MOST_ONCE,g,h)},e.prototype.pubMsg=function(b,d,f,g,h,i){"number"==typeof i?i==a.MethodType.CUSTOMER_SERVICE?e._client.publishMessage("pcuMsgP",d,f,g,h):i==a.MethodType.RECALL&&e._client.publishMessage("recallMsg",d,f,g,h):e._client.publishMessage(c[10][b],d,f,g,h)},e}();a.Bridge=g;var h=function(){function b(a){if(this.map={},this.connectCallback=null,!d._ReceiveMessageListener)throw new Error("please set onReceiveMessageListener");this._onReceived=d._ReceiveMessageListener.onReceived,this._client=a,this.syncMsgMap=new Object}return b.prototype.putCallback=function(a,b,c){var d={Callback:a,Message:c};d.Callback.resumeTimer(),this.map[b]=d},b.prototype.setConnectCallback=function(b){b&&(this.connectCallback=new a.ConnectAck(b.onSuccess,b.onError,this._client),this.connectCallback.resumeTimer())},b.prototype.onReceived=function(b,c,d,e){var f,h;if("PublishMessage"!=b._name)f=b,a.RongIMClient._storageProvider.setItem(this._client.userId,a.MessageUtil.int64ToTimestamp(f.dataTime));else{if("s_ntf"==b.getTopic())return f=Modules.NotifyMsg.decode(b.getData()),void this._client.syncTime(f.type,a.MessageUtil.int64ToTimestamp(f.time),f.chrmId);if("s_msg"==b.getTopic()){f=Modules.DownStreamMessage.decode(b.getData());var i=a.MessageUtil.int64ToTimestamp(f.dataTime);a.RongIMClient._storageProvider.setItem(this._client.userId,i),a.RongIMClient._memoryStore.lastReadTime.get(this._client.userId,i)}else{if(g._client.sdkVer&&"1.0.0"==g._client.sdkVer)return;f=Modules.UpStreamMessage.decode(b.getData());var j=b.getTopic(),k=j.substr(0,2);"pp"==k?f.type=1:"pd"==k?f.type=2:"pg"==k?f.type=3:"ch"==k?f.type=4:"pc"==k&&(f.type=5),f.groupId=b.getTargetId(),f.fromUserId=this._client.userId,f.dataTime=Date.parse((new Date).toString())}if(!f)return}if(h=a.MessageUtil.messageParser(f,this._onReceived,d),c&&(h.messageUId=c.getMessageUId(),h.sentTime=c.getTimestamp()),null!==h){var l="converST_"+g._client.userId+h.conversationType+h.targetId,m=a.RongIMClient._memoryStore.lastReadTime.get(l);if(m){if(!(h.sentTime>m))return;a.RongIMClient._memoryStore.lastReadTime.set(l,h.sentTime)}else a.RongIMClient._memoryStore.lastReadTime.set(l,h.sentTime);if(3==a.RongIMClient.MessageParams[h.messageType].msgTag.getMessageTag()&&a.RongIMClient._dataAccessProvider.getConversation(h.conversationType,h.targetId,{onSuccess:function(b){if(b||(b=a.RongIMClient.getInstance().createConversation(h.conversationType,h.targetId,"")),h.messageDirection==a.MessageDirection.RECEIVE&&64==(64&f.status)){var c=a.RongIMClient._storageProvider.getItem("mentioneds_"+g._client.userId+"_"+h.conversationType+"_"+h.targetId),d=h.conversationType+"_"+h.targetId,e={};if(h.content&&h.content.mentionedInfo&&(e[d]={uid:h.messageUId,time:h.sentTime,mentionedInfo:h.content.mentionedInfo},a.RongIMClient._storageProvider.setItem("mentioneds_"+g._client.userId+"_"+h.conversationType+"_"+h.targetId,JSON.stringify(e)),c=JSON.stringify(e)),c){var e=JSON.parse(c);b.mentionedMsg=e[d]}}if(0!=b.conversationType&&h.senderUserId!=g._client.userId&&h.receivedStatus!=a.ReceivedStatus.RETRIEVED&&h.messageType!=a.RongIMClient.MessageType.ReadReceiptRequestMessage&&h.messageType!=a.RongIMClient.MessageType.ReadReceiptResponseMessage&&(b.unreadMessageCount=b.unreadMessageCount+1,a.MessageUtil.supportLargeStorage())){var i=a.RongIMClient._storageProvider.getItem("cu"+g._client.userId+b.conversationType+b.targetId);a.RongIMClient._storageProvider.setItem("cu"+g._client.userId+b.conversationType+h.targetId,Number(i)+1)}b.receivedTime=(new Date).getTime(),b.receivedStatus=a.ReceivedStatus.UNREAD,h.receivedStatus=a.ReceivedStatus.UNREAD,b.senderUserId=h.sendUserId,b.notificationStatus=a.ConversationNotificationStatus.DO_NOT_DISTURB,b.latestMessageId=h.messageId,b.latestMessage=h,b.sentTime=h.sentTime,a.RongIMClient._dataAccessProvider.addConversation(b,{onSuccess:function(a){},onError:function(){}})},onError:function(a){}}),h.conversationType!=a.ConversationType.CUSTOMER_SERVICE||"ChangeModeResponseMessage"!=h.messageType&&"SuspendMessage"!=h.messageType&&"HandShakeResponseMessage"!=h.messageType&&"TerminateMessage"!=h.messageType&&"CustomerStatusUpdateMessage"!=h.messageType&&"TextMessage"!=h.messageType&&"InformationNotificationMessage"!=h.messageType||a.RongIMClient._memoryStore.custStore.isInit){if(h.conversationType==a.ConversationType.CUSTOMER_SERVICE&&"HandShakeResponseMessage"!=h.messageType){if(!a.RongIMClient._memoryStore.custStore[h.targetId])return;if("TerminateMessage"==h.messageType&&a.RongIMClient._memoryStore.custStore[h.targetId].sid!=h.content.sid)return}if(h.messageType===a.RongIMClient.MessageType.HandShakeResponseMessage){var n=h.content.data;a.RongIMClient._memoryStore.custStore[h.targetId]=n,n.serviceType!=a.CustomerType.ONLY_HUMAN&&n.serviceType!=a.CustomerType.HUMAN_FIRST||"1"==n.notAutoCha&&a.RongIMClient.getInstance().switchToHumanMode(h.targetId,{onSuccess:function(){},onError:function(){}})}var o=new Date,p=o.getMonth()+1,q=o.getFullYear()+"/"+(1==p.toString().length?"0"+p:p)+"/"+o.getDate(),r=new Date(q).getTime()-h.sentTime<0;if(a.MessageUtil.supportLargeStorage()&&h.messageType===a.RongIMClient.MessageType.ReadReceiptRequestMessage&&r&&h.messageDirection==a.MessageDirection.SEND){var s=g._client.userId+h.content.messageUId+"SENT";a.RongIMClient._storageProvider.setItem(s,JSON.stringify({count:0,dealtime:h.sentTime,userIds:{}}))}else if(a.MessageUtil.supportLargeStorage()&&h.messageType===a.RongIMClient.MessageType.ReadReceiptRequestMessage&&r){var t=g._client.userId+h.conversationType+h.targetId+"RECEIVED",u=JSON.parse(a.RongIMClient._storageProvider.getItem(t));if(u)if(h.senderUserId in u){if(!u[h.senderUserId].uIds||!u[h.senderUserId].uIds||u[h.senderUserId].uIds.indexOf(h.content.messageUId)!=-1)return;new Date(q).getTime()-u[h.senderUserId].dealtime<0||(u[h.senderUserId].uIds.length=0),u[h.senderUserId].uIds.push(h.content.messageUId),u[h.senderUserId].dealtime=h.sentTime,u[h.senderUserId].isResponse=!1,a.RongIMClient._storageProvider.setItem(t,JSON.stringify(u))}else{var v={uIds:[h.content.messageUId],dealtime:h.sentTime,isResponse:!1};u[h.senderUserId]=v,a.RongIMClient._storageProvider.setItem(t,JSON.stringify(u))}else{var w={};w[h.senderUserId]={uIds:[h.content.messageUId],dealtime:h.sentTime,isResponse:!1},a.RongIMClient._storageProvider.setItem(t,JSON.stringify(w))}}if(a.MessageUtil.supportLargeStorage()&&h.messageType===a.RongIMClient.MessageType.ReadReceiptResponseMessage&&r){var x,y=h.content,z=y.receiptMessageDic[g._client.userId],s="";if(h.receiptResponse||(h.receiptResponse={}),z){for(var A=[],B=0,C=z.length;B<C;B++)s=g._client.userId+z[B]+"SENT",x=JSON.parse(a.RongIMClient._storageProvider.getItem(s)),!x||h.senderUserId in x.userIds||(new Date(q).getTime()-x.dealtime>0?a.RongIMClient._storageProvider.removeItem(s):(A.push(z[B]),x.count+=1,x.userIds[h.senderUserId]=h.sentTime,h.receiptResponse[z[B]]=x.count,a.RongIMClient._storageProvider.setItem(s,JSON.stringify(x))));y.receiptMessageDic[g._client.userId]=A,h.content=y}}var D=this;if(a.RongIMClient._voipProvider&&["AcceptMessage","RingingMessage","HungupMessage","InviteMessage","MediaModifyMessage","MemberModifyMessage"].indexOf(h.messageType)>-1)a.RongIMClient._voipProvider.onReceived(h);else{var E=e||0;a.RongIMClient._dataAccessProvider.addMessage(h.conversationType,h.targetId,h,{onSuccess:function(a){D._onReceived(a,E)},onError:function(a){D._onReceived(h,E)}})}}}},b.prototype.handleMessage=function(b){if(b)switch(b._name){case"ConnAckMessage":g._client.handler.connectCallback.process(b.getStatus(),b.getUserId(),b.getTimestamp());break;case"PublishMessage":b.getSyncMsg()||0==b.getQos()||g._client.channel.writeAndFlush(new a.PubAckMessage(b.getMessageId())),b.getSyncMsg()&&!a.RongIMClient._memoryStore.depend.isPolling?g._client.handler.syncMsgMap[b.getMessageId()]=b:g._client.handler.onReceived(b);break;case"QueryAckMessage":0!=b.getQos()&&g._client.channel.writeAndFlush(new a.QueryConMessage(b.getMessageId()));var c=g._client.handler.map[b.getMessageId()];c&&(c.Callback.process(b.getStatus(),b.getData(),b.getDate(),c.Message),delete g._client.handler.map[b.getMessageId()]);break;case"PubAckMessage":var d=g._client.handler.map[b.getMessageId()];d?(d.Callback.process(b.getStatus()||0,b.getMessageUId(),b.getTimestamp(),d.Message,b.getMessageId()),delete g._client.handler.map[b.getMessageId()]):(g._client.handler.onReceived(g._client.handler.syncMsgMap[b.messageId],b),delete g._client.handler.syncMsgMap[b.getMessageId()]);break;case"PingRespMessage":a.RongIMClient._memoryStore.isFirstPingMsg?a.RongIMClient._memoryStore.isFirstPingMsg=!1:g._client.pauseTimer();break;case"DisconnectMessage":g._client.channel.disconnect(b.getStatus())}},b}();a.MessageHandler=h}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(a){this.timeout=null,this.onError=null,a&&"number"==typeof a?this.timeoutMillis=a:(this.timeoutMillis=3e4,this.onError=a)}return b.prototype.resumeTimer=function(){var a=this;this.timeoutMillis>0&&!this.timeout&&(this.timeout=setTimeout(function(){a.readTimeOut(!0)},this.timeoutMillis))},b.prototype.pauseTimer=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},b.prototype.readTimeOut=function(b){b&&this.onError?this.onError(a.ErrorCode.TIMEOUT):this.pauseTimer()},b}();a.MessageCallback=b;var c=function(){function b(){this.publicServiceList=[]}return b.getInstance=function(){return new b},b.prototype.pottingProfile=function(b){var c;this.profile=new a.PublicServiceProfile,c=JSON.parse(b.extra),this.profile.isGlobal=c.isGlobal,this.profile.introduction=c.introduction,this.profile.menu=c.menu,this.profile.hasFollowed=c.follow,this.profile.publicServiceId=b.mpid,this.profile.name=b.name,this.profile.portraitUri=b.portraitUrl,this.profile.conversationType="mc"==b.type?a.ConversationType.APP_PUBLIC_SERVICE:a.ConversationType.PUBLIC_SERVICE,this.publicServiceList.push(this.profile)},b.prototype.mapping=function(b,c){switch(c){case"GetUserInfoOutput":var d=new a.UserInfo(b.userId,b.userName,b.userPortrait);return d;case"GetQNupTokenOutput":return{deadline:a.MessageUtil.int64ToTimestamp(b.deadline),token:b.token};case"GetQNdownloadUrlOutput":return{downloadUrl:b.downloadUrl};case"CreateDiscussionOutput":return b.id;case"ChannelInfoOutput":var e=new a.Discussion;return e.creatorId=b.adminUserId,e.id=b.channelId,e.memberIdList=b.firstTenUserIds,e.name=b.channelName,e.isOpen=b.openStatus,e;case"GroupHashOutput":return b.result;case"QueryBlackListOutput":return b.userIds;case"SearchMpOutput":case"PullMpOutput":if(b.info){var f=this;Array.forEach(b.info,function(a){setTimeout(f.pottingProfile(a),100)})}return this.publicServiceList;default:return b}},b}();a.CallbackMapping=c;var d=function(c){function d(a,b){c.call(this,b),this._cb=a,this._timeout=b}return __extends(d,c),d.prototype.process=function(b,c,d,e,f){this.readTimeOut(),0==b?(e&&(e.setSentStatus=b),a.RongIMClient._storageProvider.setItem(a.Bridge._client.userId,d),a.RongIMClient._memoryStore.lastReadTime.get(a.Bridge._client.userId,d),this._cb({messageUId:c,timestamp:d,messageId:f})):this._timeout(b)},d.prototype.readTimeOut=function(a){b.prototype.readTimeOut.call(this,a)},d}(b);a.PublishCallback=d;var e=function(d){function e(a,b){d.call(this,b),this._cb=a,this._timeout=b}return __extends(e,d),e.prototype.process=function(b,d,e,f){if(this.readTimeOut(),f&&d&&0==b){try{d=c.getInstance().mapping(Modules[f].decode(d),f)}catch(g){return void this._timeout(a.ErrorCode.UNKNOWN)}"GetUserInfoOutput"==f&&(a.Client.userInfoMapping[d.userId]=d),this._cb(d)}else b>0?this._timeout(b):this._cb(b)},e.prototype.readTimeOut=function(a){b.prototype.readTimeOut.call(this,a)},e}(b);a.QueryCallback=e;var f=function(c){function d(a,b,d){c.call(this,b),this._client=d,this._cb=a,this._timeout=b}return __extends(d,c),d.prototype.process=function(b,c,d){if(this.readTimeOut(),0==b){if(a.RongIMClient._memoryStore.depend.isPrivate){var e,f=new Date,g=f.getFullYear()+""+(f.getMonth()+1)+f.getDate();if(e=a.MessageUtil.supportLargeStorage()?a.RongIMClient._storageProvider.getItem("RongQryOpt"+g):a.RongIMClient._storageProvider.getItem("RongQryOpt"+g),!e){var h=new Modules.GetUserInfoInput;h.setNothing(0),a.RongIMClient.bridge.queryMsg("qryCfg",a.MessageUtil.ArrayForm(h.toArrayBuffer()),c,{onSuccess:function(b){if(b){var c=a.RongIMClient._memoryStore.depend.navi.split("//");new a.RongAjax({url:"https://stats.cn.ronghub.com/active.json",appKey:a.RongIMClient._memoryStore.appKey,deviceId:Math.floor(1e4*Math.random()),timestamp:(new Date).getTime(),deviceInfo:"",type:1,privateInfo:{code:encodeURIComponent(b.name),ip:a.RongIMClient._storageProvider._host,customId:b.id,nip:c.length>1?c[1]:""}}).send(function(){e=a.MessageUtil.supportLargeStorage()?a.RongIMClient._storageProvider.setItem("RongQryOpt"+g,g):a.RongIMClient._storageProvider.setItem("RongQryOpt"+g,g)})}},onError:function(){}},"GroupInfo")}}var i=a.RongIMClient._storageProvider.getItem(a.RongIMClient._storageProvider.getItemKey("navi")),j=a.RongIMClient._storageProvider.getItemKey("navi"),k=decodeURIComponent(i).split(",");k[1]||(i=encodeURIComponent(i)+c,a.RongIMClient._storageProvider.setItem(j,i)),a.RongIMClient._memoryStore.isUseWebSQLProvider&&a.RongIMClient._dataAccessProvider.database.init(c),this._client.userId=c;var l=this,m=a.RongIMClient._storageProvider.getItemKey("navi"),n=a.RongIMClient._storageProvider.getItem(m),o=n.split(",")[0].split(":")[1];if(!a.RongIMClient._memoryStore.depend.isPolling&&a.RongIMClient._memoryStore.isFirstPingMsg&&o.length<4?a.Bridge._client.checkSocket({onSuccess:function(){a.RongIMClient.isNotPullMsg||l._client.syncTime(void 0,void 0,void 0,!0)},onError:function(){a.RongIMClient._memoryStore.isFirstPingMsg=!1,a.RongIMClient.getInstance().disconnect();var b=a.RongIMClient._storageProvider.getItemKey("navi"),c=a.RongIMClient._storageProvider.getItem("RongBackupServer"),d=c.split(",");if(d.length<2)throw new Error("navi server is empty");a.RongIMClient._storageProvider.setItem(b,a.RongIMClient._storageProvider.getItem("RongBackupServer"));var e=a.Bridge._client.channel.socket.currentURL;a.Bridge._client.channel.socket.currentURL=d[0]+e.substring(e.indexOf("/"),e.length),a.RongIMClient.connect(a.RongIMClient._memoryStore.token,a.RongIMClient._memoryStore.callback)}}):a.RongIMClient.isNotPullMsg||l._client.syncTime(void 0,void 0,void 0,!0),this._client.reconnectObj.onSuccess)this._client.reconnectObj.onSuccess(c),delete this._client.reconnectObj.onSuccess;else{var p=this;setTimeout(function(){p._cb(c)},500)}a.Bridge._client.channel.socket.fire("StatusChanged",0),a.RongIMClient._memoryStore.connectAckTime=d,(new Date).getTime()-d?a.RongIMClient._memoryStore.deltaTime=(new Date).getTime()-d:a.RongIMClient._memoryStore.deltaTime=0}else if(6==b){var q={},p=this;(new a.Navigation).getServerEndpoint(this._client.token,this._client.appId,function(){p._client.clearHeartbeat(),new a.Client(p._client.token,p._client.appId).__init.call(q,function(){"websocket"==a.Transportations._TransportType&&p._client.keepLive()}),p._client.channel.socket.fire("StatusChanged",2)},p._timeout,!1)}else a.Bridge._client.channel.socket.socket._status=b,this._client.reconnectObj.onError?(this._client.reconnectObj.onError(b),delete this._client.reconnectObj.onError):this._timeout(b)},d.prototype.readTimeOut=function(a){b.prototype.readTimeOut.call(this,a)},d}(b);a.ConnectAck=f}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(){window.getServerEndpoint=function(c){if(a.RongIMClient._storageProvider._host=b.Endpoint.host=c.server,a.RongIMClient._storageProvider.setItem("RongBackupServer",c.backupServer+","+(c.userId||"")),b.Endpoint.userId=c.userId,c.voipCallInfo){var d=JSON.parse(c.voipCallInfo);a.RongIMClient._memoryStore.voipStategy=d.strategy,a.RongIMClient._storageProvider.setItem("voipStrategy",d.strategy)}var e=md5(a.Bridge._client.token).slice(8,16),f=0==c.openMp?0:1;a.RongIMClient._storageProvider.setItem("navi"+e,c.server+","+(c.userId||"")),a.RongIMClient._storageProvider.setItem("openMp"+e,f),f||(a.RongIMClient._memoryStore.depend.openMp=!1)}}return b.prototype.connect=function(b,c,d){var e=a.RongIMClient._storageProvider.getItem("appId");e&&e!=b&&(a.RongIMClient._storageProvider.clearItem(),a.RongIMClient._storageProvider.setItem("appId",b)),e||a.RongIMClient._storageProvider.setItem("appId",b);var f=new a.Client(c,b);return this.getServerEndpoint(c,b,function(){f.connect(d)},d.onError,!0),f},b.prototype.getServerEndpoint=function(c,d,e,f,g){if(g){var h=md5(c).slice(8,16),i=a.RongIMClient._storageProvider.getItem(a.RongIMClient._storageProvider.getItemKey("navi")),j=a.RongIMClient._storageProvider.getItem("navi"+h);if(i==j&&null!==j&&a.RongIMClient._storageProvider.getItem("rongSDK")==a.Transportations._TransportType){var k=decodeURIComponent(i).split(",");return void setTimeout(function(){a.RongIMClient._storageProvider._host=b.Endpoint.host=k[0],a.RongIMClient._memoryStore.voipStategy=a.RongIMClient._storageProvider.getItem("voipStrategy"),a.RongIMClient._storageProvider.getItem("openMp"+h)||(a.RongIMClient._memoryStore.depend.openMp=!1),b.Endpoint.userId=k[1],e()},500)}}var l=document.createElement("script");l.src=a.RongIMClient._memoryStore.depend.navi+(a.RongIMClient._memoryStore.depend.isPolling?"/cometnavi.js":"/navi.js")+"?appId="+d+"&token="+encodeURIComponent(c)+"&callBack=getServerEndpoint&t="+(new Date).getTime(),document.body.appendChild(l),l.onerror=function(){f(a.ConnectionState.TOKEN_INCORRECT)},"onload"in l?l.onload=e:l.onreadystatechange=function(){"loaded"==l.readyState&&e()}},b.Endpoint=new Object,b}();a.Navigation=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(b){this._name="BaseMessage",this.lengthSize=0,b instanceof a.Header?this._header=b:this._header=new a.Header(b,(!1),a.Qos.AT_MOST_ONCE,(!1))}return b.prototype.read=function(a,b){this.readMessage(a,b)},b.prototype.write=function(b){var c=new a.BinaryHelper,d=c.convertStream(b);return this._headerCode=this.getHeaderFlag(),d.write(this._headerCode),this.writeMessage(d),d},b.prototype.getHeaderFlag=function(){return this._header.encode()},b.prototype.getLengthSize=function(){return this.lengthSize},b.prototype.toBytes=function(){return this.write([]).getBytesArray()},b.prototype.isRetained=function(){return this._header.retain},b.prototype.setRetained=function(a){this._header.retain=a},b.prototype.setQos=function(b){this._header.qos="[object Object]"==Object.prototype.toString.call(b)?b:a.Qos[b]},b.prototype.setDup=function(a){this._header.dup=a},b.prototype.isDup=function(){return this._header.dup},b.prototype.getType=function(){return this._header.type},b.prototype.getQos=function(){return this._header.qos},b.prototype.messageLength=function(){return 0},b.prototype.writeMessage=function(a){},b.prototype.readMessage=function(a,b){},b.prototype.init=function(a){var b,c,d=this;for(c in a)a.hasOwnProperty(c)&&(b=c.replace(/^\w/,function(a){var b=a.charCodeAt(0);return"set"+(b>=97?String.fromCharCode(b&-33):a)}),b in d&&("status"==c?d[b](disconnectStatus[a[c]]?disconnectStatus[a[c]]:a[c]):d[b](a[c])))},b}();a.BaseMessage=b;var c=function(b){function c(c){switch(b.call(this,0==arguments.length||3==arguments.length?a.Type.CONNECT:arguments[0]),this._name="ConnectMessage",this.CONNECT_HEADER_SIZE=12,this.protocolId="RCloud",this.binaryHelper=new a.BinaryHelper,this.protocolVersion=3,arguments.length){case 0:case 1:case 3:if(!arguments[0]||arguments[0].length>64)throw new Error("ConnectMessage:Client Id cannot be null and must be at most 64 characters long: "+arguments[0]);this.clientId=arguments[0],this.cleanSession=arguments[1],this.keepAlive=arguments[2]}}return __extends(c,b),c.prototype.messageLength=function(){var a=this.binaryHelper.toMQttString(this.clientId).length;return a+=this.binaryHelper.toMQttString(this.willTopic).length,a+=this.binaryHelper.toMQttString(this.will).length,a+=this.binaryHelper.toMQttString(this.appId).length,a+=this.binaryHelper.toMQttString(this.token).length,a+this.CONNECT_HEADER_SIZE},c.prototype.readMessage=function(a){this.protocolId=a.readUTF(),this.protocolVersion=a.readByte();var b=a.readByte();if(this.hasAppId=(128&b)>0,this.hasToken=(64&b)>0,this.retainWill=(32&b)>0,this.willQos=b>>3&3,this.hasWill=(4&b)>0,this.cleanSession=(32&b)>0,this.keepAlive=256*a.read()+a.read(),this.clientId=a.readUTF(),this.hasWill&&(this.willTopic=a.readUTF(),this.will=a.readUTF()),this.hasAppId)try{this.appId=a.readUTF()}catch(c){throw new Error(c)}if(this.hasToken)try{this.token=a.readUTF()}catch(c){throw new Error(c)}return a},c.prototype.writeMessage=function(a){var b=this.binaryHelper.convertStream(a);b.writeUTF(this.protocolId),b.write(this.protocolVersion);var c=this.cleanSession?2:0;return c|=this.hasWill?4:0,c|=this.willQos?this.willQos>>3:0,c|=this.retainWill?32:0,c|=this.hasToken?64:0,c|=this.hasAppId?128:0,b.write(c),b.writeChar(this.keepAlive),b.writeUTF(this.clientId),this.hasWill&&(b.writeUTF(this.willTopic),b.writeUTF(this.will)),this.hasAppId&&b.writeUTF(this.appId),this.hasToken&&b.writeUTF(this.token),b},c}(b);a.ConnectMessage=c;var d=function(b){function c(c){b.call(this,0==arguments.length?a.Type.CONNACK:1==arguments.length?arguments[0]instanceof a.Header?arguments[0]:a.Type.CONNACK:null),this._name="ConnAckMessage",this.MESSAGE_LENGTH=2,this.binaryHelper=new a.BinaryHelper;var d=this;switch(arguments.length){case 0:case 1:if(!(arguments[0]instanceof a.Header)&&arguments[0]in a.ConnectionState){if(null==arguments[0])throw new Error("ConnAckMessage:The status of ConnAskMessage can't be null");d.setStatus(arguments[0])}}}return __extends(c,b),c.prototype.messageLength=function(){var a=this.MESSAGE_LENGTH;return this.userId&&(a+=this.binaryHelper.toMQttString(this.userId).length),a},c.prototype.readMessage=function(a,b){a.read();var c=+a.read();if(!(c>=0&&c<=12))throw new Error("Unsupported CONNACK code:"+c);if(this.setStatus(c),b>this.MESSAGE_LENGTH){this.setUserId(a.readUTF());var d=(a.readUTF(),a.readLong());this.setTimestamp(d)}},c.prototype.writeMessage=function(a){var b=this.binaryHelper.convertStream(a);switch(b.write(128),+status){case 0:case 1:case 2:case 5:case 6:b.write(+status);break;case 3:case 4:b.write(3);break;default:throw new Error("Unsupported CONNACK code:"+status)}return this.userId&&b.writeUTF(this.userId),b},c.prototype.setStatus=function(a){this.status=a},c.prototype.setUserId=function(a){this.userId=a},c.prototype.getStatus=function(){return this.status},c.prototype.getUserId=function(){return this.userId},c.prototype.setTimestamp=function(a){this.timestrap=a},c.prototype.getTimestamp=function(){return this.timestrap},c}(b);a.ConnAckMessage=d;var e=function(b){function c(c){b.call(this,c instanceof a.Header?c:a.Type.DISCONNECT),this._name="DisconnectMessage",this.MESSAGE_LENGTH=2,this.binaryHelper=new a.BinaryHelper,c instanceof a.Header||c in a.ConnectionStatus&&(this.status=c)}return __extends(c,b),c.prototype.messageLength=function(){return this.MESSAGE_LENGTH},c.prototype.readMessage=function(a){a.read();var b=+a.read();if(!(b>=0&&b<=5))throw new Error("Unsupported CONNACK code:"+b);this.setStatus(disconnectStatus[b]?disconnectStatus[b]:b)},c.prototype.writeMessage=function(a){var b=this.binaryHelper.convertStream(a);if(b.write(0),!(+status>=1&&+status<=3))throw new Error("Unsupported CONNACK code:"+status);b.write(+status-1)},c.prototype.setStatus=function(a){this.status=a},c.prototype.getStatus=function(){return this.status},c}(b);a.DisconnectMessage=e;var f=function(b){function c(c){b.call(this,c&&c instanceof a.Header?c:a.Type.PINGREQ),this._name="PingReqMessage"}return __extends(c,b),c}(b);a.PingReqMessage=f;var g=function(b){function c(c){b.call(this,c&&c instanceof a.Header?c:a.Type.PINGRESP),this._name="PingRespMessage"}return __extends(c,b),c}(b);a.PingRespMessage=g;var h=function(b){function c(c){b.call(this,c),this._name="RetryableMessage",this.binaryHelper=new a.BinaryHelper}return __extends(c,b),c.prototype.messageLength=function(){return 2},c.prototype.writeMessage=function(a){var b=this.binaryHelper.convertStream(a),c=this.getMessageId(),d=255&c,e=(65280&c)>>8;return b.write(e),b.write(d),b},c.prototype.readMessage=function(a,b){var c=256*a.read()+a.read();this.setMessageId(parseInt(c,10))},c.prototype.setMessageId=function(a){this.messageId=a},c.prototype.getMessageId=function(){return this.messageId},c}(b);a.RetryableMessage=h;var i=function(b){function c(c){b.call(this,c instanceof a.Header?c:a.Type.PUBACK),this.msgLen=2,this.date=0,this.millisecond=0,this.timestamp=0,this.binaryHelper=new a.BinaryHelper,this._name="PubAckMessage",c instanceof a.Header||b.prototype.setMessageId.call(this,c)}return __extends(c,b),c.prototype.messageLength=function(){return this.msgLen},c.prototype.writeMessage=function(a){var b=this.binaryHelper.convertStream(a);h.prototype.writeMessage.call(this,b)},c.prototype.readMessage=function(a,b){h.prototype.readMessage.call(this,a),this.date=a.readInt(),this.status=256*a.read()+a.read(),this.millisecond=256*a.read()+a.read(),this.timestamp=1e3*this.date+this.millisecond,this.messageUId=a.readUTF()},c.prototype.setStatus=function(a){this.status=a},c.prototype.setTimestamp=function(a){this.timestamp=a},c.prototype.setMessageUId=function(a){this.messageUId=a},c.prototype.getStatus=function(){return this.status},c.prototype.getDate=function(){return this.date},c.prototype.getTimestamp=function(){return this.timestamp},c.prototype.getMessageUId=function(){return this.messageUId},c}(h);a.PubAckMessage=i;var j=function(b){function c(c,d,e){b.call(this,1==arguments.length&&c instanceof a.Header?c:3==arguments.length?a.Type.PUBLISH:0),this._name="PublishMessage",this.binaryHelper=new a.BinaryHelper,this.syncMsg=!1,3==arguments.length&&(this.topic=c,this.targetId=e,this.data="string"==typeof d?this.binaryHelper.toMQttString(d):d)}return __extends(c,b),c.prototype.messageLength=function(){var a=10;return a+=this.binaryHelper.toMQttString(this.topic).length,a+=this.binaryHelper.toMQttString(this.targetId).length,a+=this.data.length},c.prototype.writeMessage=function(a){var b=this.binaryHelper.convertStream(a);b.writeUTF(this.topic),b.writeUTF(this.targetId),h.prototype.writeMessage.apply(this,arguments),b.write(this.data)},c.prototype.readMessage=function(a,b){var c=6;this.date=a.readInt(),this.topic=a.readUTF(),c+=this.binaryHelper.toMQttString(this.topic).length,this.targetId=a.readUTF(),c+=this.binaryHelper.toMQttString(this.targetId).length,h.prototype.readMessage.apply(this,arguments),this.data=new Array(b-c),this.data=a.read(this.data)},c.prototype.setTopic=function(a){this.topic=a},c.prototype.setData=function(a){this.data=a},c.prototype.setTargetId=function(a){this.targetId=a},c.prototype.setDate=function(a){this.date=a},c.prototype.setSyncMsg=function(a){this.syncMsg=a},c.prototype.getSyncMsg=function(){return this.syncMsg},c.prototype.getTopic=function(){return this.topic},c.prototype.getData=function(){return this.data},c.prototype.getTargetId=function(){return this.targetId},c.prototype.getDate=function(){return this.date},c}(h);a.PublishMessage=j;var k=function(b){function c(c,d,e){b.call(this,c instanceof a.Header?c:3==arguments.length?a.Type.QUERY:null),this.binaryHelper=new a.BinaryHelper,this._name="QueryMessage",3==arguments.length&&(this.data="string"==typeof d?this.binaryHelper.toMQttString(d):d,this.topic=c,this.targetId=e)}return __extends(c,b),c.prototype.messageLength=function(){var a=0;return a+=this.binaryHelper.toMQttString(this.topic).length,a+=this.binaryHelper.toMQttString(this.targetId).length,a+=2,a+=this.data.length},c.prototype.writeMessage=function(a){var b=this.binaryHelper.convertStream(a);b.writeUTF(this.topic),b.writeUTF(this.targetId),h.prototype.writeMessage.call(this,b),b.write(this.data)},c.prototype.readMessage=function(a,b){var c=0;this.topic=a.readUTF(),this.targetId=a.readUTF(),c+=this.binaryHelper.toMQttString(this.topic).length,c+=this.binaryHelper.toMQttString(this.targetId).length,this.readMessage.apply(this,arguments),c+=2,this.data=new Array(b-c),a.read(this.data)},c.prototype.setTopic=function(a){this.topic=a},c.prototype.setData=function(a){this.data=a},c.prototype.setTargetId=function(a){this.targetId=a},c.prototype.getTopic=function(){return this.topic},c.prototype.getData=function(){return this.data},c.prototype.getTargetId=function(){return this.targetId},c}(h);a.QueryMessage=k;var l=function(b){function c(c){b.call(this,c instanceof a.Header?c:a.Type.QUERYCON),this._name="QueryConMessage",c instanceof a.Header||b.prototype.setMessageId.call(this,c)}return __extends(c,b),c}(h);a.QueryConMessage=l;var m=function(b){function c(c){b.call(this,c),this._name="QueryAckMessage",this.binaryHelper=new a.BinaryHelper}return __extends(c,b),c.prototype.readMessage=function(a,b){h.prototype.readMessage.call(this,a),
this.date=a.readInt(),this.setStatus(256*a.read()+a.read()),b>0&&(this.data=new Array(b-8),this.data=a.read(this.data))},c.prototype.getData=function(){return this.data},c.prototype.getStatus=function(){return this.status},c.prototype.getDate=function(){return this.date},c.prototype.setDate=function(a){this.date=a},c.prototype.setStatus=function(a){this.status=a},c.prototype.setData=function(a){this.data=a},c}(h);a.QueryAckMessage=m}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(b){var c=new a.BinaryHelper;this.out=c.convertStream(b)}return b.prototype.writeMessage=function(b){b instanceof a.BaseMessage&&b.write(this.out)},b}();a.MessageOutputStream=b;var c=function(){function b(b,c){if(c)this.flags=b.headerCode;else{var d=(new a.BinaryHelper).convertStream(b);this.flags=d.readByte(),this._in=d}this.header=new a.Header(this.flags),this.isPolling=c,this.In=b}return b.prototype.readMessage=function(){switch(this.header.getType()){case 1:this.msg=new a.ConnectMessage(this.header);break;case 2:this.msg=new a.ConnAckMessage(this.header);break;case 3:this.msg=new a.PublishMessage(this.header),this.msg.setSyncMsg(this.header.getSyncMsg());break;case 4:this.msg=new a.PubAckMessage(this.header);break;case 5:this.msg=new a.QueryMessage(this.header);break;case 6:this.msg=new a.QueryAckMessage(this.header);break;case 7:this.msg=new a.QueryConMessage(this.header);break;case 9:case 11:case 13:this.msg=new a.PingRespMessage(this.header);break;case 8:case 10:case 12:this.msg=new a.PingReqMessage(this.header);break;case 14:this.msg=new a.DisconnectMessage(this.header);break;default:throw new Error("No support for deserializing "+this.header.getType()+" messages")}return this.isPolling?this.msg.init(this.In):this.msg.read(this._in,this.In.length-1),this.msg},b}();a.MessageInputStream=c;var d=function(){function b(b,c,d,e){this.retain=!1,this.qos=a.Qos.AT_LEAST_ONCE,this.dup=!1,this.syncMsg=!1,b&&+b==b&&1==arguments.length?(this.retain=(1&b)>0,this.qos=(6&b)>>1,this.dup=(8&b)>0,this.type=b>>4&15,this.syncMsg=8==(8&b)):(this.type=b,this.retain=c,this.qos=d,this.dup=e)}return b.prototype.getSyncMsg=function(){return this.syncMsg},b.prototype.getType=function(){return this.type},b.prototype.encode=function(){var b=this;switch(this.qos){case a.Qos[0]:b.qos=a.Qos.AT_MOST_ONCE;break;case a.Qos[1]:b.qos=a.Qos.AT_LEAST_ONCE;break;case a.Qos[2]:b.qos=a.Qos.EXACTLY_ONCE;break;case a.Qos[3]:b.qos=a.Qos.DEFAULT}var c=this.type<<4;return c|=this.retain?1:0,c|=this.qos<<1,c|=this.dup?8:0},b.prototype.toString=function(){return"Header [type="+this.type+",retain="+this.retain+",qos="+this.qos+",dup="+this.dup+"]"},b}();a.Header=d;var e=function(){function a(){}return a.prototype.writeUTF=function(a,b){for(var c=[],d=0,e=0,f=a.length;e<f;e++){var g=a.charCodeAt(e);g>=0&&g<=127?(d+=1,c.push(g)):g>=128&&g<=2047?(d+=2,c.push(192|31&g>>6),c.push(128|63&g)):g>=2048&&g<=65535&&(d+=3,c.push(224|15&g>>12),c.push(128|63&g>>6),c.push(128|63&g))}for(var e=0,f=c.length;e<f;e++)c[e]>255&&(c[e]&=255);return b?c:d<=255?[0,d].concat(c):[d>>8,255&d].concat(c)},a.prototype.readUTF=function(a){if("[object String]"==Object.prototype.toString.call(a))return a;for(var b="",c=a,d=0,e=c.length;d<e;d++){c[d]<0&&(c[d]+=256);var f=c[d].toString(2),g=f.match(/^1+?(?=0)/);if(g&&8==f.length){for(var h=g[0].length,i="",j=0;j<h;j++)i+=c[j+d].toString(2).slice(2);b+=String.fromCharCode(parseInt(i,2)),d+=h-1}else b+=String.fromCharCode(c[d])}return b},a.prototype.convertStream=function(a){return a instanceof f?a:new f(a)},a.prototype.toMQttString=function(a){return this.writeUTF(a)},a}();a.BinaryHelper=e;var f=function(){function a(a){this.position=0,this.writen=0,this.poolLen=0,this.binaryHelper=new e,this.pool=a,this.poolLen=a.length}return a.prototype.check=function(){return this.position>=this.pool.length},a.prototype.readInt=function(){if(this.check())return-1;for(var a="",b=0;b<4;b++){var c=this.pool[this.position++].toString(16);1==c.length&&(c="0"+c),a+=c.toString(16)}return parseInt(a,16)},a.prototype.readLong=function(){if(this.check())return-1;for(var a="",b=0;b<8;b++){var c=this.pool[this.position++].toString(16);1==c.length&&(c="0"+c),a+=c}return parseInt(a,16)},a.prototype.readTimestamp=function(){if(this.check())return-1;for(var a="",b=0;b<8;b++)a+=this.pool[this.position++].toString(16);return a=a.substring(2,8),parseInt(a,16)},a.prototype.readUTF=function(){if(this.check())return-1;var a=this.readByte()<<8|this.readByte();return this.binaryHelper.readUTF(this.pool.subarray(this.position,this.position+=a))},a.prototype.readByte=function(){if(this.check())return-1;var a=this.pool[this.position++];return a>255&&(a&=255),a},a.prototype.read=function(a){return a?this.pool.subarray(this.position,this.poolLen):this.readByte()},a.prototype.write=function(a){var b=a;return"[object array]"==Object.prototype.toString.call(b).toLowerCase()?[].push.apply(this.pool,b):+b==b&&(b>255&&(b&=255),this.pool.push(b),this.writen++),b},a.prototype.writeChar=function(a){if(+a!=a)throw new Error("writeChar:arguments type is error");this.write(a>>8&255),this.write(255&a),this.writen+=2},a.prototype.writeUTF=function(a){var b=this.binaryHelper.writeUTF(a);[].push.apply(this.pool,b),this.writen+=b.length},a.prototype.toComplements=function(){for(var a=this.pool,b=0;b<this.poolLen;b++)a[b]>128&&(a[b]-=256);return a},a.prototype.getBytesArray=function(a){return a?this.toComplements():this.pool},a}();a.RongIMStream=f}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(a){return this.connected=!1,this.isClose=!1,this.queue=[],this.empty=new Function,this._socket=a,this}return b.prototype.createTransport=function(b,c){if(!b)throw new Error("URL can't be empty");return this.url=b,this.socket=new WebSocket(a.RongIMClient._memoryStore.depend.wsScheme+b),this.socket.binaryType="arraybuffer",this.addEvent(),this.socket},b.prototype.send=function(b){if(!this.connected&&!this.isClose)return void this.queue.push(b);if(this.isClose)return void this._socket.fire("StatusChanged",a.ConnectionStatus.CONNECTION_CLOSED);var c=new a.RongIMStream([]),d=new a.MessageOutputStream(c);d.writeMessage(b);var e=c.getBytesArray(!0),f=new Int8Array(e);return this.socket.send(f.buffer),this},b.prototype.onData=function(b){return a.MessageUtil.isArray(b)?this._socket.onMessage(new a.MessageInputStream(b).readMessage()):this._socket.onMessage(new a.MessageInputStream(a.MessageUtil.ArrayFormInput(b)).readMessage()),""},b.prototype.onClose=function(b){var c=this;c.isClose=!0,c.socket=this.empty,a.Bridge._client.clearHeartbeat(),1006!=b.code||this._status?c._status=0:c._socket.fire("StatusChanged",a.ConnectionStatus.NETWORK_UNAVAILABLE)},b.prototype.onError=function(a){throw new Error(a)},b.prototype.addEvent=function(){var a=this;a.socket.onopen=function(){a.connected=!0,a.isClose=!1,a.doQueue(),a._socket.fire("connect")},a.socket.onmessage=function(b){"string"==typeof b.data?a.onData(b.data.split(",")):a.onData(b.data)},a.socket.onerror=function(b){a.onError(b)},a.socket.onclose=function(b){a.onClose(b)}},b.prototype.doQueue=function(){for(var a=this,b=0,c=a.queue.length;b<c;b++)a.send(a.queue[b])},b.prototype.disconnect=function(a){var b=this;b.socket.readyState&&(b.isClose=!0,a&&(b._status=a),this.socket.close())},b.prototype.reconnect=function(){this.disconnect(),this.createTransport(this.url)},b}();a.SocketTransportation=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(a){return this.empty=new Function,this.connected=!1,this.pid=+new Date+Math.random()+"",this.queue=[],this.socket=a,this}return b.prototype.createTransport=function(b,c){if(!b)throw new Error("Url is empty,Please check it!");this.url=b;var d=a.RongIMClient._storageProvider.getItem("sId"+a.Navigation.Endpoint.userId),e=this;return d?(setTimeout(function(){e.onSuccess('{"status":0,"userId":"'+a.Navigation.Endpoint.userId+'","headerCode":32,"messageId":0,"sessionid":"'+d+'"}'),e.connected=!0},500),this):(this.getRequest(b,!0),this)},b.prototype.requestFactory=function(b,c,d){var e=this.XmlHttpRequest();return d&&(e.multipart=!0),e.timeout=6e4,e.open(c||"GET",a.RongIMClient._memoryStore.depend.protocol+b),"POST"==c&&"setRequestHeader"in e&&e.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8"),e},b.prototype.getRequest=function(a,b){var c=this;c.xhr=this.requestFactory(a+"&pid="+encodeURIComponent(c.pid),"GET"),"onload"in c.xhr?(c.xhr.onload=function(){c.xhr.onload=c.empty,"lost params"==this.responseText?c.onError():c.onSuccess(this.responseText,b)},c.xhr.onerror=function(){c.disconnect()}):c.xhr.onreadystatechange=function(){4==c.xhr.readyState&&(c.xhr.onreadystatechange=c.empty,/^(200|202)$/.test(c.xhr.status)?c.onSuccess(c.xhr.responseText,b):/^(400|403)$/.test(c.xhr.status)?c.onError():c.disconnect())},c.xhr.send()},b.prototype.send=function(b){var c=this,d=c.sendxhr=this.requestFactory(a.Navigation.Endpoint.host+"/websocket"+b.url+"&pid="+encodeURIComponent(c.pid),"POST");"onload"in d?(d.onload=function(){d.onload=c.empty,c.onData(d.responseText)},d.onerror=function(){d.onerror=c.empty}):d.onreadystatechange=function(){4==d.readyState&&(this.onreadystatechange=this.empty,/^(202|200)$/.test(d.status)&&c.onData(d.responseText))},d.send(JSON.stringify(b.data))},b.prototype.onData=function(b,c){if(b&&"lost params"!=b){var d=this,e=JSON.parse(b);return e.userId&&(a.Navigation.Endpoint.userId=e.userId),c&&a.RongIMClient._storageProvider.setItem("sId"+a.Navigation.Endpoint.userId,c),a.MessageUtil.isArray(e)||(e=[e]),Array.forEach(e,function(b){d.socket.fire("message",new a.MessageInputStream(b,(!0)).readMessage())}),""}},b.prototype.XmlHttpRequest=function(){var a="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;return"undefined"!=typeof XMLHttpRequest&&a?new XMLHttpRequest:"undefined"!=typeof XDomainRequest?new XDomainRequest:new ActiveXObject("Microsoft.XMLHTTP")},b.prototype.onClose=function(){this.xhr&&(this.xhr.onload?this.xhr.onreadystatechange=this.xhr.onload=this.empty:this.xhr.onreadystatechange=this.empty,this.xhr.abort(),this.xhr=null),this.sendxhr&&(this.sendxhr.onload?this.sendxhr.onreadystatechange=this.sendxhr.onload=this.empty:this.sendxhr.onreadystatechange=this.empty,this.sendxhr.abort(),this.sendxhr=null)},b.prototype.disconnect=function(){a.RongIMClient._storageProvider.removeItem("sId"+a.Navigation.Endpoint.userId),a.RongIMClient._storageProvider.removeItem(a.Navigation.Endpoint.userId+"msgId"),this.onClose()},b.prototype.reconnect=function(){this.disconnect(),this.createTransport(this.url)},b.prototype.onSuccess=function(b,c){var d=b.match(/"sessionid":"\S+?(?=")/);return this.onData(b,d?d[0].slice(13):0),/"headerCode":-32,/.test(b)?(a.RongIMClient._storageProvider.removeItem("sId"+a.Navigation.Endpoint.userId),void a.RongIMClient._storageProvider.removeItem(a.Navigation.Endpoint.userId+"msgId")):(this.getRequest(a.Navigation.Endpoint.host+"/pullmsg.js?sessionid="+a.RongIMClient._storageProvider.getItem("sId"+a.Navigation.Endpoint.userId)+"&timestrap="+encodeURIComponent((new Date).getTime()+Math.random()+"")),this.connected=!0,void(c&&this.socket.fire("connect")))},b.prototype.onError=function(){a.RongIMClient._storageProvider.removeItem("sId"+a.Navigation.Endpoint.userId),a.RongIMClient._storageProvider.removeItem(a.Navigation.Endpoint.userId+"msgId"),this.onClose(),this.connected=!1,this.socket.fire("disconnect")},b}();a.PollingTransportation=b}(RongIMLib||(RongIMLib={}));var typeMapping={"RC:TxtMsg":"TextMessage","RC:ImgMsg":"ImageMessage","RC:VcMsg":"VoiceMessage","RC:ImgTextMsg":"RichContentMessage","RC:FileMsg":"FileMessage","RC:LBSMsg":"LocationMessage","RC:InfoNtf":"InformationNotificationMessage","RC:ContactNtf":"ContactNotificationMessage","RC:ProfileNtf":"ProfileNotificationMessage","RC:CmdNtf":"CommandNotificationMessage","RC:DizNtf":"DiscussionNotificationMessage","RC:CmdMsg":"CommandMessage","RC:TypSts":"TypingStatusMessage","RC:CsChaR":"ChangeModeResponseMessage","RC:CsHsR":"HandShakeResponseMessage","RC:CsEnd":"TerminateMessage","RC:CsSp":"SuspendMessage","RC:CsUpdate":"CustomerStatusUpdateMessage","RC:ReadNtf":"ReadReceiptMessage","RC:VCAccept":"AcceptMessage","RC:VCRinging":"RingingMessage","RC:VCSummary":"SummaryMessage","RC:VCHangup":"HungupMessage","RC:VCInvite":"InviteMessage","RC:VCModifyMedia":"MediaModifyMessage","RC:VCModifyMem":"MemberModifyMessage","RC:CsContact":"CustomerContact","RC:PSImgTxtMsg":"PublicServiceRichContentMessage","RC:PSMultiImgTxtMsg":"PublicServiceMultiRichContentMessage","RC:GrpNtf":"GroupNotificationMessage","RC:PSCmd":"PublicServiceCommandMessage","RC:RcCmd":"RecallCommandMessage","RC:SRSMsg":"SyncReadStatusMessage","RC:RRReqMsg":"ReadReceiptRequestMessage","RC:RRRspMsg":"ReadReceiptResponseMessage","RCJrmf:RpMsg":"JrmfReadPacketMessage","RCJrmf:RpOpendMsg":"JrmfReadPacketOpenedMessage"},registerMessageTypeMapping={},HistoryMsgType={4:"qryCMsg",2:"qryDMsg",3:"qryGMsg",1:"qryPMsg",6:"qrySMsg",7:"qryPMsg",8:"qryPMsg",5:"qryCMsg"},disconnectStatus={1:6},RongIMLib;!function(RongIMLib){var Transportations=function(){function a(){}return a._TransportType=RongIMLib.Socket.WEBSOCKET,a}();RongIMLib.Transportations=Transportations;var MessageUtil=function(){function MessageUtil(){}return MessageUtil.supportLargeStorage=function(){return!!window.localStorage},MessageUtil.checkStorageSize=function(){return JSON.stringify(localStorage).length<468e4},MessageUtil.getFirstKey=function(a){var b="";for(var c in a){b=c;break}return b},MessageUtil.isEmpty=function(a){var b=!0;for(var c in a){b=!1;break}return b},MessageUtil.ArrayForm=function(a){if("[object ArrayBuffer]"==Object.prototype.toString.call(a)){var b=new Int8Array(a);return[].slice.call(b)}return a},MessageUtil.ArrayFormInput=function(a){if("[object ArrayBuffer]"==Object.prototype.toString.call(a)){var b=new Uint8Array(a);return b}return a},MessageUtil.indexOf=function(a,b,c){for(var d=a.length,e=c<0?Math.max(0,+c):c||0;e<d;e++)if(a[e]==b)return e;return-1},MessageUtil.isArray=function(a){return"[object Array]"==Object.prototype.toString.call(a)},MessageUtil.forEach=function(a,b){return[].forEach?function(a,b){[].forEach.call(a,b)}:function(a,b){for(var c=0;c<a.length;c++)b.call(a,a[c],c,a)}},MessageUtil.remove=function(a,b){for(var c=0,d=a.length;c<d;c++)if(b(a[c]))return a.splice(c,1)[0];return null},MessageUtil.int64ToTimestamp=function(a,b){if(void 0===a.low)return a;var c=a.low;c<0&&(c+=4294967296),c=c.toString(16);var d=parseInt(a.high.toString(16)+"00000000".replace(new RegExp("0{"+c.length+"}$"),c),16);return b?new Date(d):d},MessageUtil.messageParser=function(entity,onReceived,offlineMsg){var message=new RongIMLib.Message,content=entity.content,de,objectName=entity.classname,val,isUseDef=!1;try{RongIMLib.RongIMClient._memoryStore.depend.isPolling?(val=(new RongIMLib.BinaryHelper).readUTF(content.offset?MessageUtil.ArrayForm(content.buffer).slice(content.offset,content.limit):content),de=JSON.parse(val)):(val=(new RongIMLib.BinaryHelper).readUTF(content.offset?MessageUtil.ArrayFormInput(content.buffer).subarray(content.offset,content.limit):content),de=JSON.parse(val))}catch(ex){de=val,isUseDef=!0}if(objectName in typeMapping){var str="new RongIMLib."+typeMapping[objectName]+"(de)";message.content=eval(str),message.messageType=typeMapping[objectName]}else if(objectName in registerMessageTypeMapping){var str="new RongIMLib.RongIMClient.RegisterMessage."+registerMessageTypeMapping[objectName]+"(de)";isUseDef?message.content=eval(str).decode(de):message.content=eval(str),message.messageType=registerMessageTypeMapping[objectName]}else message.content=new RongIMLib.UnknownMessage({content:de,objectName:objectName}),message.messageType="UnknownMessage";var dateTime=MessageUtil.int64ToTimestamp(entity.dataTime);return dateTime>0?message.sentTime=dateTime:message.sentTime=+new Date,message.senderUserId=entity.fromUserId,message.conversationType=entity.type,entity.fromUserId==RongIMLib.Bridge._client.userId?message.targetId=entity.groupId:message.targetId=/^[234]$/.test(entity.type||entity.getType())?entity.groupId:message.senderUserId,1==entity.direction?(message.messageDirection=RongIMLib.MessageDirection.SEND,message.senderUserId=RongIMLib.Bridge._client.userId):message.senderUserId==RongIMLib.Bridge._client.userId?message.messageDirection=RongIMLib.MessageDirection.SEND:message.messageDirection=RongIMLib.MessageDirection.RECEIVE,2==(2&entity.status)&&(message.receivedStatus=RongIMLib.ReceivedStatus.RETRIEVED),message.messageUId=entity.msgId,message.receivedTime=(new Date).getTime(),message.messageId=message.conversationType+"_"+~~(16777215*Math.random()),message.objectName=objectName,message.receivedStatus=RongIMLib.ReceivedStatus.READ,message.offLineMessage=!!offlineMsg,offlineMsg||RongIMLib.RongIMClient._memoryStore.connectAckTime>message.sentTime&&(message.offLineMessage=!0),message},MessageUtil.sign={converNum:1,msgNum:1,isMsgStart:!0,isConvStart:!0},MessageUtil}();RongIMLib.MessageUtil=MessageUtil;var MessageIdHandler=function(){function a(){}return a.init=function(){this.messageId=+(RongIMLib.RongIMClient._storageProvider.getItem(RongIMLib.Navigation.Endpoint.userId+"msgId")||RongIMLib.RongIMClient._storageProvider.setItem(RongIMLib.Navigation.Endpoint.userId+"msgId",0)||0)},a.messageIdPlus=function(a){return RongIMLib.RongIMClient._memoryStore.depend.isPolling&&this.init(),this.messageId>=65535?(a(),!1):(this.messageId++,RongIMLib.RongIMClient._memoryStore.depend.isPolling&&RongIMLib.RongIMClient._storageProvider.setItem(RongIMLib.Navigation.Endpoint.userId+"msgId",this.messageId),this.messageId)},a.clearMessageId=function(){this.messageId=0,RongIMLib.RongIMClient._memoryStore.depend.isPolling&&RongIMLib.RongIMClient._storageProvider.setItem(RongIMLib.Navigation.Endpoint.userId+"msgId",this.messageId)},a.getMessageId=function(){return RongIMLib.RongIMClient._memoryStore.depend.isPolling&&this.init(),this.messageId},a.messageId=0,a}();RongIMLib.MessageIdHandler=MessageIdHandler}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function a(a){throw new Error("This method is abstract, you must implement this method in inherited class.")}return a.obtain=function(){throw new Error("This method is abstract, you must implement this method in inherited class.")},a}();a.MessageContent=b;var c=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(b);a.NotificationMessage=c;var d=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(b);a.StatusMessage=d;var e=function(){function b(){}return b.modelClone=function(a){var b={};for(var c in a)"messageName"!=c&&"encode"!=c&&(b[c]=a[c]);return b},b.modleCreate=function(b,c){if(b.length<1)throw new Error("Array is empty  -> registerMessageType.modleCreate");var d=function(e){var f=this;for(var g in b)e[b[g]]&&(f[b[g]]=e[b[g]]);d.prototype.messageName=c,d.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))}};return d},b}();a.ModelUtil=e}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(a){this.messageName="CustomerStatusMessage",this.status=a.status}return b.obtain=function(){return null},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.CustomerStatusMessage=b;var c=function(){function b(a){this.messageName="ChangeModeResponseMessage",this.code=a.code,this.data=a.data,this.msg=a.msg}return b.obtain=function(){return null},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.ChangeModeResponseMessage=c;var d=function(){function b(a){this.messageName="ChangeModeMessage",this.uid=a.uid,this.sid=a.sid,this.pid=a.pid}return b.obtain=function(){return null},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.ChangeModeMessage=d;var e=function(){function b(a){this.messageName="CustomerStatusUpdateMessage",this.serviceStatus=a.serviceStatus,this.sid=a.sid}return b.obtain=function(){return null},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.CustomerStatusUpdateMessage=e;var f=function(){function b(a){this.messageName="HandShakeMessage",a&&(this.groupid=a.groupid)}return b.obtain=function(){return null},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.HandShakeMessage=f;var g=function(){function b(a){this.messageName="CustomerContact",this.page=a.page,this.nickName=a.nickName,this.routingInfo=a.routingInfo,this.info=a.info,this.requestInfo=a.requestInfo}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.CustomerContact=g;var h=function(){function b(a){this.messageName="EvaluateMessage",this.uid=a.uid,this.sid=a.sid,this.pid=a.pid,this.source=a.source,this.suggest=a.suggest,this.isresolve=a.isresolve,this.type=a.type}return b.obtain=function(){return null},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.EvaluateMessage=h;var i=function(){function b(a){this.messageName="HandShakeResponseMessage",this.msg=a.msg,this.status=a.status,this.data=a.data}return b.obtain=function(){return null},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.HandShakeResponseMessage=i;var j=function(){function b(a){this.messageName="SuspendMessage",this.uid=a.uid,this.sid=a.sid,this.pid=a.pid}return b.obtain=function(){return null},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.SuspendMessage=j;var k=function(){function b(a){this.messageName="TerminateMessage",this.code=a.code,this.msg=a.msg,this.sid=a.sid}return b.obtain=function(){return null},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.TerminateMessage=k}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function a(a){this.messageName="IsTypingStatusMessage"}return a.prototype.encode=function(){},a.prototype.getMessage=function(){return null},a}();a.IsTypingStatusMessage=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(a){if(this.messageName="InformationNotificationMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> InformationNotificationMessage.");this.message=a.message,this.extra=a.extra,a.user&&(this.user=a.user)}return b.obtain=function(a){return new b({message:a,extra:""})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.InformationNotificationMessage=b;var c=function(){function b(a){if(this.messageName="CommandMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> CommandMessage.");try{"[object String]"==Object.prototype.toString.call(a.data)?this.data=JSON.parse(a.data):this.data=a.data}catch(b){this.data=a.data}this.name=a.name,this.extra=a.extra}return b.obtain=function(a){return new b({data:a,extra:""})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.CommandMessage=c;var d=function(){function c(a){if(this.messageName="ContactNotificationMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> ContactNotificationMessage.");this.operation=a.operation,this.targetUserId=a.targetUserId,this.message=a.message,this.extra=a.extra,this.sourceUserId=a.sourceUserId,a.user&&(this.user=a.user)}return c.obtain=function(a,c,d,e){return new b({operation:a,sourceUserId:c,targetUserId:d,message:e})},c.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},c.CONTACT_OPERATION_ACCEPT_RESPONSE="ContactOperationAcceptResponse",c.CONTACT_OPERATION_REJECT_RESPONSE="ContactOperationRejectResponse",c.CONTACT_OPERATION_REQUEST="ContactOperationRequest",c}();a.ContactNotificationMessage=d;var e=function(){function b(a){if(this.messageName="ProfileNotificationMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> ProfileNotificationMessage.");this.operation=a.operation;try{"[object String]"==Object.prototype.toString.call(a.data)?this.data=JSON.parse(a.data):this.data=a.data}catch(b){this.data=a.data}this.extra=a.extra,a.user&&(this.user=a.user)}return b.obtain=function(a,c){return new b({operation:a,data:c})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.ProfileNotificationMessage=e;var f=function(){function b(a){if(this.messageName="CommandNotificationMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> ProfileNotificationMessage.");try{"[object String]"==Object.prototype.toString.call(a.data)?this.data=JSON.parse(a.data):this.data=a.data}catch(b){this.data=a.data}this.name=a.name,this.extra=a.extra,a.user&&(this.user=a.user)}return b.obtain=function(a,c){return new b({name:a,data:c,extra:""})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.CommandNotificationMessage=f;var g=function(){function b(a){if(this.messageName="DiscussionNotificationMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> DiscussionNotificationMessage.");this.extra=a.extra,this.extension=a.extension,this.type=a.type,this.isHasReceived=a.isHasReceived,this.operation=a.operation,this.user=a.user,a.user&&(this.user=a.user)}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.DiscussionNotificationMessage=g;var h=function(){function b(a){if(this.messageName="GroupNotificationMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> GroupNotificationMessage.");a.operatorUserId&&(this.operatorUserId=a.operatorUserId),a.operation&&(this.operation=a.operation),a.data&&(this.data=a.data),a.message&&(this.message=a.message)}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.GroupNotificationMessage=h}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(a){if(this.messageName="TextMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> TextMessage.");this.content=a.content,this.extra=a.extra,a.user&&(this.user=a.user),a.mentionedInfo&&(this.mentionedInfo=a.mentionedInfo)}return b.obtain=function(a){return new b({extra:"",content:a})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.TextMessage=b;var c=function(){function b(a){if(this.messageName="TypingStatusMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> TypingStatusMessage.");this.typingContentType=a.typingContentType,this.data=a.data}return b.obtain=function(a,c){return new b({typingContentType:a,data:c})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.TypingStatusMessage=c;var d=function(){function b(a){if(this.messageName="ReadReceiptMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> ReadReceiptMessage.");this.lastMessageSendTime=a.lastMessageSendTime,this.messageUId=a.messageUId,this.type=a.type}return b.obtain=function(a,c,d){return new b({messageUId:a,lastMessageSendTime:c,type:d})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.ReadReceiptMessage=d;var e=function(){function b(a){if(this.messageName="VoiceMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> VoiceMessage.");this.content=a.content,this.duration=a.duration,this.extra=a.extra,a.user&&(this.user=a.user),a.mentionedInfo&&(this.mentionedInfo=a.mentionedInfo)}return b.obtain=function(a,c){return new b({content:a,duration:c,extra:""})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.VoiceMessage=e;var f=function(){function b(a){this.messageName="RecallCommandMessage",this.messageUId=a.messageUId,this.conversationType=a.conversationType,this.targetId=a.targetId,this.sentTime=a.sentTime,a.extra&&(this.extra=a.extra),a.user&&(this.user=a.user)}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.RecallCommandMessage=f;var g=function(){function b(a){if(this.messageName="ImageMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> ImageMessage.");this.content=a.content,this.imageUri=a.imageUri,a.extra&&(this.extra=a.extra),a.user&&(this.user=a.user),a.mentionedInfo&&(this.mentionedInfo=a.mentionedInfo)}return b.obtain=function(a,c){return new b({content:a,imageUri:c,extra:""})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.ImageMessage=g;var h=function(){function b(a){if(this.messageName="LocationMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> LocationMessage.");this.latitude=a.latitude,this.longitude=a.longitude,this.poi=a.poi,this.content=a.content,this.extra=a.extra,a.user&&(this.user=a.user),a.mentionedInfo&&(this.mentionedInfo=a.mentionedInfo)}return b.obtain=function(a,c,d,e){return new b({latitude:a,longitude:c,poi:d,content:e,extra:""})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.LocationMessage=h;var i=function(){function b(a){if(this.messageName="RichContentMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> RichContentMessage.");this.title=a.title,this.content=a.content,this.imageUri=a.imageUri,this.extra=a.extra,this.url=a.url,a.user&&(this.user=a.user)}return b.obtain=function(a,c,d,e){return new b({title:a,content:c,imageUri:d,url:e,extra:""})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.RichContentMessage=i;var j=function(){function a(a){this.messageName="JrmfReadPacketMessage",a&&(this.message=a)}return a.prototype.encode=function(){return""},a}();a.JrmfReadPacketMessage=j;var k=function(){function a(a){this.messageName="JrmfReadPacketOpenedMessage",a&&(this.message=a)}return a.prototype.encode=function(){return""},a}();a.JrmfReadPacketOpenedMessage=k;var l=function(){function a(a){if(this.messageName="UnknownMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> UnknownMessage.");this.message=a}return a.prototype.encode=function(){return""},a}();a.UnknownMessage=l;var m=function(){function b(a){if(this.messageName="PublicServiceCommandMessage",0==arguments.length)throw new Error("Can not instantiate with empty parameters, use obtain method instead -> PublicServiceCommandMessage.");this.content=a.content,this.extra=a.extra,this.menuItem=a.menuItem,a.user&&(this.user=a.user),a.mentionedInfo&&(this.mentionedInfo=a.mentionedInfo)}return b.obtain=function(a){return new b({content:"",command:"",menuItem:a,extra:""})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.PublicServiceCommandMessage=m;var n=function(){function a(a){this.messageName="PublicServiceMultiRichContentMessage",this.richContentMessages=a}return a.prototype.encode=function(){return null},a}();a.PublicServiceMultiRichContentMessage=n;var o=function(){function b(a){this.messageName="SyncReadStatusMessage",a.lastMessageSendTime&&(this.lastMessageSendTime=a.lastMessageSendTime)}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.SyncReadStatusMessage=o;var p=function(){function b(a){this.messageName="ReadReceiptRequestMessage",
a.messageUId&&(this.messageUId=a.messageUId)}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.ReadReceiptRequestMessage=p;var q=function(){function b(a){this.messageName="ReadReceiptResponseMessage",a.receiptMessageDic&&(this.receiptMessageDic=a.receiptMessageDic)}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.ReadReceiptResponseMessage=q;var r=function(){function b(a){this.messageName="PublicServiceRichContentMessage",this.richContentMessage=a}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.PublicServiceRichContentMessage=r;var s=function(){function b(a){this.messageName="FileMessage",a.name&&(this.name=a.name),a.size&&(this.size=a.size),a.type&&(this.type=a.type),a.fileUrl&&(this.fileUrl=a.fileUrl),a.extra&&(this.extra=a.extra),a.user&&(this.user=a.user)}return b.obtain=function(a){return new b({name:a.name,size:a.size,type:a.type,fileUrl:a.fileUrl})},b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.FileMessage=s;var t=function(){function a(a,b){this.Id=a,this.Key=b}return a}();a.ChannelInfo=t;var u=function(){function b(a){this.messageName="AcceptMessage",this.callId=a.callId,this.mediaType=a.mediaType}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.AcceptMessage=u;var v=function(){function b(a){this.messageName="RingingMessage",this.callId=a.callId}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.RingingMessage=v;var w=function(){function b(a){this.messageName="SummaryMessage",this.caller=a.caller,this.inviter=a.inviter,this.mediaType=a.mediaType,this.memberIdList=a.memberIdList,this.startTime=a.startTime,this.connectedTime=a.connectedTime,this.duration=a.duration,this.status=a.status}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.SummaryMessage=w;var x=function(){function b(a){this.messageName="HungupMessage",this.callId=a.callId,this.reason=a.reason}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.HungupMessage=x;var y=function(){function b(a){this.messageName="InviteMessage",this.callId=a.callId,this.engineType=a.engineType,this.channelInfo=a.channelInfo,this.mediaType=a.mediaType,this.extra=a.extra,this.inviteUserIds=a.inviteUserIds}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.InviteMessage=y;var z=function(){function b(a){this.messageName="MediaModifyMessage",this.callId=a.callId,this.mediaType=a.mediaType}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.MediaModifyMessage=z;var A=function(){function b(a){this.messageName="MemberModifyMessage",this.modifyMemType=a.modifyMemType,this.callId=a.callId,this.caller=a.caller,this.engineType=a.engineType,this.channelInfo=a.channelInfo,this.mediaType=a.mediaType,this.extra=a.extra,this.inviteUserIds=a.inviteUserIds,this.existedMemberStatusList=a.existedMemberStatusList}return b.prototype.encode=function(){return JSON.stringify(a.ModelUtil.modelClone(this))},b}();a.MemberModifyMessage=A}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function a(a,b,c){this.platform=a,this.online=b,this.status=c}return a}();a.UserStatus=b;var c=function(){function a(a,b,c){}return a}();a.MentionedInfo=c;var d=function(){function a(a,b,c){this.msgId=a,this.msgDataTime=b,this.direct=c}return a}();a.DeleteMessage=d;var e=function(){function a(a,b,c){}return a}();a.CustomServiceConfig=e;var f=function(){function a(a,b,c,d,e,f,g){}return a}();a.CustomServiceSession=f;var g=function(){function b(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){this.conversationTitle=a,this.conversationType=b,this.draft=c,this.isTop=d,this.latestMessage=e,this.latestMessageId=f,this.notificationStatus=g,this.objectName=h,this.receivedStatus=i,this.receivedTime=j,this.senderUserId=k,this.senderUserName=l,this.sentStatus=m,this.sentTime=n,this.targetId=o,this.unreadMessageCount=p,this.senderPortraitUri=q,this.isHidden=r,this.mentionedMsg=s,this.hasUnreadMention=t}return b.prototype.setTop=function(){a.RongIMClient._dataAccessProvider.addConversation(this,{onSuccess:function(a){}})},b}();a.Conversation=g;var h=function(){function a(a,b,c,d,e){this.creatorId=a,this.id=b,this.memberIdList=c,this.name=d,this.isOpen=e}return a}();a.Discussion=h;var i=function(){function a(a,b,c){this.id=a,this.name=b,this.portraitUri=c}return a}();a.Group=i;var j=function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){this.content=a,this.conversationType=b,this.extra=c,this.objectName=d,this.messageDirection=e,this.messageId=f,this.receivedStatus=g,this.receivedTime=h,this.senderUserId=i,this.sentStatus=j,this.sentTime=k,this.targetId=l,this.messageType=m,this.messageUId=n,this.isLocalMessage=o,this.offLineMessage=p,this.receiptResponse=q}return a}();a.Message=j;var k=function(){function a(a,b){this.isCounted=a,this.isPersited=b}return a.prototype.getMessageTag=function(){return this.isCounted&&this.isPersited?3:this.isCounted||!this.isPersited?2:!this.isCounted||this.isPersited?1:this.isCounted||this.isPersited?void 0:0},a}();a.MessageTag=k;var l=function(){function a(a,b,c,d,e){this.id=a,this.name=b,this.type=c,this.sunMenuItems=d,this.url=e}return a}();a.PublicServiceMenuItem=l;var m=function(){function a(a,b,c,d,e,f,g,h){this.conversationType=a,this.introduction=b,this.menu=c,this.name=d,this.portraitUri=e,this.publicServiceId=f,this.hasFollowed=g,this.isGlobal=h}return a}();a.PublicServiceProfile=m;var n=function(){function a(a,b,c){this.id=a,this.name=b,this.portraitUri=c}return a}();a.UserInfo=n}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(){this.database=new a.DBUtil}return b.prototype.init=function(b){new a.FeatureDectector},b.prototype.connect=function(b,c){if(a.RongIMClient.bridge=a.Bridge.getInstance(),a.RongIMClient._memoryStore.token=b,a.RongIMClient._memoryStore.callback=c,!a.Bridge._client||!a.Bridge._client.channel||a.Bridge._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTED||a.Bridge._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTING){for(var d=0,e=a.RongIMClient._memoryStore.listenerList.length;d<e;d++)a.RongIMClient.bridge.setListener(a.RongIMClient._memoryStore.listenerList[d]);a.RongIMClient._memoryStore.listenerList.length=0,a.RongIMClient.bridge.connect(a.RongIMClient._memoryStore.appKey,b,{onSuccess:function(a){setTimeout(function(){c.onSuccess(a)})},onError:function(b){b!=a.ConnectionState.TOKEN_INCORRECT&&b?setTimeout(function(){c.onError(b)}):setTimeout(function(){c.onTokenIncorrect()})}})}},b.prototype.reconnect=function(b){a.Bridge._client&&a.Bridge._client.channel&&a.Bridge._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTED&&a.Bridge._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTING&&a.RongIMClient.bridge.reconnect(b)},b.prototype.logout=function(){a.RongIMClient.bridge.disconnect(),a.RongIMClient.bridge=null},b.prototype.disconnect=function(){a.RongIMClient.bridge.disconnect()},b.prototype.sendReceiptResponse=function(b,c,d){var e=a.Bridge._client.userId+b+c+"RECEIVED",f=this;if(a.MessageUtil.supportLargeStorage()){var g=JSON.parse(a.RongIMClient._storageProvider.getItem(e));if(g){var h=[];for(var i in g){var j={};j[i]=g[i].uIds,g[i].isResponse||h.push(j)}if(0==h.length)return void d.onSuccess();var k=setInterval(function(){1==h.length&&clearInterval(k);var i=h.splice(0,1)[0],j=new a.ReadReceiptResponseMessage({receiptMessageDic:i});f.sendMessage(b,c,j,{onSuccess:function(b){var c=a.MessageUtil.getFirstKey(i);g[c].isResponse=!0,a.RongIMClient._storageProvider.setItem(e,JSON.stringify(g)),d.onSuccess(b)},onError:function(a,b){d.onError(a,b)}})},200)}else d.onSuccess()}else d.onSuccess()},b.prototype.sendTypingStatusMessage=function(b,c,d,e){var f=this;d in a.RongIMClient.MessageParams&&f.sendMessage(b,c,a.TypingStatusMessage.obtain(a.RongIMClient.MessageParams[d].objectName,""),{onSuccess:function(){setTimeout(function(){e.onSuccess()})},onError:function(a){setTimeout(function(){e.onError(a,null)})}})},b.prototype.sendRecallMessage=function(b,c){var d=new a.RecallCommandMessage({conversationType:b.conversationType,targetId:b.targetId,sentTime:b.sentTime,messageUId:b.messageUId,extra:b.extra,user:b.user});this.sendMessage(b.conversationType,b.senderUserId,d,c,!1,null,null,2)},b.prototype.sendTextMessage=function(b,c,d,e){var f=a.TextMessage.obtain(d);this.sendMessage(b,c,f,e)},b.prototype.getRemoteHistoryMessages=function(b,c,d,e,f){if(e<=1)throw new Error("the count must be greater than 1.");var g=new Modules.HistoryMessageInput;g.setTargetId(c),0===d||d>0?g.setDataTime(d):g.setDataTime(a.RongIMClient._memoryStore.lastReadTime.get(b+c)),g.setSize(e),a.RongIMClient.bridge.queryMsg(HistoryMsgType[b],a.MessageUtil.ArrayForm(g.toArrayBuffer()),c,{onSuccess:function(d){a.RongIMClient._memoryStore.lastReadTime.set(b+c,a.MessageUtil.int64ToTimestamp(d.syncTime));var e,g=d.list.reverse(),h=null;if(a.MessageUtil.supportLargeStorage())for(var i=0,j=g.length;i<j;i++)h=a.MessageUtil.messageParser(g[i]),e=JSON.parse(a.RongIMClient._storageProvider.getItem(a.Bridge._client.userId+h.messageUId+"SENT")),e&&(h.receiptResponse||(h.receiptResponse={}),h.receiptResponse[h.messageUId]=e.count),g[i]=h;else for(var i=0,j=g.length;i<j;i++)g[i]=a.MessageUtil.messageParser(g[i]);setTimeout(function(){f.onSuccess(g,!!d.hasMsg)})},onError:function(b){setTimeout(function(){b===a.ErrorCode.TIMEOUT?f.onError(b):f.onSuccess([],!1)})}},"HistoryMessagesOuput")},b.prototype.hasRemoteUnreadMessages=function(b,c){var d=null;window.RCCallback=function(a){setTimeout(function(){c.onSuccess(!!+a.status)}),d.parentNode.removeChild(d)},d=document.createElement("script"),d.src=a.RongIMClient._memoryStore.depend.api+"/message/exist.js?appKey="+encodeURIComponent(a.RongIMClient._memoryStore.appKey)+"&token="+encodeURIComponent(b)+"&callBack=RCCallback&_="+Date.now(),document.body.appendChild(d),d.onerror=function(){setTimeout(function(){c.onError(a.ErrorCode.UNKNOWN)}),d.parentNode.removeChild(d)}},b.prototype.getRemoteConversationList=function(b,c,d){var e=new Modules.RelationsInput;e.setType(1),"undefined"==typeof d?e.setCount(0):e.setCount(d),a.RongIMClient.bridge.queryMsg(26,a.MessageUtil.ArrayForm(e.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(d){if(d.info){d.info=d.info.reverse();for(var e=0,f=d.info.length;e<f;e++)a.RongIMClient.getInstance().pottingConversation(d.info[e])}if(c){var g=[];Array.forEach(c,function(b){Array.forEach(a.RongIMClient._memoryStore.conversationList,function(a){a.conversationType==b&&g.push(a)})}),b.onSuccess(g)}else b.onSuccess(a.RongIMClient._memoryStore.conversationList)},onError:function(c){c===a.ErrorCode.TIMEOUT?b.onError(c):b.onSuccess([])}},"RelationsOutput")},b.prototype.addMemberToDiscussion=function(b,c,d){var e=new Modules.ChannelInvitationInput;e.setUsers(c),a.RongIMClient.bridge.queryMsg(0,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){d.onSuccess()})},onError:function(){setTimeout(function(){d.onError(a.ErrorCode.JOIN_IN_DISCUSSION)})}})},b.prototype.createDiscussion=function(b,c,d){var e=new Modules.CreateDiscussionInput,f=this;e.setName(b),a.RongIMClient.bridge.queryMsg(1,a.MessageUtil.ArrayForm(e.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(a){c.length>0&&f.addMemberToDiscussion(a,c,{onSuccess:function(){},onError:function(a){setTimeout(function(){d.onError(a)})}}),setTimeout(function(){d.onSuccess(a)})},onError:function(){setTimeout(function(){d.onError(a.ErrorCode.CREATE_DISCUSSION)})}},"CreateDiscussionOutput")},b.prototype.getDiscussion=function(b,c){var d=new Modules.ChannelInfoInput;d.setNothing(1),a.RongIMClient.bridge.queryMsg(4,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(a){setTimeout(function(){c.onSuccess(a)})},onError:function(a){setTimeout(function(){c.onError(a)})}},"ChannelInfoOutput")},b.prototype.quitDiscussion=function(b,c){var d=new Modules.LeaveChannelInput;d.setNothing(1),a.RongIMClient.bridge.queryMsg(7,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,c)},b.prototype.removeMemberFromDiscussion=function(b,c,d){var e=new Modules.ChannelEvictionInput;e.setUser(c),a.RongIMClient.bridge.queryMsg(9,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,d)},b.prototype.setDiscussionInviteStatus=function(b,c,d){var e=new Modules.ModifyPermissionInput;e.setOpenStatus(c.valueOf()),a.RongIMClient.bridge.queryMsg(11,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,{onSuccess:function(a){setTimeout(function(){d.onSuccess()})},onError:function(){setTimeout(function(){d.onError(a.ErrorCode.INVITE_DICUSSION)})}})},b.prototype.setDiscussionName=function(b,c,d){var e=new Modules.RenameChannelInput;e.setName(c),a.RongIMClient.bridge.queryMsg(12,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){d.onSuccess()})},onError:function(a){d.onError(a)}})},b.prototype.joinGroup=function(b,c,d){var e=new Modules.GroupInfo;e.setId(b),e.setName(c);var f=new Modules.GroupInput;f.setGroupInfo([e]),a.RongIMClient.bridge.queryMsg(6,a.MessageUtil.ArrayForm(f.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){d.onSuccess()})},onError:function(a){d.onError(a)}},"GroupOutput")},b.prototype.quitGroup=function(b,c){var d=new Modules.LeaveChannelInput;d.setNothing(1),a.RongIMClient.bridge.queryMsg(8,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){c.onSuccess()})},onError:function(a){c.onError(a)}})},b.prototype.syncGroup=function(b,c){for(var d=0,e=[],f=[],g=b.length;d<g;d++)if(0===e.length||!(b[d].id in e)){e.push(b[d].id);var h=new Modules.GroupInfo;h.setId(b[d].id),h.setName(b[d].name),f.push(h)}var i=new Modules.GroupHashInput;i.setUserId(a.Bridge._client.userId),i.setGroupHashCode(md5(e.sort().join(""))),a.RongIMClient.bridge.queryMsg(13,a.MessageUtil.ArrayForm(i.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(b){if(1===b){var d=new Modules.GroupInput;d.setGroupInfo(f),a.RongIMClient.bridge.queryMsg(20,a.MessageUtil.ArrayForm(d.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(){setTimeout(function(){c.onSuccess()})},onError:function(){setTimeout(function(){c.onError(a.ErrorCode.GROUP_MATCH_ERROR)})}},"GroupOutput")}else setTimeout(function(){c.onSuccess()})},onError:function(){setTimeout(function(){c.onError(a.ErrorCode.GROUP_SYNC_ERROR)})}},"GroupHashOutput")},b.prototype.joinChatRoom=function(b,c,d){var e=new Modules.ChrmInput;e.setNothing(1),a.Bridge._client.chatroomId=b,a.RongIMClient.bridge.queryMsg(19,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,{onSuccess:function(){d.onSuccess();var e=new Modules.ChrmPullMsg;0==c&&(c=-1),e.setCount(c),e.setSyncTime(0),a.Bridge._client.queryMessage("chrmPull",a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,1,{onSuccess:function(c){var d=a.MessageUtil.int64ToTimestamp(c.syncTime);a.RongIMClient._memoryStore.lastReadTime.set(b+a.Bridge._client.userId+"CST",d);var e=c.list;if(a.RongIMClient._memoryStore.filterMessages.length>0)for(var f=0,g=e.length;f<g;f++)for(var h=0,i=a.RongIMClient._memoryStore.filterMessages.length;h<i;h++)a.RongIMClient.MessageParams[a.RongIMClient._memoryStore.filterMessages[h]].objectName!=e[f].classname&&a.Bridge._client.handler.onReceived(e[f]);else for(var f=0,j=e.length;f<j;f++)a.Bridge._client.handler.onReceived(e[f])},onError:function(b){setTimeout(function(){d.onError(a.ErrorCode.CHATROOM_HISMESSAGE_ERROR)})}},"DownStreamMessages")},onError:function(){setTimeout(function(){d.onError(a.ErrorCode.CHARTOOM_JOIN_ERROR)})}},"ChrmOutput")},b.prototype.getChatRoomInfo=function(b,c,d,e){var f=new Modules.QueryChatroomInfoInput;f.setCount(c),f.setOrder(d),a.RongIMClient.bridge.queryMsg("queryChrmI",a.MessageUtil.ArrayForm(f.toArrayBuffer()),b,{onSuccess:function(a){setTimeout(function(){e.onSuccess(a)})},onError:function(a){e.onError(a)}},"QueryChatroomInfoOutput")},b.prototype.quitChatRoom=function(b,c){var d=new Modules.ChrmInput;d.setNothing(1),a.RongIMClient.bridge.queryMsg(17,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){c.onSuccess()})},onError:function(a){c.onError(a)}},"ChrmOutput")},b.prototype.setChatroomHisMessageTimestamp=function(b,c){a.RongIMClient._memoryStore.lastReadTime.set("chrhis_"+b,c)},b.prototype.getChatRoomHistoryMessages=function(b,c,d,e){var f=new Modules.HistoryMsgInput;f.setTargetId(b);var g=a.RongIMClient._memoryStore.lastReadTime.get("chrhis_"+b)||0;f.setTime(g),f.setCount(c),f.setOrder(d),a.RongIMClient.bridge.queryMsg(34,a.MessageUtil.ArrayForm(f.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(c){a.RongIMClient._memoryStore.lastReadTime.set("chrhis_"+b,a.MessageUtil.int64ToTimestamp(c.syncTime));for(var d=c.list.reverse(),f=0,g=d.length;f<g;f++)d[f]=a.MessageUtil.messageParser(d[f]);setTimeout(function(){e.onSuccess(d,!!c.hasMsg)})},onError:function(b){setTimeout(function(){b===a.ErrorCode.TIMEOUT?e.onError(b):e.onSuccess([],!1)})}},"HistoryMsgOuput")},b.prototype.addToBlacklist=function(b,c){var d=new Modules.Add2BlackListInput;d.setUserId(b),a.RongIMClient.bridge.queryMsg(21,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(){c.onSuccess()},onError:function(){c.onError(a.ErrorCode.BLACK_ADD_ERROR)}})},b.prototype.getBlacklist=function(b){var c=new Modules.QueryBlackListInput;c.setNothing(1),a.RongIMClient.bridge.queryMsg(23,a.MessageUtil.ArrayForm(c.toArrayBuffer()),a.Bridge._client.userId,b,"QueryBlackListOutput")},b.prototype.getBlacklistStatus=function(b,c){var d=new Modules.BlackListStatusInput;d.setUserId(b),a.RongIMClient.bridge.queryMsg(24,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(b){setTimeout(function(){c.onSuccess(a.BlacklistStatus[b])})},onError:function(){setTimeout(function(){c.onError(a.ErrorCode.BLACK_GETSTATUS_ERROR)})}})},b.prototype.removeFromBlacklist=function(b,c){var d=new Modules.RemoveFromBlackListInput;d.setUserId(b),a.RongIMClient.bridge.queryMsg(22,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(){c.onSuccess()},onError:function(){c.onError(a.ErrorCode.BLACK_REMOVE_ERROR)}})},b.prototype.getFileToken=function(b,c){if(!/(1|2|3|4)/.test(b.toString()))return void c.onError(a.ErrorCode.QNTKN_FILETYPE_ERROR);var d=new Modules.GetQNupTokenInput;d.setType(b),a.RongIMClient.bridge.queryMsg(30,a.MessageUtil.ArrayForm(d.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(a){setTimeout(function(){c.onSuccess(a)})},onError:function(a){c.onError(a)}},"GetQNupTokenOutput")},b.prototype.getFileUrl=function(b,c,d,e){if(!/(1|2|3|4)/.test(b.toString()))return void setTimeout(function(){e.onError(a.ErrorCode.QNTKN_FILETYPE_ERROR)});var f=new Modules.GetQNdownloadUrlInput;f.setType(b),f.setKey(c),d&&f.setFileName(d),a.RongIMClient.bridge.queryMsg(31,a.MessageUtil.ArrayForm(f.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(a){setTimeout(function(){e.onSuccess(a)})},onError:function(a){e.onError(a)}},"GetQNdownloadUrlOutput")},b.prototype.sendMessage=function(b,c,d,e,f,g,h,i){if(!a.Bridge._client.channel)return void e.onError(a.ErrorCode.RC_NET_UNAVAILABLE,null);if(!a.Bridge._client.channel.socket.socket.connected)throw e.onError(a.ErrorCode.TIMEOUT,null),new Error("connect is timeout! postion:sendMessage");var j=new Modules.UpStreamMessage;if(!f||b!=a.ConversationType.DISCUSSION&&b!=a.ConversationType.GROUP?j.setSessionId(a.RongIMClient.MessageParams[d.messageName].msgTag.getMessageTag()):j.setSessionId(7),g&&j.setPushText(g),h&&j.setAppData(h),(b==a.ConversationType.DISCUSSION||b==a.ConversationType.GROUP)&&d.messageName==a.RongIMClient.MessageType.ReadReceiptResponseMessage){var k=d;if(k.receiptMessageDic){var l=[];for(var m in k.receiptMessageDic)l.push(m);j.setUserId(l)}}b!=a.ConversationType.DISCUSSION&&b!=a.ConversationType.GROUP||d.messageName!=a.RongIMClient.MessageType.SyncReadStatusMessage||j.setUserId(a.Bridge._client.userId),j.setClassname(a.RongIMClient.MessageParams[d.messageName].objectName),j.setContent(d.encode());var n=j.toArrayBuffer();"[object ArrayBuffer]"==Object.prototype.toString.call(n)&&(n=[].slice.call(new Int8Array(n)));var o=null,p=new a.Message;this.getConversation(b,c,{onSuccess:function(e){o=e,3==a.RongIMClient.MessageParams[d.messageName].msgTag.getMessageTag()&&(o||(o=a.RongIMClient.getInstance().createConversation(b,c,"")),o.sentTime=(new Date).getTime(),o.sentStatus=a.SentStatus.SENDING,o.senderUserName="",o.senderUserId=a.Bridge._client.userId,o.notificationStatus=a.ConversationNotificationStatus.DO_NOT_DISTURB,o.latestMessage=p,o.unreadMessageCount=0,a.RongIMClient._dataAccessProvider.addConversation(o,{onSuccess:function(a){}})),a.RongIMClient._memoryStore.converStore=o}}),p.content=d,p.conversationType=b,p.senderUserId=a.Bridge._client.userId,p.objectName=a.RongIMClient.MessageParams[d.messageName].objectName,p.targetId=c,p.sentTime=(new Date).getTime(),p.messageDirection=a.MessageDirection.SEND,p.sentStatus=a.SentStatus.SENT,p.messageType=d.messageName,a.RongIMClient.bridge.pubMsg(b.valueOf(),n,c,{onSuccess:function(f){if(f&&f.timestamp&&a.RongIMClient._memoryStore.lastReadTime.set("converST_"+a.Bridge._client.userId+b+c,f.timestamp),(b==a.ConversationType.DISCUSSION||b==a.ConversationType.GROUP)&&d.messageName==a.RongIMClient.MessageType.ReadReceiptRequestMessage){var g=p.content,h=a.Bridge._client.userId+g.messageUId+"SENT";a.RongIMClient._storageProvider.setItem(h,JSON.stringify({count:0,dealtime:f.timestamp,userIds:{}}))}3==a.RongIMClient.MessageParams[p.messageType].msgTag.getMessageTag()&&(a.RongIMClient._memoryStore.converStore.latestMessage=p,a.RongIMClient._dataAccessProvider.addMessage(b,c,p,{onSuccess:function(b){p=b,p.messageUId=f.messageUId,p.sentTime=f.timestamp,p.sentStatus=a.SentStatus.SENT,p.messageId=f.messageId,a.RongIMClient._dataAccessProvider.updateMessage(p)},onError:function(){}})),setTimeout(function(){p.sentTime=f.timestamp,e.onSuccess(p)})},onError:function(d){p.sentStatus=a.SentStatus.FAILED,3==a.RongIMClient.MessageParams[p.messageType].msgTag.getMessageTag()&&(a.RongIMClient._memoryStore.converStore.latestMessage=p),a.RongIMClient._dataAccessProvider.addMessage(b,c,p,{onSuccess:function(b){p.messageId=b.messageId,a.RongIMClient._dataAccessProvider.updateMessage(p)},onError:function(){}}),setTimeout(function(){e.onError(d,p)})}},null,i),p.messageId=a.MessageIdHandler.messageId+""},b.prototype.setConnectionStatusListener=function(b){a.RongIMClient.bridge?a.RongIMClient.bridge.setListener(b):a.RongIMClient._memoryStore.listenerList.push(b)},b.prototype.setOnReceiveMessageListener=function(b){a.RongIMClient.bridge?a.RongIMClient.bridge.setListener(b):a.RongIMClient._memoryStore.listenerList.push(b)},b.prototype.registerMessageType=function(b,c,d,e){if(!b)throw new Error("messageType can't be empty,postion -> registerMessageType");if(!c)throw new Error("objectName can't be empty,postion -> registerMessageType");if("[object Array]"==Object.prototype.toString.call(e)){var f=a.ModelUtil.modleCreate(e,b);a.RongIMClient.RegisterMessage[b]=f}else{if("[object Function]"!=Object.prototype.toString.call(e)&&"[object Object]"!=Object.prototype.toString.call(e))throw new Error("The index of 3 parameter was wrong type  must be object or function or array-> registerMessageType");if(!e.encode)throw new Error("encode method has not realized or messageName is undefined-> registerMessageType");if(!e.decode)throw new Error("decode method has not realized -> registerMessageType")}registerMessageTypeMapping[c]=b},b.prototype.addConversation=function(b,c){for(var d=!0,e=0,f=a.RongIMClient._memoryStore.conversationList.length;e<f;e++)if(a.RongIMClient._memoryStore.conversationList[e].conversationType===b.conversationType&&a.RongIMClient._memoryStore.conversationList[e].targetId===b.targetId){a.RongIMClient._memoryStore.conversationList.unshift(a.RongIMClient._memoryStore.conversationList.splice(e,1)[0]),d=!1;break}d&&a.RongIMClient._memoryStore.conversationList.unshift(b),c.onSuccess(!0)},b.prototype.updateConversation=function(b){for(var c,d=0,e=a.RongIMClient._memoryStore.conversationList.length;d<e;d++)if(b.conversationType===a.RongIMClient._memoryStore.conversationList[d].conversationType&&b.targetId===a.RongIMClient._memoryStore.conversationList[d].targetId){b.conversationTitle&&(a.RongIMClient._memoryStore.conversationList[d].conversationTitle=b.conversationTitle),b.senderUserName&&(a.RongIMClient._memoryStore.conversationList[d].senderUserName=b.senderUserName),b.senderPortraitUri&&(a.RongIMClient._memoryStore.conversationList[d].senderPortraitUri=b.senderPortraitUri),b.latestMessage&&(a.RongIMClient._memoryStore.conversationList[d].latestMessage=b.latestMessage);break}return c},b.prototype.removeConversation=function(b,c,d){var e=new Modules.RelationsInput;e.setType(b),a.RongIMClient.bridge.queryMsg(27,a.MessageUtil.ArrayForm(e.toArrayBuffer()),c,{onSuccess:function(){d.onSuccess(!0)},onError:function(){setTimeout(function(){d.onError(a.ErrorCode.CONVER_REMOVE_ERROR)})}})},b.prototype.getMessage=function(b,c){c.onSuccess(new a.Message)},b.prototype.addMessage=function(a,b,c,d){d&&d.onSuccess(c)},b.prototype.removeMessage=function(b,c,d,e){a.RongIMClient.getInstance().deleteRemoteMessages(b,c,d,e)},b.prototype.removeLocalMessage=function(a,b,c,d){d.onSuccess(!0)},b.prototype.updateMessage=function(a,b){b&&b.onSuccess(a)},b.prototype.clearMessages=function(a,b,c){c.onSuccess(!0)},b.prototype.updateMessages=function(b,c,d,e,f){var g=this;"readStatus"==d&&a.RongIMClient._memoryStore.conversationList.length>0&&g.getConversationList({onSuccess:function(a){Array.forEach(a,function(a){a.conversationType==b&&a.targetId==c&&(a.unreadMessageCount=0)})},onError:function(a){f.onError(a)}},null),f.onSuccess(!0)},b.prototype.getConversation=function(b,c,d){for(var e=null,f=0,g=a.RongIMClient._memoryStore.conversationList.length;f<g;f++)if(a.RongIMClient._memoryStore.conversationList[f].conversationType==b&&a.RongIMClient._memoryStore.conversationList[f].targetId==c&&(e=a.RongIMClient._memoryStore.conversationList[f],a.MessageUtil.supportLargeStorage())){var h=a.RongIMClient._storageProvider.getItem("cu"+a.Bridge._client.userId+b+c);0==e.unreadMessageCount&&(e.unreadMessageCount=Number(h))}d.onSuccess(e)},b.prototype.getConversationList=function(b,c,d,e){if(0==a.RongIMClient._memoryStore.conversationList.length||a.RongIMClient._memoryStore.isSyncRemoteConverList&&void 0!=typeof d&&a.RongIMClient._memoryStore.conversationList.length<d)a.RongIMClient.getInstance().getRemoteConversationList({onSuccess:function(c){a.MessageUtil.supportLargeStorage()&&Array.forEach(a.RongIMClient._memoryStore.conversationList,function(b){var c=a.RongIMClient._storageProvider.getItem("cu"+a.Bridge._client.userId+b.conversationType+b.targetId);0==b.unreadMessageCount&&(b.unreadMessageCount=Number(c))}),a.RongIMClient._memoryStore.isSyncRemoteConverList=!1,b.onSuccess(c)},onError:function(a){b.onSuccess([])}},c,d,e);else if(c){var f=[];Array.forEach(c,function(b){Array.forEach(a.RongIMClient._memoryStore.conversationList,function(a){a.conversationType==b&&f.push(a)})}),d>0&&(f.length=d),b.onSuccess(f)}else d&&(a.RongIMClient._memoryStore.conversationList.length=d),b.onSuccess(a.RongIMClient._memoryStore.conversationList)},b.prototype.clearConversations=function(b,c){Array.forEach(b,function(b){Array.forEach(a.RongIMClient._memoryStore.conversationList,function(c){b==c.conversationType&&a.RongIMClient.getInstance().removeConversation(c.conversationType,c.targetId,{onSuccess:function(){},onError:function(){}})})}),c.onSuccess(!0)},b.prototype.getHistoryMessages=function(b,c,d,e,f){a.RongIMClient.getInstance().getRemoteHistoryMessages(b,c,d,e,f)},b.prototype.getTotalUnreadCount=function(b,c){var d=0;if(c)for(var e=0,f=c.length;e<f;e++)Array.forEach(a.RongIMClient._memoryStore.conversationList,function(a){a.conversationType==c[e]&&(d+=a.unreadMessageCount)});else Array.forEach(a.RongIMClient._memoryStore.conversationList,function(a){d+=a.unreadMessageCount});b.onSuccess(d)},b.prototype.getConversationUnreadCount=function(b,c){var d=0;Array.forEach(b,function(b){Array.forEach(a.RongIMClient._memoryStore.conversationList,function(a){a.conversationType==b&&(d+=a.unreadMessageCount)})}),c.onSuccess(d)},b.prototype.getUnreadCount=function(a,b,c){this.getConversation(a,b,{onSuccess:function(a){c.onSuccess(a?a.unreadMessageCount:0)},onError:function(a){c.onError(a)}})},b.prototype.clearUnreadCountByTimestamp=function(a,b,c,d){d.onSuccess(!0)},b.prototype.clearUnreadCount=function(b,c,d){this.getConversation(b,c,{onSuccess:function(e){if(e){a.MessageUtil.supportLargeStorage()&&a.RongIMClient._storageProvider.removeItem("cu"+a.Bridge._client.userId+b+c),e.unreadMessageCount=0,e.mentionedMsg=null;var f=a.RongIMClient._storageProvider.getItem("mentioneds_"+a.Bridge._client.userId+"_"+b+"_"+c);if(f){var g=JSON.parse(f);delete g[b+"_"+c],a.MessageUtil.isEmpty(g)?a.RongIMClient._storageProvider.removeItem("mentioneds_"+a.Bridge._client.userId+"_"+b+"_"+c):a.RongIMClient._storageProvider.setItem("mentioneds_"+a.Bridge._client.userId+"_"+b+"_"+c,JSON.stringify(g))}}d.onSuccess(!0)},onError:function(a){d.onError(a)}})},b.prototype.setConversationToTop=function(a,b,c,d){var e=this;this.getConversation(a,b,{onSuccess:function(a){a.isTop=c,e.addConversation(a,d),d.onSuccess(!0)},onError:function(a){d.onError(a)}})},b.prototype.clearListeners=function(){},b.prototype.setServerInfo=function(a){},b.prototype.getUnreadMentionedMessages=function(a,b){return null},b.prototype.setConversationHidden=function(a,b,c){},b.prototype.setMessageExtra=function(a,b,c){c.onSuccess(!0)},b.prototype.setMessageReceivedStatus=function(a,b,c){c.onSuccess(!0)},b.prototype.setMessageSentStatus=function(a,b,c){c.onSuccess(!0)},b.prototype.getAllConversations=function(a){a.onSuccess([])},b.prototype.getConversationByContent=function(a,b){b.onSuccess([])},b.prototype.getMessagesFromConversation=function(a,b,c,d){d.onSuccess([])},b.prototype.searchConversationByContent=function(a,b,c){b.onSuccess([])},b.prototype.searchMessageByContent=function(a,b,c,d,e,f,g){g.onSuccess([])},b.prototype.getDelaTime=function(){return a.RongIMClient._memoryStore.deltaTime},b.prototype.getUserStatus=function(b,c){c.onSuccess(new a.UserStatus)},b.prototype.setUserStatus=function(a,b){b.onSuccess(!0)},b.prototype.subscribeUserStatus=function(a,b){b.onSuccess(!0)},b.prototype.setOnReceiveStatusListener=function(a){a()},b}();a.ServerDataProvider=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(a){this.userId="",this.useConsole=!1,this.addon=a}return b.prototype.init=function(a){this.useConsole&&console.log("init"),this.addon.initWithAppkey(a),this.addon.registerMessageType("RC:VcMsg",3),this.addon.registerMessageType("RC:ImgTextMsg",3),this.addon.registerMessageType("RC:FileMsg",3),this.addon.registerMessageType("RC:LBSMsg",3),this.addon.registerMessageType("RC:PSImgTxtMsg",3),this.addon.registerMessageType("RC:PSMultiImgTxtMsg",3),this.addon.registerMessageType("RCJrmf:RpMsg",3),this.addon.registerMessageType("RCJrmf:RpOpendMsg",1),this.addon.registerMessageType("RC:GrpNtf",1),this.addon.registerMessageType("RC:DizNtf",0),this.addon.registerMessageType("RC:InfoNtf",0),this.addon.registerMessageType("RC:ContactNtf",0),this.addon.registerMessageType("RC:ProfileNtf",0),this.addon.registerMessageType("RC:CmdNtf",0),this.addon.registerMessageType("RC:CmdMsg",0),this.addon.registerMessageType("RC:TypSts",0),this.addon.registerMessageType("RC:CsChaR",0),this.addon.registerMessageType("RC:CsHsR",0),this.addon.registerMessageType("RC:CsEnd",0),this.addon.registerMessageType("RC:CsSp",0),this.addon.registerMessageType("RC:CsUpdate",0),this.addon.registerMessageType("RC:CsContact",0),this.addon.registerMessageType("RC:ReadNtf",0),
this.addon.registerMessageType("RC:VCAccept",0),this.addon.registerMessageType("RC:VCRinging",0),this.addon.registerMessageType("RC:VCSummary",0),this.addon.registerMessageType("RC:VCHangup",0),this.addon.registerMessageType("RC:VCInvite",0),this.addon.registerMessageType("RC:VCModifyMedia",0),this.addon.registerMessageType("RC:VCModifyMem",0),this.addon.registerMessageType("RC:PSCmd",0),this.addon.registerMessageType("RC:RcCmd",0),this.addon.registerMessageType("RC:SRSMsg",0),this.addon.registerMessageType("RC:RRReqMsg",0),this.addon.registerMessageType("RC:RRRspMsg",0)},b.prototype.connect=function(a,b,c){this.useConsole&&console.log("connect"),this.userId=c,this.connectCallback=b,this.addon.connectWithToken(a,c)},b.prototype.setServerInfo=function(a){"setServerInfo"in this.addon&&this.addon.setServerInfo(a.navi)},b.prototype.logout=function(){this.useConsole&&console.log("logout"),this.disconnect()},b.prototype.disconnect=function(){this.useConsole&&console.log("disconnect"),this.addon.disconnect(!0)},b.prototype.clearListeners=function(){this.addon.setOnReceiveStatusListener(),this.addon.setConnectionStatusListener(),this.addon.setOnReceiveMessageListener()},b.prototype.setConnectionStatusListener=function(b){var c=this;c.connectListener=b,this.useConsole&&console.log("setConnectionStatusListener"),c.addon.setConnectionStatusListener(function(d){switch(d){case 10:b.onChanged(a.ConnectionStatus.CONNECTING);break;case 31004:c.connectCallback.onTokenIncorrect();break;case 1:case 8:case 9:case 11:case 12:case 31011:case 3e4:case 30002:case 30004:case 30005:case 30006:case 30007:case 30008:case 30009:b.onChanged(a.ConnectionStatus.DISCONNECTED);break;case 0:case 33005:c.connectCallback.onSuccess(c.userId),b.onChanged(a.ConnectionStatus.CONNECTED);break;case 6:b.onChanged(a.ConnectionStatus.KICKED_OFFLINE_BY_OTHER_CLIENT)}})},b.prototype.setOnReceiveMessageListener=function(a){var b=this,c=0;b.messageListener=a,this.useConsole&&console.log("setOnReceiveMessageListener"),b.addon.setOnReceiveMessageListener(function(d,e){var f=b.buildMessage(d);0==e&&1==c||e>0?f.offLineMessage=!0:f.offLineMessage=!1,c=e,a.onReceived(f,e)})},b.prototype.sendTypingStatusMessage=function(b,c,d,e){var f=this;this.useConsole&&console.log("sendTypingStatusMessage"),d in a.RongIMClient.MessageParams&&f.sendMessage(b,c,a.TypingStatusMessage.obtain(a.RongIMClient.MessageParams[d].objectName,""),{onSuccess:function(){setTimeout(function(){e.onSuccess()})},onError:function(a){setTimeout(function(){e.onError(a,null)})}})},b.prototype.sendTextMessage=function(b,c,d,e){var f=a.TextMessage.obtain(d);this.useConsole&&console.log("sendTextMessage"),this.sendMessage(b,c,f,e)},b.prototype.getRemoteHistoryMessages=function(b,c,d,e,f){try{this.useConsole&&console.log("getRemoteHistoryMessages"),this.addon.getRemoteHistoryMessages(b,c,d?d:0,e,function(a,b){var c=a?JSON.parse(a).list:[],d=[],e=this;c.reverse();for(var g=0,h=c.length;g<h;g++)d[g]=e.buildMessage(c[g].obj);f.onSuccess(d,!!b)},function(a){f.onError(a)})}catch(g){f.onError(a.ErrorCode.TIMEOUT)}},b.prototype.getRemoteConversationList=function(b,c,d,e){try{this.useConsole&&console.log("getRemoteConversationList");var f=c||[1,2,3,4,5,6,7,8],g=this.addon.getConversationList(f),h=JSON.parse(g).list,i=[],j=this,k=0;h.reverse(),e="boolean"==typeof e&&e;for(var l=0,m=h.length;l<m;l++){var n=h[l].obj,o=JSON.parse(n);1==o.isHidden&&e||(i[k]=j.buildConversation(n),k++)}i.reverse(),b.onSuccess(i)}catch(p){b.onError(a.ErrorCode.CONVER_GETLIST_ERROR)}},b.prototype.removeConversation=function(b,c,d){try{this.useConsole&&console.log("removeConversation"),this.addon.removeConversation(b,c),d.onSuccess(!0)}catch(e){d.onError(a.ErrorCode.CONVER_REMOVE_ERROR)}},b.prototype.joinChatRoom=function(a,b,c){this.useConsole&&console.log("joinChatRoom"),this.addon.joinChatRoom(a,b,function(){c.onSuccess()},function(a){c.onError(a)})},b.prototype.quitChatRoom=function(a,b){this.useConsole&&console.log("quitChatRoom"),this.addon.quitChatRoom(a,function(){b.onSuccess()},function(a){b.onError(a)})},b.prototype.addToBlacklist=function(a,b){this.useConsole&&console.log("addToBlacklist"),this.addon.addToBlacklist(a,function(){b.onSuccess()},function(a){b.onError(a)})},b.prototype.getBlacklist=function(a){this.useConsole&&console.log("getBlacklist"),this.addon.getBlacklist(function(b){a.onSuccess(b)},function(b){a.onError(b)})},b.prototype.getBlacklistStatus=function(a,b){this.useConsole&&console.log("getBlacklistStatus"),this.addon.getBlacklistStatus(a,function(a){b.onSuccess(a)},function(a){b.onError(a)})},b.prototype.removeFromBlacklist=function(a,b){this.useConsole&&console.log("removeFromBlacklist"),this.addon.removeFromBlacklist(a,function(){b.onSuccess()},function(a){b.onError(a)})},b.prototype.sendMessage=function(b,c,d,e,f,g,h){var i=this,j=[];if(i.useConsole&&console.log("sendMessage"),(b==a.ConversationType.DISCUSSION||b==a.ConversationType.GROUP)&&d.messageName==a.RongIMClient.MessageType.ReadReceiptResponseMessage){var k=d;if(k.receiptMessageDic){var l=[];for(var m in k.receiptMessageDic)l.push(m);j=l}}b!=a.ConversationType.DISCUSSION&&b!=a.ConversationType.GROUP||d.messageName!=a.RongIMClient.MessageType.SyncReadStatusMessage||j.push(i.userId);var n=i.addon.sendMessage(b,c,a.RongIMClient.MessageParams[d.messageName].objectName,d.encode(),g||"",h||"",function(a){},function(a){e.onSuccess(i.buildMessage(a))},function(a,b){e.onError(b,i.buildMessage(a))},j),o=JSON.parse(n);a.MessageIdHandler.messageId=o.messageId},b.prototype.registerMessageType=function(a,b,c,d){this.useConsole&&console.log("registerMessageType"),this.addon.registerMessageType(b,c.getMessageTag())},b.prototype.addMessage=function(b,c,d,e){this.useConsole&&console.log("addMessage");var f=this.addon.insertMessage(b,c,d.senderUserId,d.objectName,d.content.encode(),function(){e.onSuccess(g.buildMessage(f))},function(){e.onError(a.ErrorCode.MSG_INSERT_ERROR)}),g=this},b.prototype.removeMessage=function(a,b,c,d){},b.prototype.removeLocalMessage=function(b,c,d,e){try{this.useConsole&&console.log("removeLocalMessage"),this.addon.deleteMessages(d),e.onSuccess(!0)}catch(f){e.onError(a.ErrorCode.MSG_DEL_ERROR)}},b.prototype.getMessage=function(b,c){try{this.useConsole&&console.log("getMessage");var d=this.addon.getMessage(b);c.onSuccess(d)}catch(e){c.onError(a.ErrorCode.GET_MESSAGE_BY_ID_ERROR)}},b.prototype.clearMessages=function(b,c,d){try{this.useConsole&&console.log("clearMessages"),this.addon.clearMessages(b,c),d.onSuccess(!0)}catch(e){d.onError(a.ErrorCode.CONVER_GET_ERROR)}},b.prototype.getConversation=function(b,c,d){try{this.useConsole&&console.log("getConversation");var e=this.addon.getConversation(b,c);d.onSuccess(this.buildConversation(e))}catch(f){d.onError(a.ErrorCode.CONVER_GET_ERROR)}},b.prototype.getConversationList=function(a,b,c,d){this.useConsole&&console.log("getConversationList"),this.getRemoteConversationList(a,b,c,d)},b.prototype.clearConversations=function(b,c){try{this.useConsole&&console.log("clearConversations"),this.addon.clearConversations(),c.onSuccess(!0)}catch(d){c.onError(a.ErrorCode.CONVER_CLEAR_ERROR)}},b.prototype.getHistoryMessages=function(b,c,d,e,f,g){if(this.useConsole&&console.log("getHistoryMessages"),e<=0)return void f.onError(a.ErrorCode.TIMEOUT);g=g||"";try{var h=this.addon.getHistoryMessages(b,c,d?d:0,e,g),i=h?JSON.parse(h).list:[],j=[],k=this;i.reverse();for(var l=0,m=i.length;l<m;l++)j[l]=k.buildMessage(i[l].obj);f.onSuccess(j,m==e)}catch(n){f.onError(a.ErrorCode.TIMEOUT)}},b.prototype.getTotalUnreadCount=function(b,c){try{var d;this.useConsole&&console.log("getTotalUnreadCount"),d=c?this.addon.getTotalUnreadCount(c):this.addon.getTotalUnreadCount(),b.onSuccess(d)}catch(e){b.onError(a.ErrorCode.CONVER_TOTAL_UNREAD_ERROR)}},b.prototype.getConversationUnreadCount=function(a,b){this.useConsole&&console.log("getConversationUnreadCount"),this.getTotalUnreadCount(b,a)},b.prototype.getUnreadCount=function(b,c,d){try{this.useConsole&&console.log("getUnreadCount");var e=this.addon.getUnreadCount(b,c);d.onSuccess(e)}catch(f){d.onError(a.ErrorCode.CONVER_TYPE_UNREAD_ERROR)}},b.prototype.clearUnreadCount=function(b,c,d){try{this.useConsole&&console.log("clearUnreadCount");this.addon.clearUnreadCount(b,c);d.onSuccess(!0)}catch(e){d.onError(a.ErrorCode.CONVER_CLEAR_ERROR)}},b.prototype.clearUnreadCountByTimestamp=function(b,c,d,e){try{this.useConsole&&console.log("clearUnreadCountByTimestamp");this.addon.clearUnreadCountByTimestamp(b,c,d);e.onSuccess(!0)}catch(f){e.onError(a.ErrorCode.CONVER_CLEAR_ERROR)}},b.prototype.setConversationToTop=function(b,c,d,e){try{this.useConsole&&console.log("setConversationToTop"),this.addon.setConversationToTop(b,c,d),e.onSuccess(!0)}catch(f){e.onError(a.ErrorCode.CONVER_SETOP_ERROR)}},b.prototype.setConversationHidden=function(a,b,c){this.addon.setConversationHidden(a,b,c)},b.prototype.setMessageReceivedStatus=function(b,c,d){try{this.useConsole&&console.log("setMessageReceivedStatus"),this.addon.setMessageReceivedStatus(b,c),d.onSuccess(!0)}catch(e){d.onError(a.ErrorCode.TIMEOUT)}},b.prototype.setMessageSentStatus=function(b,c,d){try{this.useConsole&&console.log("setMessageSentStatus"),this.addon.setMessageSentStatus(b,c),d.onSuccess(!0)}catch(e){d.onError(a.ErrorCode.TIMEOUT)}},b.prototype.getFileToken=function(a,b){this.useConsole&&console.log("getFileToken"),this.addon.getUploadToken(a,function(a){b.onSuccess({token:a})},function(a){b.onError(a)})},b.prototype.getFileUrl=function(a,b,c,d){this.useConsole&&console.log("getFileUrl"),this.addon.getDownloadUrl(a,b,c,function(a){d.onSuccess({downloadUrl:a})},function(a){d.onError(a)})},b.prototype.searchConversationByContent=function(b,c,d){var e=[];e="undefined"==typeof d?[1,2,3,4,5,6,7]:d;try{this.useConsole&&console.log("searchConversationByContent");var f=this.addon.searchConversationByContent(e,b),g=JSON.parse(f).list,h=[],i=this;g.reverse();for(var j=0,k=g.length;j<k;j++)h[j]=i.buildConversation(g[j].obj);c.onSuccess(h)}catch(l){c.onError(a.ErrorCode.CONVER_GETLIST_ERROR)}},b.prototype.searchMessageByContent=function(b,c,d,e,f,g,h){var i=this;try{this.useConsole&&console.log("searchMessageByContent"),this.addon.searchMessageByContent(b,c,d,e,f,g,function(a,b){var c=a?JSON.parse(a).list:[],d=[];c.reverse();for(var e=0,f=c.length;e<f;e++)d[e]=i.buildMessage(c[e].obj);h.onSuccess(d,b)})}catch(j){h.onError(a.ErrorCode.TIMEOUT)}},b.prototype.getChatRoomInfo=function(a,b,c,d){this.useConsole&&console.log("getChatRoomInfo"),this.addon.getChatroomInfo(a,b,c,function(a,b){var c=a?JSON.parse(a).list:[],e={userInfos:[],userTotalNums:b};if(c.length>0)for(var f=0,g=c.length;f<g;f++)e.userInfos.push(JSON.parse(c[f].obj));d.onSuccess(e)},function(a){d.onError(a)})},b.prototype.setChatroomHisMessageTimestamp=function(a,b){},b.prototype.getChatRoomHistoryMessages=function(a,b,c,d){},b.prototype.getDelaTime=function(){return this.addon.getDeltaTime()},b.prototype.getUserStatus=function(a,b){var c=this;this.addon.getUserStatus(a,function(a){b.onSuccess(c.buildUserStatus(a))},function(a){b.onError(a)})},b.prototype.setUserStatus=function(a,b){this.addon.setUserStatus(a,function(){b.onSuccess(!0)},function(a){b.onError(a)})},b.prototype.subscribeUserStatus=function(a,b){this.addon.subscribeUserStatus(a,function(){b.onSuccess(!0)},function(a){b.onError(a)})},b.prototype.setOnReceiveStatusListener=function(a){var b=this;this.addon.setOnReceiveStatusListener(function(c,d){a(c,b.buildUserStatus(d))})},b.prototype.getUnreadMentionedMessages=function(a,b){for(var c=this,d=JSON.parse(c.addon.getUnreadMentionedMessages(a,b)).list,e=0,f=d.length;e<f;e++){var g=JSON.parse(d[e].obj);g.content=JSON.parse(g.content),d[e]=g}return d},b.prototype.hasRemoteUnreadMessages=function(a,b){b.onSuccess(!1)},b.prototype.sendRecallMessage=function(a,b){},b.prototype.updateMessage=function(a,b){},b.prototype.updateMessages=function(a,b,c,d,e){},b.prototype.reconnect=function(a){},b.prototype.sendReceiptResponse=function(a,b,c){},b.prototype.setMessageExtra=function(a,b,c){},b.prototype.addMemberToDiscussion=function(a,b,c){},b.prototype.createDiscussion=function(a,b,c){},b.prototype.getDiscussion=function(a,b){},b.prototype.quitDiscussion=function(a,b){},b.prototype.removeMemberFromDiscussion=function(a,b,c){},b.prototype.setDiscussionInviteStatus=function(a,b,c){},b.prototype.setDiscussionName=function(a,b,c){},b.prototype.joinGroup=function(a,b,c){},b.prototype.quitGroup=function(a,b){},b.prototype.syncGroup=function(a,b){},b.prototype.addConversation=function(a,b){},b.prototype.updateConversation=function(a){return null},b.prototype.buildUserStatus=function(b){var c=new a.UserStatus,d=JSON.parse(b);return d.us&&d.us[0]&&(c.platform=d.us[0].p,c.online=!!d.us[0].o,c.status=d.us[0].s),c},b.prototype.buildMessage=function(b){var c=new a.Message,d=JSON.parse(b);return c.conversationType=d.conversationType,c.targetId=d.targetId,c.messageDirection=d.direction,c.senderUserId=d.senderUserId,d.direction==a.MessageDirection.RECEIVE?c.receivedStatus=d.status:d.direction==a.MessageDirection.SEND&&(c.sentStatus=d.status),c.sentTime=d.sentTime,c.objectName=d.objectName,c.content=d.content?JSON.parse(d.content):d.content,c.messageId=d.messageId,c.messageUId=d.messageUid,c.messageType=typeMapping[d.objectName],c},b.prototype.buildConversation=function(b){var c=new a.Conversation,d=JSON.parse(b),e=d.lastestMsg?this.buildMessage(d.lastestMsg):{};return c.conversationTitle=d.title,c.conversationType=d.conversationType,c.draft=d.draft,c.isTop=d.isTop,c.isHidden=d.isHidden,e.conversationType=d.conversationType,e.targetId=d.targetId,c.latestMessage=e,c.latestMessageId=e.messageId,c.latestMessage.messageType=typeMapping[e.objectName],c.objectName=e.objectName,c.receivedStatus=a.ReceivedStatus.READ,c.sentTime=e.sentTime,c.senderUserId=e.senderUserId,c.sentStatus=e.status,c.targetId=d.targetId,c.unreadMessageCount=d.unreadCount,c.hasUnreadMention=d.m_hasUnreadMention,e.content&&e.content.mentionedInfo&&(c.mentionedMsg={uid:e.messageUId,time:e.sentTime,mentionedInfo:e.content.mentionedInfo}),c},b}();a.VCDataProvider=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function a(){}return a.prototype.init=function(a){var b=this,c=!1;if(b.userId=a,b.db=openDatabase("RongIMLibDB","1.0","RongIMLibDB",10485760),b.db){c=!0;var d="create table if not exists t_conversation_"+a+" (conversationType,targetId,content,sentTime,isTop)",e="create table if not exists t_message_"+a+" (id integer not null primary key autoincrement,messageType,messageUId,conversationType,targetId,sentTime,content,localMsg)";b.execUpdate(d),b.execUpdate(e)}return c},a.prototype.execSearchByParams=function(a,b,c){this.db.transaction(function(d){d.executeSql(a,b,function(a,b){c(b.rows,b.rowsAffected)},function(a,b){throw new Error("{errorCode:"+b.code+",content:"+b.message+"}")})})},a.prototype.execSearch=function(a,b){this.db.transaction(function(c){c.executeSql(a,[],function(a,c){b(c.rows,c.rowsAffected)},function(a,b){throw new Error("{errorCode:"+b.code+",content:"+b.message+"}")})})},a.prototype.execUpdateByParams=function(a,b){this.db.transaction(function(c){c.executeSql(a,b)},function(a,b){throw new Error("{errorCode:"+a.code+",content:"+a.message+"}")})},a.prototype.execUpdate=function(a){this.db.transaction(function(b){b.executeSql(a)},function(a,b){throw new Error("{errorCode:"+a.code+",content:"+a.message+"}")})},a}();a.DBUtil=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(){this.database=new a.DBUtil}return b.prototype.init=function(a){},b.prototype.connect=function(b,c){if(a.RongIMClient.bridge=a.Bridge.getInstance(),a.RongIMClient._memoryStore.token=b,a.RongIMClient._memoryStore.callback=c,!a.Bridge._client||!a.Bridge._client.channel||a.Bridge._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTED||a.Bridge._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTING){a.RongIMClient.bridge.connect(a.RongIMClient._memoryStore.appKey,b,{onSuccess:function(a){setTimeout(function(){c.onSuccess(a)})},onError:function(b){b!=a.ConnectionState.TOKEN_INCORRECT&&b?setTimeout(function(){c.onError(b)}):setTimeout(function(){c.onTokenIncorrect()})}});for(var d=0,e=a.RongIMClient._memoryStore.listenerList.length;d<e;d++)a.RongIMClient.bridge.setListener(a.RongIMClient._memoryStore.listenerList[d]);a.RongIMClient._memoryStore.listenerList.length=0}},b.prototype.reconnect=function(b){a.Bridge._client&&a.Bridge._client.channel&&a.Bridge._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTED&&a.Bridge._client.channel.connectionStatus!=a.ConnectionStatus.CONNECTING&&a.RongIMClient.bridge.reconnect(b)},b.prototype.logout=function(){a.RongIMClient.bridge.disconnect(),a.RongIMClient.bridge=null},b.prototype.disconnect=function(){a.RongIMClient.bridge.disconnect()},b.prototype.sendReceiptResponse=function(b,c,d){var e=a.Bridge._client.userId+b+c+"RECEIVED",f=this;if(a.MessageUtil.supportLargeStorage()){var g=JSON.parse(a.RongIMClient._storageProvider.getItem(e));if(g){var h=[];for(var i in g){var j={};j[i]=g[i].uIds,g[i].isResponse||h.push(j)}if(0==h.length)return void d.onSuccess();var k=setInterval(function(){1==h.length&&clearInterval(k);var i=h.splice(0,1)[0],j=new a.ReadReceiptResponseMessage({receiptMessageDic:i});f.sendMessage(b,c,j,{onSuccess:function(b){var c=a.MessageUtil.getFirstKey(i);g[c].isResponse=!0,a.RongIMClient._storageProvider.setItem(e,JSON.stringify(g)),d.onSuccess(b)},onError:function(a,b){d.onError(a,b)}})},200)}else d.onSuccess()}else d.onSuccess()},b.prototype.sendTypingStatusMessage=function(b,c,d,e){var f=this;d in a.RongIMClient.MessageParams&&f.sendMessage(b,c,a.TypingStatusMessage.obtain(a.RongIMClient.MessageParams[d].objectName,""),{onSuccess:function(){setTimeout(function(){e.onSuccess()})},onError:function(a){setTimeout(function(){e.onError(a,null)})}})},b.prototype.sendTextMessage=function(b,c,d,e){var f=a.TextMessage.obtain(d);this.sendMessage(b,c,f,e)},b.prototype.sendRecallMessage=function(b,c,d){var e=new a.RecallCommandMessage({conversationType:b.conversationType,targetId:b.targetId,sentTime:b.sentTime,messageUId:b.messageUId,extra:b.extra,user:b.user});this.sendMessage(b.conversationType,b.targetId,e,c,!1,null,null,2)},b.prototype.getRemoteHistoryMessages=function(b,c,d,e,f){var g=new Modules.HistoryMessageInput;g.setTargetId(c),0===d||d>0?g.setDataTime(d):g.setDataTime(a.RongIMClient._memoryStore.lastReadTime.get(b+c)),g.setSize(e),a.RongIMClient.bridge.queryMsg(HistoryMsgType[b],a.MessageUtil.ArrayForm(g.toArrayBuffer()),c,{onSuccess:function(d){a.RongIMClient._memoryStore.lastReadTime.set(b+c,a.MessageUtil.int64ToTimestamp(d.syncTime));var e,g=d.list.reverse(),h=null;if(a.MessageUtil.supportLargeStorage())for(var i=0,j=g.length;i<j;i++)h=a.MessageUtil.messageParser(g[i]),e=JSON.parse(a.RongIMClient._storageProvider.getItem(a.Bridge._client.userId+h.messageUId+"SENT")),e&&(h.receiptResponse||(h.receiptResponse={}),h.receiptResponse[h.messageUId]=e.count),g[i]=h;else for(var i=0,j=g.length;i<j;i++)g[i]=a.MessageUtil.messageParser(g[i]);setTimeout(function(){f.onSuccess(g,!!d.hasMsg)})},onError:function(b){setTimeout(function(){b===a.ErrorCode.TIMEOUT?f.onError(b):f.onSuccess([],!1)})}},"HistoryMessagesOuput")},b.prototype.hasRemoteUnreadMessages=function(b,c){var d=null;window.RCCallback=function(a){setTimeout(function(){c.onSuccess(!!+a.status)}),d.parentNode.removeChild(d)},d=document.createElement("script"),d.src=a.RongIMClient._memoryStore.depend.api+"/message/exist.js?appKey="+encodeURIComponent(a.RongIMClient._memoryStore.appKey)+"&token="+encodeURIComponent(b)+"&callBack=RCCallback&_="+Date.now(),document.body.appendChild(d),d.onerror=function(){setTimeout(function(){c.onError(a.ErrorCode.UNKNOWN)}),d.parentNode.removeChild(d)}},b.prototype.getRemoteConversationList=function(b,c,d){var e=new Modules.RelationsInput;e.setType(1),"undefined"==typeof d?e.setCount(0):e.setCount(d),a.RongIMClient.bridge.queryMsg(26,a.MessageUtil.ArrayForm(e.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(d){if(a.RongIMClient._memoryStore.conversationList.length=0,d.info){d.info=d.info.reverse();for(var e=0,f=d.info.length;e<f;e++)a.RongIMClient.getInstance().pottingConversation(d.info[e])}if(c){var g=[];Array.forEach(c,function(b){Array.forEach(a.RongIMClient._memoryStore.conversationList,function(a){a.conversationType==b&&g.push(a)})}),b.onSuccess(g)}else b.onSuccess(a.RongIMClient._memoryStore.conversationList)},onError:function(c){c===a.ErrorCode.TIMEOUT?b.onError(c):b.onSuccess([])}},"RelationsOutput")},b.prototype.addMemberToDiscussion=function(b,c,d){var e=new Modules.ChannelInvitationInput;e.setUsers(c),a.RongIMClient.bridge.queryMsg(0,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){d.onSuccess()})},onError:function(){setTimeout(function(){d.onError(a.ErrorCode.JOIN_IN_DISCUSSION)})}})},b.prototype.createDiscussion=function(b,c,d){var e=new Modules.CreateDiscussionInput,f=this;e.setName(b),a.RongIMClient.bridge.queryMsg(1,a.MessageUtil.ArrayForm(e.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(a){c.length>0&&f.addMemberToDiscussion(a,c,{onSuccess:function(){},onError:function(a){setTimeout(function(){d.onError(a)})}}),setTimeout(function(){d.onSuccess(a)})},onError:function(){setTimeout(function(){d.onError(a.ErrorCode.CREATE_DISCUSSION)})}},"CreateDiscussionOutput")},b.prototype.getDiscussion=function(b,c){var d=new Modules.ChannelInfoInput;d.setNothing(1),a.RongIMClient.bridge.queryMsg(4,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(a){setTimeout(function(){c.onSuccess(a)})},onError:function(a){setTimeout(function(){c.onError(a)})}},"ChannelInfoOutput")},b.prototype.quitDiscussion=function(b,c){var d=new Modules.LeaveChannelInput;d.setNothing(1),a.RongIMClient.bridge.queryMsg(7,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,c)},b.prototype.removeMemberFromDiscussion=function(b,c,d){var e=new Modules.ChannelEvictionInput;e.setUser(c),a.RongIMClient.bridge.queryMsg(9,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,d)},b.prototype.setDiscussionInviteStatus=function(b,c,d){var e=new Modules.ModifyPermissionInput;e.setOpenStatus(c.valueOf()),a.RongIMClient.bridge.queryMsg(11,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,{onSuccess:function(a){setTimeout(function(){d.onSuccess()})},onError:function(){setTimeout(function(){d.onError(a.ErrorCode.INVITE_DICUSSION)})}})},b.prototype.setDiscussionName=function(b,c,d){var e=new Modules.RenameChannelInput;e.setName(c),a.RongIMClient.bridge.queryMsg(12,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){d.onSuccess()})},onError:function(a){d.onError(a)}})},b.prototype.joinGroup=function(b,c,d){var e=new Modules.GroupInfo;e.setId(b),e.setName(c);var f=new Modules.GroupInput;f.setGroupInfo([e]),a.RongIMClient.bridge.queryMsg(6,a.MessageUtil.ArrayForm(f.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){d.onSuccess()})},onError:function(a){d.onError(a)}},"GroupOutput")},b.prototype.quitGroup=function(b,c){var d=new Modules.LeaveChannelInput;d.setNothing(1),a.RongIMClient.bridge.queryMsg(8,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){c.onSuccess()})},onError:function(a){c.onError(a)}})},b.prototype.syncGroup=function(b,c){for(var d=0,e=[],f=[],g=b.length;d<g;d++)if(0===e.length||!(b[d].id in e)){e.push(b[d].id);var h=new Modules.GroupInfo;h.setId(b[d].id),h.setName(b[d].name),f.push(h)}var i=new Modules.GroupHashInput;i.setUserId(a.Bridge._client.userId),i.setGroupHashCode(md5(e.sort().join(""))),a.RongIMClient.bridge.queryMsg(13,a.MessageUtil.ArrayForm(i.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(b){if(1===b){var d=new Modules.GroupInput;d.setGroupInfo(f),a.RongIMClient.bridge.queryMsg(20,a.MessageUtil.ArrayForm(d.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(){setTimeout(function(){c.onSuccess()})},onError:function(){setTimeout(function(){c.onError(a.ErrorCode.GROUP_MATCH_ERROR)})}},"GroupOutput")}else setTimeout(function(){c.onSuccess()})},onError:function(){setTimeout(function(){c.onError(a.ErrorCode.GROUP_SYNC_ERROR)})}},"GroupHashOutput")},b.prototype.joinChatRoom=function(b,c,d){var e=new Modules.ChrmInput;e.setNothing(1),a.Bridge._client.chatroomId=b,a.RongIMClient.bridge.queryMsg(19,a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,{onSuccess:function(){d.onSuccess();var e=new Modules.ChrmPullMsg;0==c&&(c=-1),e.setCount(c),e.setSyncTime(0),a.Bridge._client.queryMessage("chrmPull",a.MessageUtil.ArrayForm(e.toArrayBuffer()),b,1,{onSuccess:function(c){var d=a.MessageUtil.int64ToTimestamp(c.syncTime);a.RongIMClient._storageProvider.setItem(b+a.Bridge._client.userId+"CST",d);var e=c.list;if(a.RongIMClient._memoryStore.filterMessages.length>0)for(var f=0,g=e.length;f<g;f++)for(var h=0,i=a.RongIMClient._memoryStore.filterMessages.length;h<i;h++)a.RongIMClient.MessageParams[a.RongIMClient._memoryStore.filterMessages[h]].objectName!=e[f].classname&&a.Bridge._client.handler.onReceived(e[f]);else for(var f=0,j=e.length;f<j;f++)a.Bridge._client.handler.onReceived(e[f])},onError:function(b){setTimeout(function(){d.onError(a.ErrorCode.CHATROOM_HISMESSAGE_ERROR)})}},"DownStreamMessages")},onError:function(){setTimeout(function(){d.onError(a.ErrorCode.CHARTOOM_JOIN_ERROR)})}},"ChrmOutput")},b.prototype.getChatRoomInfo=function(b,c,d,e){var f=new Modules.QueryChatroomInfoInput;f.setCount(c),f.setOrder(d),a.RongIMClient.bridge.queryMsg("queryChrmI",a.MessageUtil.ArrayForm(f.toArrayBuffer()),b,{onSuccess:function(a){setTimeout(function(){e.onSuccess(a)})},onError:function(a){e.onError(a)}},"QueryChatroomInfoOutput")},b.prototype.quitChatRoom=function(b,c){var d=new Modules.ChrmInput;d.setNothing(1),a.RongIMClient.bridge.queryMsg(17,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(){setTimeout(function(){c.onSuccess()})},onError:function(a){c.onError(a)}},"ChrmOutput")},b.prototype.setChatroomHisMessageTimestamp=function(b,c){a.RongIMClient._memoryStore.lastReadTime.set("chrhis_"+b,c)},b.prototype.getChatRoomHistoryMessages=function(b,c,d,e){var f=new Modules.HistoryMsgInput;f.setTargetId(b);var g=a.RongIMClient._memoryStore.lastReadTime.get("chrhis_"+b)||0;f.setTime(g),f.setCount(c),f.setOrder(d),a.RongIMClient.bridge.queryMsg(34,a.MessageUtil.ArrayForm(f.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(c){a.RongIMClient._memoryStore.lastReadTime.set("chrhis_"+b,a.MessageUtil.int64ToTimestamp(c.syncTime));for(var d=c.list.reverse(),f=0,g=d.length;f<g;f++)d[f]=a.MessageUtil.messageParser(d[f]);setTimeout(function(){e.onSuccess(d,!!c.hasMsg)})},onError:function(b){setTimeout(function(){b===a.ErrorCode.TIMEOUT?e.onError(b):e.onSuccess([],!1)})}},"HistoryMsgOuput")},b.prototype.addToBlacklist=function(b,c){var d=new Modules.Add2BlackListInput;d.setUserId(b),a.RongIMClient.bridge.queryMsg(21,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(){c.onSuccess()},onError:function(){c.onError(a.ErrorCode.BLACK_ADD_ERROR)}})},b.prototype.getBlacklist=function(b){var c=new Modules.QueryBlackListInput;c.setNothing(1),a.RongIMClient.bridge.queryMsg(23,a.MessageUtil.ArrayForm(c.toArrayBuffer()),a.Bridge._client.userId,b,"QueryBlackListOutput")},b.prototype.getBlacklistStatus=function(b,c){var d=new Modules.BlackListStatusInput;d.setUserId(b),a.RongIMClient.bridge.queryMsg(24,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(b){setTimeout(function(){c.onSuccess(a.BlacklistStatus[b])})},onError:function(){setTimeout(function(){c.onError(a.ErrorCode.BLACK_GETSTATUS_ERROR)})}})},b.prototype.removeFromBlacklist=function(b,c){var d=new Modules.RemoveFromBlackListInput;d.setUserId(b),a.RongIMClient.bridge.queryMsg(22,a.MessageUtil.ArrayForm(d.toArrayBuffer()),b,{onSuccess:function(){c.onSuccess()},onError:function(){c.onError(a.ErrorCode.BLACK_REMOVE_ERROR)}})},b.prototype.getFileToken=function(b,c){if(!/(1|2|3|4)/.test(b.toString()))return void c.onError(a.ErrorCode.QNTKN_FILETYPE_ERROR);var d=new Modules.GetQNupTokenInput;d.setType(b),a.RongIMClient.bridge.queryMsg(30,a.MessageUtil.ArrayForm(d.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(a){setTimeout(function(){c.onSuccess(a)})},onError:function(a){c.onError(a)}},"GetQNupTokenOutput")},b.prototype.getFileUrl=function(b,c,d,e){if(!/(1|2|3|4)/.test(b.toString()))return void setTimeout(function(){e.onError(a.ErrorCode.QNTKN_FILETYPE_ERROR)});var f=new Modules.GetQNdownloadUrlInput;f.setType(b),f.setKey(c),d&&f.setFileName(d),a.RongIMClient.bridge.queryMsg(31,a.MessageUtil.ArrayForm(f.toArrayBuffer()),a.Bridge._client.userId,{onSuccess:function(a){setTimeout(function(){e.onSuccess(a)})},onError:function(a){e.onError(a)}},"GetQNdownloadUrlOutput")},b.prototype.sendMessage=function(b,c,d,e,f,g,h,i){if(!a.Bridge._client.channel)return void e.onError(a.ErrorCode.RC_NET_UNAVAILABLE,null);if(!a.Bridge._client.channel.socket.socket.connected)throw e.onError(a.ErrorCode.TIMEOUT,null),new Error("connect is timeout! postion:sendMessage");var j=new Modules.UpStreamMessage;if(!f||b!=a.ConversationType.DISCUSSION&&b!=a.ConversationType.GROUP?j.setSessionId(a.RongIMClient.MessageParams[d.messageName].msgTag.getMessageTag()):j.setSessionId(7),g&&j.setPushText(g),h&&j.setAppData(h),(b==a.ConversationType.DISCUSSION||b==a.ConversationType.GROUP)&&d.messageName==a.RongIMClient.MessageType.ReadReceiptResponseMessage){var k=d;if(k.receiptMessageDic){var l=[];for(var m in k.receiptMessageDic)l.push(m);j.setUserId(l)}}b!=a.ConversationType.DISCUSSION&&b!=a.ConversationType.GROUP||d.messageName!=a.RongIMClient.MessageType.SyncReadStatusMessage||j.setUserId(a.Bridge._client.userId),j.setClassname(a.RongIMClient.MessageParams[d.messageName].objectName),j.setContent(d.encode());var n=j.toArrayBuffer();"[object ArrayBuffer]"==Object.prototype.toString.call(n)&&(n=[].slice.call(new Int8Array(n)));var o=null,p=new a.Message;this.getConversation(b,c,{onSuccess:function(e){o=e,3==a.RongIMClient.MessageParams[d.messageName].msgTag.getMessageTag()&&(o||(o=a.RongIMClient.getInstance().createConversation(b,c,"")),o.sentTime=(new Date).getTime(),o.sentStatus=a.SentStatus.SENDING,o.senderUserName="",o.senderUserId=a.Bridge._client.userId,o.notificationStatus=a.ConversationNotificationStatus.DO_NOT_DISTURB,o.latestMessage=p,o.unreadMessageCount=0,a.RongIMClient._dataAccessProvider.addConversation(o,{onSuccess:function(a){}})),a.RongIMClient._memoryStore.converStore=o}}),p.content=d,p.conversationType=b,p.senderUserId=a.Bridge._client.userId,p.objectName=a.RongIMClient.MessageParams[d.messageName].objectName,p.targetId=c,p.sentTime=(new Date).getTime(),p.messageDirection=a.MessageDirection.SEND,p.sentStatus=a.SentStatus.SENT,p.messageType=d.messageName,a.RongIMClient.bridge.pubMsg(b.valueOf(),n,c,{onSuccess:function(f){if(f&&f.timestamp&&a.RongIMClient._storageProvider.setItem("converST_"+a.Bridge._client.userId+b+c,f.timestamp),(b==a.ConversationType.DISCUSSION||b==a.ConversationType.GROUP)&&d.messageName==a.RongIMClient.MessageType.ReadReceiptRequestMessage){var g=p.content,h=a.Bridge._client.userId+g.messageUId+"SENT";a.RongIMClient._storageProvider.setItem(h,JSON.stringify({count:0,dealtime:f.timestamp,userIds:{}}))}3==a.RongIMClient.MessageParams[p.messageType].msgTag.getMessageTag()&&(a.RongIMClient._memoryStore.converStore.latestMessage=p,a.RongIMClient._dataAccessProvider.addMessage(b,c,p,{onSuccess:function(b){p=b,p.messageUId=f.messageUId,p.sentTime=f.timestamp,p.sentStatus=a.SentStatus.SENT,p.messageId=f.messageId,a.RongIMClient._dataAccessProvider.updateMessage(p)},onError:function(){}})),setTimeout(function(){p.sentTime=f.timestamp,e.onSuccess(p)})},onError:function(d){p.sentStatus=a.SentStatus.FAILED,3==a.RongIMClient.MessageParams[p.messageType].msgTag.getMessageTag()&&(a.RongIMClient._memoryStore.converStore.latestMessage=p),a.RongIMClient._dataAccessProvider.addMessage(b,c,p,{onSuccess:function(b){p.messageId=b.messageId,
a.RongIMClient._dataAccessProvider.updateMessage(p)},onError:function(){}}),setTimeout(function(){e.onError(d,p)})}},null,i)},b.prototype.setConnectionStatusListener=function(b){a.RongIMClient.bridge?a.RongIMClient.bridge.setListener(b):a.RongIMClient._memoryStore.listenerList.push(b)},b.prototype.setOnReceiveMessageListener=function(b){a.RongIMClient.bridge?a.RongIMClient.bridge.setListener(b):a.RongIMClient._memoryStore.listenerList.push(b)},b.prototype.registerMessageType=function(b,c,d,e){if(!b)throw new Error("messageType can't be empty,postion -> registerMessageType");if(!c)throw new Error("objectName can't be empty,postion -> registerMessageType");if("[object Array]"==Object.prototype.toString.call(e)){var f=a.ModelUtil.modleCreate(e,b);a.RongIMClient.RegisterMessage[b]=f}else{if("[object Function]"!=Object.prototype.toString.call(e)&&"[object Object]"!=Object.prototype.toString.call(e))throw new Error("The index of 3 parameter was wrong type  must be object or function or array-> registerMessageType");if(!e.encode)throw new Error("encode method has not realized or messageName is undefined-> registerMessageType");if(!e.decode)throw new Error("decode method has not realized -> registerMessageType")}registerMessageTypeMapping[c]=b},b.prototype.updateConversation=function(a){var b="update t_conversation_"+this.database.userId+" set content = ?,sentTime = ?,istop = ? where conversationType = ? and targetId = ?";return this.database.execUpdateByParams(b,[JSON.stringify(a),a.sentTime,a.isTop,a.conversationType,a.targetId]),a},b.prototype.addConversation=function(a,b){var c=this,d="select * from t_conversation_"+c.database.userId+" t where t.conversationType = ? and t.targetId = ?";c.database.execSearchByParams(d,[Number(a.conversationType),a.targetId],function(d,e){if(d.length>0&&e)c.updateConversation(a);else{var f="insert into t_conversation_"+c.database.userId+"(conversationType,targetId,content,sentTime,isTop) values(?,?,?,?,?)";c.database.execUpdateByParams(f,[a.conversationType,a.targetId,JSON.stringify(a),a.sentTime,a.isTop])}b.onSuccess(!0)})},b.prototype.removeConversation=function(a,b,c){var d="delete from t_conversation_"+this.database.userId+"  where conversationType = ? and targetId = ?";this.database.execUpdateByParams(d,[a,b]),c.onSuccess(!0)},b.prototype.getConversation=function(a,b,c){var d="select t.content from t_conversation_"+this.database.userId+" t where t.conversationType = ? and t.targetId = ?";this.database.execSearchByParams(d,[Number(a),b],function(a,b){var d;a.length>0&&b&&(d=JSON.parse(a[0].content)),c.onSuccess(d)})},b.prototype.getConversationList=function(b,c,d,e){a.RongIMClient._memoryStore.isSyncRemoteConverList&&a.RongIMClient.getInstance().getRemoteConversationList({onSuccess:function(b){a.RongIMClient._memoryStore.conversationList=b;for(var c=0,d=b.length;c<d;c++)h.addConversation(b[c],{onSuccess:function(){},onError:function(){}});a.RongIMClient._memoryStore.isSyncRemoteConverList=!1},onError:function(a){b.onError(a)}},c,d,e);var f="select * from t_conversation_"+this.database.userId+" t where t.isTop = 1 ",g="select * from t_conversation_"+this.database.userId+" c where c.isTop != 1 order by c.sentTime ",h=this;c&&(f+=" and t.conversationType in ("+c.join(",")+")",g+=" and c.conversationType in ("+c.join(",")+")"),f+=" union "+g,this.database.execSearch(f,function(c){if(c.length>0){for(var d=[],e=0,f=c.length;e<f;e++)d.push(JSON.parse(c[e].content));a.RongIMClient._memoryStore.conversationList=d}b.onSuccess(a.RongIMClient._memoryStore.conversationList)})},b.prototype.clearConversations=function(b,c){var d="delete from t_conversation_"+this.database.userId+" where conversationType in (?)";this.database.execUpdateByParams(d,[b.join(",")]),Array.forEach(b,function(b){Array.forEach(a.RongIMClient._memoryStore.conversationList,function(c){b==c.conversationType&&a.RongIMClient.getInstance().removeConversation(c.conversationType,c.targetId,{onSuccess:function(){},onError:function(){}})})}),c.onSuccess(!0)},b.prototype.getMessage=function(a,b){var c="select * from t_message_"+this.database.userId+" t where t.messageUId = ?";this.database.execSearchByParams(c,[a],function(a,c){if(a.length>0&&c){var d=JSON.parse(a[0].content);b.onSuccess(d)}else b.onSuccess(null)})},b.prototype.addMessage=function(a,b,c,d){var e="insert into t_message_"+this.database.userId+" (messageType,messageUId,conversationType,targetId,sentTime,content,localMsg)values(?,?,?,?,?,?,?)",f=c.messageUId?0:1;if(this.database.execUpdateByParams(e,[c.messageType,c.messageUId,c.conversationType,c.targetId,c.sentTime,JSON.stringify(c),f]),d){var g="select t.id from t_message_"+this.database.userId+" t where t.sentTime = ? and t.conversationType = ? and t.targetId = ?";this.database.execSearchByParams(g,[c.sentTime,a,b],function(a,b){b&&(c.messageId=a[0].id),d.onSuccess(c)})}},b.prototype.removeMessage=function(a,b,c,d){if(0!=c.length){for(var e=[],f=0,g=c.length;f<g;f++)e.push(c[f].msgId);var h="delete from t_message_"+this.database.userId+" where messageUId in (?)";this.database.execUpdateByParams(h,e.join(","))}},b.prototype.removeLocalMessage=function(a,b,c,d){if(0!=c.length){var e="delete from t_message_"+this.database.userId+" where id in ("+c.join(",")+") and conversationType = ? and targetId = ? and localMsg = 1";this.database.execUpdateByParams(e,[a,b]),d.onSuccess(!0)}},b.prototype.updateMessage=function(a,b){var c="update t_message_"+this.database.userId+" set messageUId = ?,sentTime = ?,content = ?,localMsg = ? where id = ?";this.database.execUpdateByParams(c,[a.messageUId,a.sentTime,JSON.stringify(a),a.isLocalMessage,a.messageId])},b.prototype.updateMessages=function(a,b,c,d,e){throw new Error("Not implemented yet")},b.prototype.clearMessages=function(a,b,c){var d="delete from t_message_"+this.database.userId+" where conversationType = ? and targetId = ? ";this.database.execUpdateByParams(d,[a,b]),c.onSuccess(!0)},b.prototype.getHistoryMessages=function(b,c,d,e,f){var g="select * from (select * from t_message_"+this.database.userId+" t where t.conversationType = ? and t.targetId = ? ",h=[b,c],i=[],j=this;if(0!==d){var k=a.RongIMClient._memoryStore.lastReadTime.get(b+c);0!=k&&(g+="and t.sentTime < ? ",h.push(k),d=k)}g+="order by t.sentTime desc limit ?) order by sentTime ",h.push(e),j.database.execSearchByParams(g,h,function(k,l){for(var m=0,n=k.length;m<n;m++)i.push(JSON.parse(k[m].content));n<e?a.RongIMClient.getInstance().getRemoteHistoryMessages(b,c,d,e-k.length,{onSuccess:function(b,d){for(var e=0,i=b.length;e<i;e++)b[e].targetId?null:b[e].targetId=c,a.RongIMClient._dataAccessProvider.addMessage(b[e].conversationType,b[e].targetId,b[e],{onSuccess:function(a){},onError:function(){}});j.database.execSearchByParams(g,h,function(a){for(var b=[],c=0,e=a.length;c<e;c++)b.push(JSON.parse(a[c].content));f.onSuccess(b,d)})},onError:function(a){}}):(f.onSuccess(i,!0),a.RongIMClient._memoryStore.lastReadTime.set(b+c,k[n-1].sentTime))})},b.prototype.getTotalUnreadCount=function(a,b){var c="select t.content from t_conversation_"+this.database.userId+" t";this.database.execSearch(c,function(c){var d=0;if(b)for(var e=0,f=b.length;e<f;e++)for(var g=0,h=c.length;g<h;g++){var i=JSON.parse(c[g].content);i.conversationType==b[e]&&(d+=i.unreadMessageCount)}else for(var g=0,f=c.length;g<f;g++){var i=JSON.parse(c[g].content);d+=i.unreadMessageCount}a.onSuccess(d)})},b.prototype.getConversationUnreadCount=function(a,b){if(0==a.length)return void b.onSuccess(0);var c="select t.content from t_conversation_"+this.database.userId+" t where t.conversationType in ("+a.join(",")+")";this.database.execSearchByParams(c,[],function(a){for(var c=0,d=0,e=a.length;d<e;d++){var f=JSON.parse(a[d].content);c+=f.unreadMessageCount}b.onSuccess(c)})},b.prototype.getUnreadCount=function(a,b,c){var d="select t.content from t_conversation_"+this.database.userId+" t where t.conversationType = ? and t.targetId = ?";this.database.execSearchByParams(d,[a,b],function(a){for(var b=0,d=0,e=a.length;d<e;d++){var f=JSON.parse(a[d].content);b+=f.unreadMessageCount}c.onSuccess(b)})},b.prototype.clearUnreadCountByTimestamp=function(a,b,c,d){d.onSuccess(!0)},b.prototype.clearUnreadCount=function(b,c,d){var e="select * from t_conversation_"+this.database.userId+" t where t.conversationType = ? and t.targetId = ?",f="update t_conversation_"+this.database.userId+" set content = ? where conversationType = ? and targetId = ?",g=this;this.database.execSearchByParams(e,[b,c],function(e,h){var i=a.RongIMClient._storageProvider.getItem("mentioneds_"+a.Bridge._client.userId+"_"+b+"_"+c);if(i){var j=JSON.parse(i);delete j[b+"_"+c],a.MessageUtil.isEmpty(j)?a.RongIMClient._storageProvider.removeItem("mentioneds_"+a.Bridge._client.userId+"_"+b+"_"+c):a.RongIMClient._storageProvider.setItem("mentioneds_"+a.Bridge._client.userId+"_"+b+"_"+c,JSON.stringify(j))}if(0!=e.length||h){var k=JSON.parse(e[0].content);k.unreadMessageCount=0,k.mentionedMsg=null,g.database.execUpdateByParams(f,[JSON.stringify(k),b,c]),d.onSuccess(!0)}else d.onSuccess(!1)})},b.prototype.setConversationToTop=function(a,b,c,d){var e="update t_conversation_"+this.database.userId+" set isTop = ? where conversationType = ? and targetId = ?";this.database.execUpdateByParams(e,[a,c,b]),d.onSuccess(!0)},b.prototype.setConversationHidden=function(a,b,c){},b.prototype.setMessageExtra=function(a,b,c){var d="select t.content from t_message_"+this.database.userId+" t where t.messageUId = ?",e="UPADTE t_message_"+this.database.userId+" t SET t.content = ? where t.messageUId = ?";this.database.execSearchByParams(d,[a],function(d,f){if(0!=d.length||f){var g=JSON.parse(d[0].content);g.extra=b,this.database.execUpdateByParams(e,[JSON.stringify(g),a])}else c.onSuccess(!1)})},b.prototype.setMessageReceivedStatus=function(a,b,c){var d="select t.content from t_message_"+this.database.userId+" t where t.messageUId = ?",e="update t_message_"+this.database.userId+" set content = ? where messageUId = ?",f=this;this.database.execSearchByParams(d,[a],function(d,g){if(0!=d.length||g){var h=JSON.parse(d[0].content);h.receivedStatus=b,f.database.execUpdateByParams(e,[JSON.stringify(h),a]),c.onSuccess(!0)}else c.onSuccess(!1)})},b.prototype.dropTable=function(a){this.database.execUpdate(a)},b.prototype.setServerInfo=function(a){},b.prototype.setMessageSentStatus=function(a,b,c){var d="select t.content from t_message_"+this.database.userId+" t where t.messageUId = ?",e="update t_message_"+this.database.userId+" set content = ? where messageUId = ?";this.database.execSearchByParams(d,[a],function(d,f){if(0!=d.length||f){var g=JSON.parse(d[0].content);g.sentStatus=b,this.database.execUpdateByParams(e,[JSON.stringify(g),a]),c.onSuccess(!0)}else c.onSuccess(!1)})},b.prototype.getUnreadMentionedMessages=function(a,b){return null},b.prototype.searchConversationByContent=function(a,b,c){b.onSuccess([])},b.prototype.searchMessageByContent=function(a,b,c,d,e,f,g){g.onSuccess([])},b.prototype.getDelaTime=function(){return 0},b.prototype.getUserStatus=function(b,c){c.onSuccess(new a.UserStatus)},b.prototype.setUserStatus=function(a,b){b.onSuccess(!0)},b.prototype.subscribeUserStatus=function(a,b){b.onSuccess(!0)},b.prototype.clearListeners=function(){},b.prototype.setOnReceiveStatusListener=function(a){a()},b}();a.WebSQLDataProvider=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(){this.prefix="rong_"}return b.prototype.setItem=function(b,c,d){if(b.indexOf(this.prefix)==-1&&(b=this.prefix+b),d){var e=new Date;e.setTime(e.getTime()+24*a.RongIMClient._memoryStore.depend.cookieValidity*3600*1e3),document.cookie=b+"="+decodeURIComponent(c)+";path=/;expires="+e.toGMTString()}else document.cookie=b+"="+decodeURIComponent(c)+";path=/;"},b.prototype.getItem=function(a){a&&(a.indexOf(this.prefix)==-1&&(a=this.prefix+a),a=a.replace(/\|/,"\\|"));var b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)"));return null!=b?b[2]:null},b.prototype.removeItem=function(a){a.indexOf(this.prefix)==-1&&(a=this.prefix+a),this.getItem(a)&&(document.cookie=a+"=;path=/;expires=Thu, 01-Jan-1970 00:00:01 GMT")},b.prototype.getItemKey=function(a){var b=document.cookie.match(new RegExp("(^| )rong_navi\\w+?=([^;]*)(;|$)")),c="";if(b)for(var d=0,e=b.length;d<e;d++)if(b[d].indexOf(a)>-1){c=b[d];break}return c?c.split("=")[0].replace(/^\s/,""):null},b.prototype.clearItem=function(){var a=document.cookie.match(/[^ =;]+(?=\=)/g),b=this;if(a)for(var c=a.length;c--;)a[c].indexOf(b.prefix)>-1&&(document.cookie=a[c]+"=0;path=/;expires="+new Date(0).toUTCString())},b.prototype.onOutOfQuota=function(){return 4096},b}();a.CookieProvider=b;var c=function(){function a(){this._memeoryStore={},this.prefix="rong_"}return a.prototype.setItem=function(a,b){this._memeoryStore[a]=decodeURIComponent(b)},a.prototype.getItem=function(a){return this._memeoryStore[a]},a.prototype.removeItem=function(a){this.getItem(a)&&delete this._memeoryStore[a]},a.prototype.getItemKey=function(a){var b=this,c=null,d=new RegExp(a+"\\w+");for(var e in b._memeoryStore){var f=e.match(d);f&&(c=e)}return c},a.prototype.clearItem=function(){var a=this;for(var b in a._memeoryStore)delete a._memeoryStore[b]},a.prototype.onOutOfQuota=function(){return 4096},a}();a.MemeoryProvider=c}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(){this.prefix="rong_",this._host="";var b=new Date,c=b.getMonth()+1,d=b.getFullYear()+"/"+(1==c.toString().length?"0"+c:c)+"/"+b.getDate(),e=new Date(d).getTime();for(var f in localStorage){if(f.lastIndexOf("RECEIVED")>-1){var g=JSON.parse(localStorage.getItem(f));for(var h in g)e-g[h].dealtime>0&&delete g[h];a.ObjectTools.isEmpty(g)?localStorage.removeItem(f):localStorage.setItem(f,JSON.stringify(g))}if(f.lastIndexOf("SENT")>-1){var i=JSON.parse(localStorage.getItem(f));e-i.dealtime>0&&localStorage.removeItem(f)}}}return b.prototype.setItem=function(a,b){a&&(a.indexOf(this.prefix)==-1&&(a=this.prefix+a),localStorage.setItem(a,b))},b.prototype.getItem=function(a){return a?(a.indexOf(this.prefix)==-1&&(a=this.prefix+a),localStorage.getItem(a?a:"")):""},b.prototype.getItemKey=function(a){var b="";for(var c in localStorage)if(c.indexOf(a)>-1){b=c;break}return b},b.prototype.removeItem=function(a){a&&(a.indexOf(this.prefix)==-1&&(a=this.prefix+a),localStorage.removeItem(a.toString()))},b.prototype.clearItem=function(){var a=this;for(var b in localStorage)b.indexOf(a.prefix)>-1&&a.removeItem(b)},b.prototype.onOutOfQuota=function(){return JSON.stringify(localStorage).length},b}();a.LocalStorageProvider=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function a(){this.opersistName="RongIMLib",this.keyManager="RongUserDataKeyManager",this._host="",this.prefix="rong_",this.oPersist=document.createElement("div"),this.oPersist.style.display="none",this.oPersist.style.behavior="url('#default#userData')",document.body.appendChild(this.oPersist),this.oPersist.load(this.opersistName)}return a.prototype.setItem=function(a,b){a&&a.indexOf(this.prefix)==-1&&(a=this.prefix+a),this.oPersist.setAttribute(a,b);var c=this.getItem(this.keyManager);c?c.indexOf(a)==-1&&(c+=","+a):c=a,this.oPersist.setAttribute(this.prefix+this.keyManager,c),this.oPersist.save(this.opersistName)},a.prototype.getItem=function(a){return a&&a.indexOf(this.prefix)==-1&&(a=this.prefix+a),a?this.oPersist.getAttribute(a):a},a.prototype.removeItem=function(a){a&&a.indexOf(this.prefix)==-1&&(a=this.prefix+a),this.oPersist.removeAttribute(a),this.oPersist.save(this.opersistName);for(var b=this.getItem(this.keyManager),c=b&&b.split(",")||[],d=0,e=c.length;d<e;d++)c[d]==a&&c.splice(d,1);this.oPersist.setAttribute(this.prefix+this.keyManager,c.join(",")),this.oPersist.save(this.opersistName)},a.prototype.getItemKey=function(a){var b=null,c=this.getItem(this.keyManager),d=c&&c.split(",")||[];if(d.length)for(var e=0,f=d.length;e<f;e++)if(d[e]&&d[e].indexOf(a)>-1){b=d[e];break}return b},a.prototype.clearItem=function(){var a=this.getItem(this.keyManager),b=[],c=this;if(a&&(b=a.split(",")),b.length){for(var d=0,e=b.length;d<e;d++)b[d]&&c.removeItem(b[d]);c.removeItem(c.keyManager)}},a.prototype.onOutOfQuota=function(){return 10485760},a}();a.UserDataProvider=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function b(){if(this.script=document.createElement("script"),this.head=document.getElementsByTagName("head")[0],a.Transportations._TransportType=a.Socket.WEBSOCKET,"WebSocket"in window&&"ArrayBuffer"in window&&3===WebSocket.prototype.CLOSED&&!a.RongIMClient._memoryStore.depend.isPolling){var b=a.RongIMClient._memoryStore.depend.protobuf;this.script.src=b,this.head.appendChild(this.script)}else a.Transportations._TransportType="xhr-polling",window.Modules=Polling}return b}();a.FeatureDectector=b}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(RongIMLib){var FeaturePatcher=function(){function FeaturePatcher(){}return FeaturePatcher.prototype.patchAll=function(){this.patchJSON(),this.patchForEach()},FeaturePatcher.prototype.patchForEach=function(){Array.forEach||(Array.forEach=function(a,b){for(var c=0;c<a.length;c++)b.call(a,a[c],c,a)})},FeaturePatcher.prototype.patchJSON=function(){window.JSON||(window.JSON=function(){function JSON(){}return JSON.parse=function(sJSON){return eval("("+sJSON+")")},JSON.stringify=function(a){return this.str("",{"":a})},JSON.str=function(a,b){var c,d,e,f,g,h=b[a],i=this;switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(a)),typeof h){case"string":return i.quote(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(g=[],"[object Array]"===Object.prototype.toString.apply(h)){for(f=h.length,c=0;c<f;c+=1)g[c]=i.str(c,h)||"null";return e=0===g.length?"[]":"["+g.join(",")+"]"}for(d in h)Object.prototype.hasOwnProperty.call(h,d)&&(e=i.str(d,h),e&&g.push(i.quote(d)+":"+e));return e=0===g.length?"{}":"{"+g.join(",")+"}"}},JSON.quote=function(a){var b=this;return b.rx_escapable.lastIndex=0,b.rx_escapable.test(a)?'"'+a.replace(b.rx_escapable,function(a){var c=b.meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},JSON.rx_escapable=new RegExp('[\\"\\\\"\0--­؀-؄܏឴឵‌-‏\u2028- ⁠-⁯\ufeff￰-￿]',"g"),JSON.meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"''":"\\''","\\":"\\\\"},JSON}())},FeaturePatcher}();RongIMLib.FeaturePatcher=FeaturePatcher}(RongIMLib||(RongIMLib={}));var RongIMLib;!function(a){var b=function(){function a(){}return a.isEmpty=function(a){var b=!0;for(var c in a){b=!1;break}return b},a.buildOptions=function(a,b,c){if("object"==typeof a)for(var d in b)"fileUploadURL"==d||"fileQNURL"==d||"protobuf"==d||"long"==d||"byteBuffer"==d||"navi"==d||"api"==d||"emojiImage"==d||"voiceLibamr"==d||"voicePCMdata"==d||"voiceSwfobjct"==d||"voicePlaySwf"==d||"callFile"==d?a[d]&&(b[d]=c+a[d]):a[d]&&(b[d]=a[d]);return b},a}();a.ObjectTools=b;var c=function(){function a(){this.publicServiceList=[]}return a.prototype.get=function(a,b){for(var c=0,d=this.publicServiceList.length;c<d;c++)if(this.publicServiceList[c].conversationType==a&&b==this.publicServiceList[c].publicServiceId)return this.publicServiceList[c]},a.prototype.add=function(a){for(var b=!0,c=this,d=0,e=this.publicServiceList.length;d<e;d++)if(c.publicServiceList[d].conversationType==a.conversationType&&a.publicServiceId==c.publicServiceList[d].publicServiceId){this.publicServiceList.unshift(this.publicServiceList.splice(d,1)[0]),b=!1;break}b&&this.publicServiceList.unshift(a)},a.prototype.replace=function(a){for(var b=this,c=0,d=this.publicServiceList.length;c<d;c++)if(b.publicServiceList[c].conversationType==a.conversationType&&a.publicServiceId==b.publicServiceList[c].publicServiceId){b.publicServiceList.splice(c,1,a);break}},a.prototype.remove=function(a,b){for(var c=this,d=0,e=this.publicServiceList.length;d<e;d++)if(c.publicServiceList[d].conversationType==a&&b==c.publicServiceList[d].publicServiceId){this.publicServiceList.splice(d,1);break}},a}();a.PublicServiceMap=c;var d=function(){function a(){this.conversationList=[]}return a.prototype.get=function(a,b){for(var c=0,d=this.conversationList.length;c<d;c++)if(this.conversationList[c].conversationType==a&&this.conversationList[c].targetId==b)return this.conversationList[c];return null},a.prototype.add=function(a){for(var b=!0,c=0,d=this.conversationList.length;c<d;c++)if(this.conversationList[c].conversationType===a.conversationType&&this.conversationList[c].targetId===a.targetId){this.conversationList.unshift(this.conversationList.splice(c,1)[0]),b=!1;break}b&&this.conversationList.unshift(a)},a.prototype.replace=function(a){for(var b=0,c=this.conversationList.length;b<c;b++)if(this.conversationList[b].conversationType===a.conversationType&&this.conversationList[b].targetId===a.targetId){this.conversationList.splice(b,1,a);break}},a.prototype.remove=function(a){for(var b=0,c=this.conversationList.length;b<c;b++)if(this.conversationList[b].conversationType===a.conversationType&&this.conversationList[b].targetId===a.targetId){this.conversationList.splice(b,1);break}},a}();a.ConversationMap=d;var e=function(){function b(){}return b.getInstance=function(){return b._instance||(b._instance=new b),b._instance},b.prototype.check=function(b,c,d){var e=arguments.callee.caller;if(!a.RongIMClient._dataAccessProvider&&!d)throw new Error("The parameter is incorrect or was not yet instantiated RongIMClient -> position:"+c);for(var f=0,g=e.arguments.length;f<g;f++)if(!new RegExp(this.getType(e.arguments[f])).test(b[f]))throw new Error("The index of "+f+" parameter was wrong type "+this.getType(e.arguments[f])+" ["+b[f]+"] -> position:"+c)},b.prototype.getType=function(a){var b=Object.prototype.toString.call(a).toLowerCase();return b.slice(8,b.length-1)},b.prototype.checkCookieDisable=function(){document.cookie="checkCookie=1";var a=document.cookie.match(new RegExp("(^| )checkCookie=([^;]*)(;|$)")),b=!1;return a||(b=!0),document.cookie="checkCookie=1;expires=Thu, 01-Jan-1970 00:00:01 GMT",b},b}();a.CheckParam=e;var f=function(){function a(a){this.map={},this.keys=[],this.limit=a||10}return a.prototype.set=function(a,b){if(this.map.hasOwnProperty(a)){if(this.keys.length===this.limit){var c=this.keys.shift();delete this.map[c]}this.keys.push(a)}this.map[a]=b},a.prototype.get=function(a){return this.map[a]||0},a.prototype.remove=function(a){delete this.map[a]},a}();a.LimitableMap=f;var g=function(){function a(a){var b=this;b.xmlhttp=null,b.options=a;var c="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;"undefined"!=typeof XMLHttpRequest&&c?b.xmlhttp=new XMLHttpRequest:"undefined"!=typeof XDomainRequest?b.xmlhttp=new XDomainRequest:b.xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}return a.prototype.send=function(a){var b=this;b.options.url||(b.options.url="http://upload.qiniu.com/putb64/-1"),b.xmlhttp.onreadystatechange=function(){4==b.xmlhttp.readyState&&(b.options.type?a():a(JSON.parse(b.xmlhttp.responseText.replace(/'/g,'"'))))},b.xmlhttp.open("POST",b.options.url,!0),b.xmlhttp.withCredentials=!1,"setRequestHeader"in b.xmlhttp&&(b.options.type?b.xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8"):(b.xmlhttp.setRequestHeader("Content-type","application/octet-stream"),b.xmlhttp.setRequestHeader("Authorization","UpToken "+b.options.token))),b.xmlhttp.send(b.options.type?"appKey="+b.options.appKey+"&deviceId="+b.options.deviceId+"&timestamp="+b.options.timestamp+"&deviceInfo="+b.options.deviceInfo+"&privateInfo="+JSON.stringify(b.options.privateInfo):b.options.base64)},a}();a.RongAjax=g}(RongIMLib||(RongIMLib={}));
//# sourceMappingURL=RongIMLib-2.2.6.min.js.map